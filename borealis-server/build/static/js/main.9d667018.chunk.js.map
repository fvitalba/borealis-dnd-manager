{"version":3,"sources":["redux/constants.js","reducers/settingsReducer.js","reducers/metadataReducer.js","controllers/guid.js","reducers/gameReducer.js","hooks/useSocket.js","contexts/WebSocketProvider.js","controllers/drawImage.js","hooks/useCanvas.js","components/Canvas.js","components/Background.js","components/Drawing.js","components/Fog.js","components/Overlay.js","views/TokenView.js","components/Token.js","views/Cursor.js","views/Button.js","components/ToggleButton.js","views/ToolControlsView.js","components/ToolControls.js","views/MapConfigView.js","components/MapConfig.js","views/MapToolView.js","components/MapTool.js","views/HostTokenConfigView.js","views/GuestTokenConfigView.js","components/TokenConfig.js","views/TokenToolView.js","views/SelectedTokensControlsView.js","components/SelectedTokensControls.js","components/TokenTool.js","views/UserToolView.js","components/UserTool.js","components/ToolButton.js","views/ToolSelectView.js","views/ControlPanelView.js","components/ControlPanel.js","views/GameView.js","components/Game.js","components/App.js","serviceWorker.js","index.js"],"names":["CHANGE_CURSORSIZE","CHANGE_FOG_SETTINGS","CHANGE_DRAW_SETTINGS","CHANGE_TOOL","CHANGE_USERNAME","TOGGLE_MOUSESHARING","OVERWRITE_GAME","LOAD_MAP","INCREMENT_GEN","SET_FOG_ENABLED","SET_ISFOGLOADED","SET_ISFIRSTLOADDONE","UPDATE_MAPS","ADD_MAP","DELETE_MAP","UPDATE_TOKENS","ADD_TOKEN","DELETE_TOKEN","COPY_TOKEN","UPDATE_TOKEN_VALUE","TOGGLE_TOKEN_VALUE","SET_TOKEN_ORIGIN","RESET_FOG","RESET_DRAW","SET_GAMESETTINGS","SET_CURSORS","SET_LAST_COORDINATES","SET_DOWN_COORDINATES","initialSettingsState","cursorSize","fogOpacity","fogRadius","drawColor","drawSize","tool","subtool","undefined","username","URLSearchParams","window","location","href","replace","get","shareMouse","setCursorSize","newCursorSize","type","parseInt","setToolSettings","newTool","newSubtool","setUsername","newUsername","settingsReducer","state","action","initialMetadataState","isHost","room","cursors","lastX","lastY","downX","downY","metadataReducer","guid","c","r","crypto","getRandomValues","Uint32Array","Math","pow","toString","initialGameState","mapId","gen","width","innerWidth","height","innerHeight","fogEnabled","isFogLoaded","isFirstLoadDone","maps","tokens","defaultGameState","name","$id","imageUrl","x","y","drawPaths","fogPaths","url","$selected","$x0","$y0","ko","pc","loadMap","newMapId","setFogEnabled","newFogEnabled","updateMaps","newMaps","addMap","mapName","map","updateTokens","newTokens","toggleTokenValue","tokenGuidToUpdate","key","tokenGuid","gameReducer","JSON","parse","stringify","game","isNaN","length","mapsWithNewMap","concat","filter","token","tokenCopy","newToken","tokensCopy","value","tokensCopy2","console","log","tokensCopy3","xOrigin","yOrigin","fogResetMaps","drawResetMaps","useWebSocket","useContext","WebSocketContext","sendData","webSocket","data","readyState","WebSocket","OPEN","send","error","pushGameRefresh","wsSettings","additionalAttributes","from","requestRefresh","require","config","process","PORT","createWebSocket","webSocketUrl","host","protocol","test","generateWebSocketUrl","createContext","connect","metadata","children","useState","setWsSettings","ws","setWs","useEffect","onClose","setTimeout","onOpen","onError","err","addEventListener","removeEventListener","Provider","drawImage","which","context","resizeCanvases","trim","Promise","resolve","reject","ctx","img","Image","onload","w","h","then","onerror","src","useCanvas","draw","gameState","options","canvasRef","useRef","current","getContext","Canvas","id","rest","ref","mapDispatchToProps","onClick","e","deselectedTokens","currMap","getMap","currPath","globalCompositeOperation","beginPath","pointId","lineCap","fillStyle","lineWidth","strokeStyle","moveTo","lineTo","erease","className","clearRect","pathId","stroke","settings","ereaseFog","gradient","createRadialGradient","r2","addColorStop","fillRect","style","opacity","overlayRef","TokenView","divStyle","classes","imgStyle","onMouseDown","onMouseUp","title","join","alt","setTokenOrigin","left","top","Cursor","cursor","size","fontSize","role","u","Button","isSelected","disabled","ToggleButton","controlPanelState","setControlPanelState","toggleKey","ToolControlsView","setDrawColor","setDrawSize","setFogOpacity","setFogRadius","setSubtool","resetFog","resetDrawing","onChange","target","step","min","backgroundColor","max","setDrawToolSettings","newDrawColor","newDrawSize","setFogToolSettings","newFogOpacity","newFogRadius","resetDraw","newSize","newOpacity","newRadius","MapConfigView","mapConfigState","load","onTextChange","onIntegerChange","deleteMap","placeholder","mapIdToDelete","setIsFogLoaded","newIsFogLoaded","setIsFirstLoadDone","newIsFirstLoadDone","existingMap","mapElement","currentMap","initialMapConfigState","setMapConfigState","updatedMaps","pushMapState","evt","confirm","MapToolView","newMapName","setNewMapName","createMap","toggleOnMaps","newWidth","newHeight","pushCreateMap","HostTokenConfigView","copy","onToggle","selectToken","onMapSelect","deleteToken","defaultValue","GuestTokenConfigView","tokenGuidToDelete","copyToken","tokenGuidToCopy","updateTokenValue","tokenSelected","TokenToolView","newTokenUrl","setNewTokenUrl","createToken","$i","SelectedTokensControlsView","filteredTokens","t","addToken","tokenName","tokenUrl","toggleOnTokens","UserToolView","initAsDev","toggleFog","copyJson","pasteJson","updateUsername","updateCursorSize","loadDefaultBattleGame","toggleOnUser","pushFogEnabled","ToolSelectView","ControlPanelView","hidden","toggleHidden","socketRequestRefresh","pushRefreshToPlayers","initialControlPanelState","GameView","onMouseMove","goneClass","setGameSettings","newIsHost","newRoom","overwriteGame","newGame","incrementGen","React","mousePosition","setMousePosition","currentPath","setPointerOutline","color","radius","arc","PI","closePath","onResize","onKeyDown","currentTool","isEraser","saveToLocalStorage","receiveData","useCallback","to","newDrawPath","push","drawPath","updatedMapsWithDraw","updatedMapsWithDrawReset","newFogPath","fogPath","updatedMapsWithFog","updatedMapsWithFogReset","updatedTokens","selectionFixedTokens","currentToken","token2","params","document","deadline","Date","cursorsCopy","time","clearOverlay","pageX","pageY","updateCurrentFogPath","updateCurrentDrawPath","buttons","dragSelectedTokens","pushFogPath","pushDrawPath","pushTokens","activeElement","tagName","toUpperCase","ex","localStorage","removeItem","alert","handleError","App","combinedReducer","combineReducers","store","createStore","Boolean","hostname","match","ReactDOM","render","StrictMode","getElementById","navigator","serviceWorker","ready","registration","unregister","catch","message"],"mappings":"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","file":"static/js/main.9d667018.chunk.js","sourcesContent":["// settings\nexport const CHANGE_CURSORSIZE = 'SETTINGS/CHANGE_CURSORSIZE'\nexport const CHANGE_FOG_SETTINGS = 'SETTINGS/CHANGE_FOG_SETTINGS'\nexport const CHANGE_DRAW_SETTINGS = 'SETTINGS/CHANGE_DRAW_SETTINGS'\nexport const CHANGE_TOOL = 'SETTINGS/CHANGE_TOOL'\nexport const CHANGE_USERNAME = 'SETTINGS/CHANGE_USERNAME'\nexport const TOGGLE_MOUSESHARING = 'SETTINGS/TOGGLE_MOUSESHARING'\n\n// game\nexport const OVERWRITE_GAME = 'GAME/OVERWRITE_GAME'\nexport const LOAD_MAP = 'GAME/LOAD_MAP'\nexport const INCREMENT_GEN = 'GAME/INCREMENT_GEN'\nexport const SET_FOG_ENABLED = 'GAME/SET_FOG_ENABLED'\nexport const SET_ISFOGLOADED = 'GAME/SET_ISFOGLOADED'\nexport const SET_ISFIRSTLOADDONE = 'GAME/SET_ISFIRSTLOADDONE'\nexport const UPDATE_MAPS = 'GAME/UPDATE_MAPS'\nexport const ADD_MAP = 'GAME/ADD_MAP'\nexport const DELETE_MAP = 'GAME/DELETE_APP'\nexport const UPDATE_TOKENS = 'GAME/UPDATE_TOKENS'\nexport const ADD_TOKEN = 'GAME/ADD_TOKEN'\nexport const DELETE_TOKEN = 'GAME/DELETE_TOKEN'\nexport const COPY_TOKEN = 'GAME/COPY_TOKEN'\nexport const UPDATE_TOKEN_VALUE = 'GAME/UPDATE_TOKEN_VALUE'\nexport const TOGGLE_TOKEN_VALUE = 'GAME/TOGGLE_TOKEN_VALUE'\nexport const SET_TOKEN_ORIGIN = 'GAME/SET_TOKEN_ORIGIN'\nexport const RESET_FOG = 'GAME/RESET_FOG'\nexport const RESET_DRAW = 'GAME/RESET_DRAW'\n\n// metadata\nexport const SET_GAMESETTINGS = 'METADATA/SET_GAMESETTINGS'\nexport const SET_ISHOST = 'METADATA/SET_ISHOST'\nexport const SET_ROOM = 'METADATA/ROOM'\nexport const SET_CURSORS = 'METADATA/SET_CURSORS'\nexport const SET_LAST_COORDINATES = 'METADATA/SET_LAST_COORDINATES'\nexport const SET_DOWN_COORDINATES = 'METADATA/SET_DOWN_COORDINATES'\n\n// controlpanel\n//TODO: Add control panel actions\n","import { \n    CHANGE_CURSORSIZE,\n    CHANGE_FOG_SETTINGS,\n    CHANGE_DRAW_SETTINGS, \n    CHANGE_TOOL,\n    CHANGE_USERNAME,\n    TOGGLE_MOUSESHARING \n} from '../redux/constants'\n\nconst initialSettingsState = () => {\n    const params = new URLSearchParams(window.location.href.replace(/.*\\?/, ''))\n    return {\n        cursorSize: 50,\n        fogOpacity: 0.5,\n        fogRadius: 75,\n        drawColor: 'white',\n        drawSize: 8,\n        tool: 'move',\n        subtool: undefined,\n        username: params.get('host') ? 'DM' : 'PC',\n        shareMouse: true,\n    }\n}\n\nconst settingsReducer = (state = initialSettingsState(), action) => {\n    switch (action.type) {\n        case CHANGE_CURSORSIZE:\n            return {\n                ...state,\n                cursorSize: action.cursorSize,\n            }\n        case CHANGE_FOG_SETTINGS:\n            return {\n                ...state,\n                fogOpacity: action.fogOpacity,\n                fogRadius: action.fogRadius,\n            }\n        case CHANGE_DRAW_SETTINGS:\n            return {\n                ...state,\n                drawColor: action.drawColor,\n                drawSize: action.drawSize,\n            }\n        case CHANGE_TOOL:\n            return {\n                ...state,\n                tool: action.tool,\n                subtool: action.subtool,\n            }\n        case CHANGE_USERNAME:\n            return {\n                ...state,\n                username: action.username,\n            }\n        case TOGGLE_MOUSESHARING:\n            return {\n                ...state,\n                shareMouse: !state.shareMouse,\n            }\n        default:\n            return state\n    }\n}\n\n//#region Action Creators\nexport const setCursorSize = (newCursorSize) => {\n    return {\n        type: CHANGE_CURSORSIZE,\n        cursorSize: parseInt(newCursorSize),\n    }\n}\n\nexport const setFogToolSettings = (newFogOpacity, newFogRadius) => {\n    return {\n        type: CHANGE_FOG_SETTINGS,\n        fogOpacity: newFogOpacity,\n        fogRadius: parseInt(newFogRadius),\n    }\n}\n\nexport const setDrawToolSettings = (newDrawColor, newDrawSize) => {\n    return {\n        type: CHANGE_DRAW_SETTINGS,\n        drawColor: newDrawColor,\n        drawSize: parseInt(newDrawSize),\n    }\n}\n\nexport const setToolSettings = (newTool, newSubtool) => {\n    return {\n        type: CHANGE_TOOL,\n        tool: newTool,\n        subtool: newSubtool,\n    }\n}\n\nexport const setUsername = (newUsername) => {\n    return {\n        type: CHANGE_USERNAME,\n        username: newUsername,\n    }\n}\n\nexport const toggleMousesharing = () => {\n    return {\n        type: TOGGLE_MOUSESHARING,\n    }\n}\n//#endregion Action Creators\n\nexport default settingsReducer\n","import { \n    SET_GAMESETTINGS,\n    /* SET_ISHOST,\n    SET_ROOM,*/\n    SET_CURSORS,\n    SET_LAST_COORDINATES,\n    SET_DOWN_COORDINATES \n} from '../redux/constants'\n\nconst initialMetadataState = {\n    isHost: undefined,\n    room: undefined,\n    cursors: [],\n    lastX: undefined,\n    lastY: undefined,\n    downX: undefined,\n    downY: undefined,\n}\n\nconst metadataReducer = (state = initialMetadataState, action) => {\n    switch (action.type) {\n        case SET_GAMESETTINGS:\n            return {\n                ...state,\n                isHost: action.isHost,\n                room: action.room,\n            }\n        //TODO: Delete if unused\n        /*\n        case SET_ISHOST:\n            return {\n                ...state,\n                isHost: action.isHost,\n            }\n        case SET_ROOM:\n            return {\n                ...state,\n                room: action.room,\n            }\n        */\n       case SET_CURSORS:\n           return {\n               ...state,\n               cursors: action.cursors,\n           }\n        case SET_LAST_COORDINATES:\n            return {\n                ...state,\n                lastX: action.lastX,\n                lastY: action.lastY,\n            }\n        case SET_DOWN_COORDINATES:\n            return {\n                ...state,\n                downX: action.downX,\n                downY: action.downY,\n            }\n        default:\n            return state\n    }\n}\n\n//#region Action Creators\nexport const setGameSettings = (newIsHost, newRoom) => {\n    return {\n        type: SET_GAMESETTINGS,\n        isHost: newIsHost,\n        room: newRoom,\n    }\n}\n\n//TODO: Delete if unused\n/*\nexport const setIsHost = (newIsHost) => {\n    return {\n        type: SET_ISHOST,\n        isHost: newIsHost,\n    }\n}\n\nexport const setRoom = (newRoom) => {\n    return {\n        type: SET_ROOM,\n        room: newRoom,\n    }\n}\n*/\n\nexport const setCursors = (newCursors) => {\n    return {\n        type: SET_CURSORS,\n        cursors: newCursors,\n    }\n}\n\nexport const setLastCoordinates = (newLastX, newLastY) => {\n    return {\n        type: SET_LAST_COORDINATES,\n        lastX: newLastX,\n        lastY: newLastY,\n    }\n}\n\nexport const setDownCoordinates = (newDownX, newDownY) => {\n    return {\n        type: SET_DOWN_COORDINATES,\n        downX: newDownX,\n        downY: newDownY,\n    }\n}\n//#endregion Action Creators\n\nexport default metadataReducer\n","const guid = () => {\n\treturn 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n\t\tconst r = (window.crypto.getRandomValues(new Uint32Array(1))[0] * Math.pow(2,-32) * 16) | 0\n\t\tconst v = c === 'x' ? r : (r & 0x3 | 0x8) /* eslint-disable-line no-mixed-operators */\n\t\treturn v.toString(16)\n\t})\n}\nexport default guid\n","import {\n    OVERWRITE_GAME,\n    LOAD_MAP, \n    INCREMENT_GEN, \n    SET_FOG_ENABLED,\n    SET_ISFIRSTLOADDONE, \n    SET_ISFOGLOADED, \n    UPDATE_MAPS, \n    ADD_MAP,\n    DELETE_MAP,\n    UPDATE_TOKENS,\n    ADD_TOKEN,\n    DELETE_TOKEN,\n    COPY_TOKEN,\n    UPDATE_TOKEN_VALUE,\n    TOGGLE_TOKEN_VALUE,\n    SET_TOKEN_ORIGIN,\n    RESET_FOG,\n    RESET_DRAW\n} from '../redux/constants'\nimport guid from '../controllers/guid.js'\n\nconst initialGameState = {\n    mapId: undefined,\n    gen: 0,\n    width: window.innerWidth,\n    height: window.innerHeight,\n    fogEnabled: false,\n    isFogLoaded: false,\n    isFirstLoadDone: false, /* Ensure we don't overwrite localStorage before load is done */\n    maps: [],\n    tokens: [],\n}\n\nconst defaultGameState = {\n    ...initialGameState,\n    mapId: 0,\n    isFogLoaded: true,\n    isFirstLoadDone: true,\n    width: 795,\n    height: 555,\n    maps: [{\n        name: 'Dragon\\'s Lair',\n        $id: 0,\n        imageUrl: 'https://mk0a2minutetabl7hq7i.kinstacdn.com/wp-content/uploads/2022/02/Arena-of-Fire-battle-map-Main-preview-Night.jpg',\n        x: 0,\n        y: 0,\n        width: 795,\n        height: 555,\n        drawPaths: [],\n        fogPaths: [],\n    },\n    {\n        name: 'Mage Tower',\n        $id: 1,\n        imageUrl: 'https://2minutetabletop.com/wp-content/uploads/2022/01/Wizarding-School-Classroom-Basic-Light-16x22-1.jpg',\n        x: 0,\n        y: 0,\n        width: 795,\n        height: 555,\n        drawPaths: [],\n        fogPaths: [],\n    }],\n    tokens: [{\n        guid: guid(),\n        name: 'Adult Black Dragon',\n        url: 'https://i.imgur.com/H2dyKur.png',\n        mapId: 0,\n        $selected: false,\n        $x0: 0,\n        $y0: 0,\n        x: 350,\n        y: 210,\n        ko: false,\n        pc: false,\n        width: 100,\n        height: 100,\n    },\n    {\n        guid: guid(),\n        name: 'Mighty Paladin',\n        url: 'https://i.imgur.com/ccQxtZ7.png',\n        mapId: 0,\n        $selected: false,\n        $x0: 0,\n        $y0: 0,\n        x: 50,\n        y: 180,\n        ko: false,\n        pc: true,\n        width: 50,\n        height: 50,       \n    },\n    {\n        guid: guid(),\n        name: 'Misterious Wizard',\n        url: 'https://i.imgur.com/82s9UPR.png',\n        mapId: 1,\n        $selected: false,\n        $x0: 0,\n        $y0: 0,\n        x: 620,\n        y: 250,\n        ko: false,\n        pc: false,\n        width: 50,\n        height: 50,        \n    }]\n}\n\nconst gameReducer = (state = initialGameState, action) => {\n    const maps = JSON.parse(JSON.stringify(state.maps))\n    const tokens = JSON.parse(JSON.stringify(state.tokens))\n    switch (action.type) {\n        case OVERWRITE_GAME:\n            return {\n                ...state,\n                ...action.game,\n            }\n        case LOAD_MAP:\n            return {\n                ...state,\n                mapId: parseInt(action.mapId),\n            }\n        case INCREMENT_GEN:\n            return {\n                ...state,\n                gen: state.gen + 1,\n            }\n        case SET_FOG_ENABLED:\n            return {\n                ...state,\n                fogEnabled: action.fogEnabled,\n            }\n        case SET_ISFOGLOADED:\n            return {\n                ...state,\n                isFogLoaded: action.isFogLoaded,\n            }\n        case SET_ISFIRSTLOADDONE:\n            return {\n                ...state,\n                isFirstLoadDone: action.isFirstLoadDone,\n            }\n        case UPDATE_MAPS:\n            return {\n                ...state,\n                maps: action.maps,\n                mapId: !isNaN(state.mapId) ? state.mapId : undefined,\n            }\n        case ADD_MAP:\n            const newMapId = state.maps.length\n            const mapsWithNewMap = maps.concat({\n                ...action.map,\n                $id: newMapId,\n            })\n            return {\n                ...state,\n                maps: mapsWithNewMap,\n                mapId: !isNaN(state.mapId) ? state.mapId : newMapId,\n                isFirstLoadDone: true,\n                isFogLoaded: true,\n            }\n        case DELETE_MAP:\n\t\t\tconst newMaps = maps.filter((map) => map.$id !== parseInt(action.mapId))\n            return {\n                ...state,\n                maps: newMaps,\n                mapId: parseInt(action.mapId) === state.mapId ? undefined : state.mapId,\n            }\n        case UPDATE_TOKENS:\n            return {\n                ...state,\n                tokens: action.tokens,\n            }\n        case ADD_TOKEN:\n            return {\n                ...state,\n                tokens: state.tokens.concat(action.token)\n            }\n        case DELETE_TOKEN:\n            const newTokens = tokens.filter((token) => token.guid !== action.tokenGuid)\n            return {\n                ...state,\n                tokens: newTokens,\n            }\n        case COPY_TOKEN:\n            const tokenCopy = state.tokens.filter((token) => token.guid === action.tokenGuid)\n            const newToken = {\n                ...tokenCopy[0],\n                guid: guid()\n            }\n            return {\n                ...state,\n                tokens: state.tokens.concat(newToken)\n            }\n        case UPDATE_TOKEN_VALUE:\n            const tokensCopy = state.tokens.map((token) => {\n                return token.guid !== action.tokenGuid ? token : {\n                    ...token,\n                    [action.key]: action.value\n                }\n            })\n            return {\n                ...state,\n                tokens: tokensCopy,\n            }\n        case TOGGLE_TOKEN_VALUE:\n            const tokensCopy2 = state.tokens.map((token) => {\n                return token.guid !== action.tokenGuid ? token : {\n                    ...token,\n                    [action.key]: !token[action.key]\n                }\n            })\n            return {\n                ...state,\n                tokens: tokensCopy2,\n            }\n        case SET_TOKEN_ORIGIN:\n            console.log('setting token origin')\n            const tokensCopy3 = state.tokens.map((token) => {\n                return token.guid !== action.tokenGuid ? token : {\n                    ...token,\n                    $x0: action.xOrigin,\n                    $y0: action.yOrigin,\n                }\n            })\n            return {\n                ...state,\n                tokens: tokensCopy3,\n            }\n        case RESET_FOG:\n\t\t\tconst fogResetMaps = state.maps.map((map) => {\n                return map.$id === state.mapId ? {\n                        ...map,\n                        fogPaths: [],\n                    } \n                    : map\n                })\n            return {\n                ...state,\n                maps: fogResetMaps,\n            }\n        case RESET_DRAW:\n            const drawResetMaps = state.maps.map((map) => {\n                return map.$id === state.mapId ? {\n                        ...map,\n                        drawPaths: [],\n                    } \n                    : map\n                })\n            return {\n                ...state,\n                maps: drawResetMaps,\n            }\n        default:\n            return state\n    }\n}\n\n//#region Action Creators\nexport const overwriteGame = (newGame) => {\n    return {\n        type: OVERWRITE_GAME,\n        game: newGame,\n    }\n}\n\nexport const loadDefaultBattleGame = () => {\n    return {\n        type: OVERWRITE_GAME,\n        game: defaultGameState,\n    }\n}\n\nexport const loadMap = (newMapId) => {\n    return {\n        type: LOAD_MAP,\n        mapId: parseInt(newMapId),\n    }\n}\n\nexport const incrementGen = () => {\n    return {\n        type: INCREMENT_GEN,\n    }\n}\n\nexport const setFogEnabled = (newFogEnabled) => {\n    return {\n        type: SET_FOG_ENABLED,\n        fogEnabled: newFogEnabled,\n    }\n}\n\nexport const setIsFogLoaded = (newIsFogLoaded) => {\n    return {\n        type: SET_ISFOGLOADED,\n        isFogLoaded: newIsFogLoaded,\n    }\n}\n\nexport const setIsFirstLoadDone = (newIsFirstLoadDone) => {\n    return {\n        type: SET_ISFIRSTLOADDONE,\n        isFirstLoadDone: newIsFirstLoadDone,\n    }\n}\n\nexport const updateMaps = (newMaps) => {\n    return {\n        type: UPDATE_MAPS,\n        maps: newMaps,\n    }\n}\n\nexport const addMap = (mapName, width, height) => {\n    const newMap = {\n        name: mapName,\n        $id: 0,\n        imageUrl: '',\n        x: 0,\n        y: 0,\n        width: width,\n        height: height,\n        drawPaths: [],\n        fogPaths: [],\n    }\n\n    return {\n        type: ADD_MAP,\n        map: newMap,\n    }\n}\n\nexport const deleteMap = (mapIdToDelete) => {\n    return {\n        type: DELETE_MAP,\n        mapId: mapIdToDelete,\n    }\n}\n\nexport const updateTokens = (newTokens) => {\n    return {\n        type: UPDATE_TOKENS,\n        tokens: newTokens,\n    }\n}\n\nexport const addToken = (tokenName, tokenUrl, mapId) => {\n    const newToken = {\n        guid: guid(),\n        name: tokenName,\n        url: tokenUrl,\n        mapId: mapId,\n        $selected: false,\n        $x0: 0,\n        $y0: 0,\n        x: 0,\n        y: 0,\n        ko: false,\n        pc: false,\n        w: 0,\n        h: 0,\n    }\n\n    return {\n        type: ADD_TOKEN,\n        token: newToken,\n    }\n}\n\nexport const deleteToken = (tokenGuidToDelete) => {\n    return {\n        type: DELETE_TOKEN,\n        tokenGuid: tokenGuidToDelete,\n    }\n}\n\nexport const copyToken = (tokenGuidToCopy) => {\n    return {\n        type: COPY_TOKEN,\n        tokenGuid: tokenGuidToCopy,\n    }\n}\n\nexport const updateTokenValue = (tokenGuidToUpdate, key, value) => {\n    return {\n        type: UPDATE_TOKEN_VALUE,\n        tokenGuid: tokenGuidToUpdate,\n        key: key,\n        value: value,\n    }\n}\n\nexport const toggleTokenValue = (tokenGuidToUpdate, key) => {\n    return {\n        type: TOGGLE_TOKEN_VALUE,\n        tokenGuid: tokenGuidToUpdate,\n        key: key,\n    }\n}\n\nexport const setTokenOrigin = (tokenGuidToUpdate, xOrigin, yOrigin) => {\n    return {\n        type: SET_TOKEN_ORIGIN,\n        tokenGuid: tokenGuidToUpdate,\n        xOrigin: parseInt(xOrigin),\n        yOrigin: parseInt(yOrigin),\n    }\n}\n\nexport const resetFog = () => {\n    return {\n        type: RESET_FOG,\n    }\n}\n\nexport const resetDraw = () => {\n    return {\n        type: RESET_DRAW,\n    }\n}\n//#endregion Action Creators\n\nexport default gameReducer\n","import { useContext } from \"react\";\nimport { WebSocketContext } from \"../contexts/WebSocketProvider\";\n\nexport const useWebSocket = () => {\n    const webSocket = useContext(WebSocketContext)\n    return webSocket\n}\n\nconst sendData = (webSocket, data) => {\n    if (webSocket && webSocket.readyState === WebSocket.OPEN)\n        webSocket.send(JSON.stringify(data))\n    else\n        console.error('no websocket')\n}\n\nexport const pushCursor = (webSocket, wsSettings, x, y, username) => {\n    sendData(webSocket, {\n        type: 'pushCursor',\n        from: wsSettings.guid,\n        username: wsSettings.username,\n        x: x,\n        y: y,\n    })\n}\n\nexport const pushDrawPath = (webSocket, wsSettings, newDrawPath) => {\n    sendData(webSocket, {\n        type: 'pushDrawPath',\n        from: wsSettings.guid,\n        username: wsSettings.username,\n        drawPath: newDrawPath,\n    })\n}\n\nexport const pushDrawReset = (webSocket, wsSettings) => {\n    sendData(webSocket, {\n        type: 'pushDrawReset',\n        from: wsSettings.guid,\n        username: wsSettings.username,\n    })\n}\n\nexport const pushFogPath = (webSocket, wsSettings, newFogPath) => {\n    sendData(webSocket, {\n        type: 'pushFogPath',\n        from: wsSettings.guid,\n        username: wsSettings.username,\n        fogPath: newFogPath,\n    })\n}\n\nexport const pushFogReset = (webSocket, wsSettings) => {\n    sendData(webSocket, {\n        type: 'pushFogReset',\n        from: wsSettings.guid,\n        username: wsSettings.username,\n    })\n}\n\nexport const pushMapState = (webSocket, wsSettings, maps, mapId) => {\n    sendData(webSocket, {\n        type: 'pushMapState',\n        from: wsSettings.guid,\n        username: wsSettings.username,\n        maps: maps,\n        mapId: mapId,\n    })\n}\n\nexport const pushMapId = (webSocket, wsSettings, mapId) => {\n    sendData(webSocket, {\n        type: 'pushMapId',\n        from: wsSettings.guid,\n        username: wsSettings.username,\n        mapId: mapId,\n    })\n}\n\nexport const pushCreateMap = (webSocket, wsSettings, newMapName, newWidth, newHeight) => {\n    sendData(webSocket, {\n        type: 'pushCreateMap',\n        from: wsSettings.guid,\n        mapName: newMapName,\n        width: newWidth,\n        height: newHeight,\n    })\n}\n\nexport const pushFogEnabled = (webSocket, wsSettings, newFogEnabled) => {\n    sendData(webSocket, {\n        type: 'pushFogEnabled',\n        from: wsSettings.guid,\n        fogEnabled: newFogEnabled,\n    })\n}\n\nexport const pushGameRefresh = (webSocket, wsSettings, game, additionalAttributes) => {\n    sendData(webSocket, {\n        type: 'pushGameRefresh',\n        from: wsSettings.guid,\n        username: wsSettings.username,\n        game: game,\n        ...additionalAttributes,\n    })\n}\n\nexport const pushSingleToken = (webSocket, wsSettings, token) => {\n    sendData(webSocket, {\n        type: 'pushSingleToken',\n        from: wsSettings.guid,\n        token: token,\n    })\n}\n\nexport const pushTokens = (webSocket, wsSettings, tokens) => {\n    sendData(webSocket, {\n        type: 'pushTokens',\n        from: wsSettings.guid,\n        tokens: tokens,\n    })\n}\n\nexport const requestRefresh = (webSocket, wsSettings) => {\n    sendData(webSocket, {\n        type: 'requestRefresh',\n        from: wsSettings.guid,\n        username: wsSettings.username,\n    })\n}\n","import React, { useEffect, useState, createContext } from 'react'\nimport { connect } from 'react-redux'\nimport { requestRefresh } from '../hooks/useSocket.js'\nimport guid from '../controllers/guid.js'\nrequire('dotenv').config()\n\nconst DEBUG_MODE = process.env.NODE_ENV === 'production' ? false : true\nconst SOCKET_RECONNECTION_TIMEOUT = 2500\nconst SOCKET_SERVER_PORT = process.env.PORT || process.env.REACT_APP_PORT || 8000\n\nconst generateWebSocketUrl = (room, guid) => {\n    let host = window.location.host.replace(/:\\d+$/, '')\n\tconst protocol = /https/.test(window.location.protocol) ? 'wss' : 'ws'\n\n    return DEBUG_MODE\n        ? `${protocol}://${host}:${SOCKET_SERVER_PORT}/${room}?guid=${guid}`\n        : `${protocol}://${host}/${room}?guid=${guid}`\n}\n\nconst createWebSocket = (room, guid) => {\n\tif (room) {\n\t\tconst webSocketUrl = generateWebSocketUrl(room, guid)\n\t\treturn new WebSocket(webSocketUrl)\n\t} else {\n\t\treturn undefined\n\t}\n}\n\nexport const WebSocketContext = createContext(createWebSocket('',''))\n\nconst WebSocketProvider = ({ children, metadata }) => {\n    const [wsSettings, setWsSettings] = useState({\n        guid: guid(),\n        username: '',\n    })\n    const [ws, setWs] = useState(createWebSocket(metadata.room, wsSettings.guid))\n\n\tuseEffect(() => {\n\t\tsetWs(createWebSocket(metadata.room, wsSettings.guid))\n\t}, [metadata.room, wsSettings.guid])\n\n    useEffect(() => {\n        const onClose = () => {\n            setTimeout(() => {\n\t\t\t\tconsole.log('Socket Timeout, recreating WebSocket')\n                setWs(createWebSocket(metadata.room, wsSettings.guid))\n            }, SOCKET_RECONNECTION_TIMEOUT)\n        }\n\n        const onOpen = () => {\n            if (!metadata.isHost) {\n                requestRefresh(ws, wsSettings)\n            }\n        }\n\n\t\tconst onError = (err) => {\n\t\t\tconsole.error('WebSocket could not be created. Error: ',err)\n\t\t}\n\n\t\tif (ws) {\n\t\t\tws.addEventListener('close', onClose)\n\t\t\tws.addEventListener('open', onOpen)\n\t\t\tws.addEventListener('error', onError)\n\t\t}\n\n        return () => {\n\t\t\tif (ws) {\n\t\t\t\tws.removeEventListener('close', onClose)\n\t\t\t\tws.removeEventListener('open', onOpen)\n\t\t\t\tws.removeEventListener('error', onError)\n\t\t\t}\n        }\n    }, [ ws, setWs, wsSettings, metadata ])\n\n    return (\n        <WebSocketContext.Provider value={ [ws, wsSettings, setWsSettings] }>{ children }</WebSocketContext.Provider>\n    )\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tmetadata: state.metadata,\n\t}\n}\n\nexport default connect(mapStateToProps, undefined)(WebSocketProvider)\n","const drawImage = (url, which, map, context, resizeCanvases) => {\n\t// Handle 'whiteboard' (no bg img)\n\tif (!url || url.trim().length === 0) {\n\t\tif (resizeCanvases) {\n\t\t\tresizeCanvases()\n\t\t} // Clear canvas\n\t\treturn Promise.resolve(map.width, map.height)\n\t}\n\n\t//Handle ordinary image\n\treturn new Promise((resolve, reject) => {\n\t\tconst ctx = context\n\t\tconst img = new Image()\n\t\timg.onload = () => {\n\t\t\tlet w = map.width\n\t\t\tlet h = map.height\n\t\t\tif (!w && !h) {\n\t\t\t\tw = img.width\n\t\t\t\th = img.height\n\t\t\t} else if (!w)\n\t\t\t\tw = h * img.width / img.height\n\t\t\telse if (!h)\n\t\t\t\th = w * img.height / img.width\n\t\t\tconst promise = resizeCanvases ? resizeCanvases(w, h) : Promise.resolve()\n\t\t\tpromise.then(() => {\n\t\t\t\tctx.drawImage(img, map.x || 0, map.y || 0, w, h)\n\t\t\t\tresolve(w, h)\n\t\t\t})\n\t\t}\n\t\timg.onerror = (err) => {\n\t\t\tconsole.error(`Unable to draw image.`, img.src)\n\t\t\treject(`Unable to draw ${which}Url`)\n\t\t}\n\t\timg.src = url\n\t})\n}\n\nexport default drawImage\n","import { useRef, useEffect } from 'react'\n\nconst useCanvas = (draw, gameState, options={}) => {\n\tconst canvasRef = useRef(null)\n\n\tuseEffect(() => {\n\t\tconst canvas = canvasRef.current\n\t\tconst context = canvas.getContext(options.context || '2d')\n\t\t\n\t\tdraw(context)\n\t}, [draw]) // eslint-disable-line react-hooks/exhaustive-deps\n\n\treturn canvasRef\n}\nexport default useCanvas\n","import React from 'react'\nimport useCanvas from '../hooks/useCanvas.js'\n\nconst Canvas = ({ id, draw, options, ...rest }) => {\n\tconst canvasRef = useCanvas(draw)\n\t\n\treturn (\n\t\t<canvas id={ id } ref={ canvasRef } { ...rest } />\n\t)\n}\n\nexport default Canvas\n","import React from 'react'\nimport { connect } from 'react-redux'\nimport { updateTokens } from '../reducers/gameReducer'\nimport drawImage from '../controllers/drawImage.js'\nimport Canvas from './Canvas.js'\n\n\nconst Background = ({ game, updateTokens }) => {\n\tconst map = game.maps ? game.maps[game.mapId] : undefined\n\n\tconst draw = (ctx) => {\n\t\tif (!map) {\n\t\t\treturn\n\t\t}\n\t\tdrawImage(map.imageUrl, map.name, map, ctx, null)\n\t}\n\n\tconst handleOnClick = (e) => {\n\t\tconst deselectedTokens = game.tokens.map((token) => {\n\t\t\treturn !token.$selected ? token : {\n\t\t\t\t...token,\n\t\t\t\t$selected: false,\n\t\t\t}\n\t\t})\n\t\tupdateTokens(deselectedTokens)\n\t}\n\n\treturn (\n\t\t<Canvas \n\t\t\tid='background' \n\t\t\tonClick={ handleOnClick } \n\t\t\twidth={ map ? map.width : 0 } \n\t\t\theight={ map ? map.height : 0 } \n\t\t\tdraw={ draw } />\n\t)\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tgame: state.game,\n\t}\n}\n\nconst mapDispatchToProps = {\n\tupdateTokens,\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Background)\n","import React from 'react'\nimport { connect } from 'react-redux'\nimport Canvas from './Canvas.js'\n\nconst Drawing = ({ game }) => {\n\tconst width = game.width\n\tconst height = game.height\n\n\tconst getMap = () => {\n\t\tif (game.maps.length === 0)\n\t\t\treturn undefined\n\t\tconst currMap = game.maps.filter((map) => parseInt(map.$id) === parseInt(game.mapId))\n\t\treturn currMap.length > 0 ? currMap[0] : game.maps[0]\n\t}\n\tconst map = getMap()\n\n\tconst renderDrawingLayer = (ctx) => {\n\t\tif (!map) {\n\t\t\treturn\n\t\t}\n\t\tif (!ctx)\n\t\t\treturn\n\t\t\n\t\tctx.beginPath()\n\t\tctx.clearRect(0, 0, width, height)\n\t\tfor(let pathId = 0; pathId < map.drawPaths.length; pathId++) {\n\t\t\tconst currPath = map.drawPaths[pathId]\n\t\t\tconst tool = currPath.length > 0 ? currPath[0].tool : ''\n\t\t\tswitch (tool) {\n\t\t\t\tcase 'draw': \n\t\t\t\t\tdraw(ctx, currPath)\n\t\t\t\t\tbreak\n\t\t\t\tcase 'erease':\n\t\t\t\t\terease(ctx, currPath)\n\t\t\t\t\tbreak\n\t\t\t\tdefault:\n\t\t\t\t\tbreak\n\t\t\t}\n\t\t\tctx.stroke()\n\t\t}\n\t}\n\n\tconst draw = (ctx, currPath) => {\n\t\tctx.globalCompositeOperation = 'source-over'\n\t\tctx.beginPath()\n\t\tfor (let pointId = 0; pointId < currPath.length; pointId++) {\n\t\t\tctx.lineCap = 'round'\n\t\t\tctx.fillStyle = currPath[pointId].drawColor\n\t\t\tctx.lineWidth = currPath[pointId].drawSize\n\t\t\tctx.strokeStyle = currPath[pointId].drawColor\n\t\t\tif (pointId === 0) {\n\t\t\t\tctx.moveTo(currPath[pointId].x, currPath[pointId].y)\n\t\t\t} else {\n\t\t\t\tctx.lineTo(currPath[pointId].x, currPath[pointId].y)\n\t\t\t}\n\t\t}\n\t}\n\n\tconst erease = (ctx, currPath) => {\n\t\tctx.globalCompositeOperation = 'destination-out'\n\t\tctx.beginPath()\n\t\tfor (let pointId = 0; pointId < currPath.length; pointId++) {\n\t\t\tctx.lineCap = 'round'\n\t\t\tctx.lineWidth = currPath[pointId].drawSize\n\t\t\tif (pointId === 0) {\n\t\t\t\tctx.moveTo(currPath[pointId].x, currPath[pointId].y)\n\t\t\t} else {\n\t\t\t\tctx.lineTo(currPath[pointId].x, currPath[pointId].y)\n\t\t\t}\n\t\t}\n\t}\n\t\n\treturn (\n\t\t<Canvas \n\t\t\tid='drawing' \n\t\t\tclassName='passthrough' \n\t\t\twidth={ width } \n\t\t\theight={ height } \n\t\t\tdraw={ renderDrawingLayer } />\n\t)\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tgame: state.game,\n\t}\n}\n\nexport default connect(mapStateToProps, undefined)(Drawing)\n","import React from 'react'\nimport { connect } from 'react-redux'\nimport Canvas from './Canvas.js'\n\nconst Fog = ({ game, metadata, settings }) => {\n\tconst fogOpacity = metadata.isHost ? settings.fogOpacity : 1\n\tconst width = game.width\n\tconst height = game.height\n\n\tconst getMap = () => {\n\t\tif (game.maps.length === 0)\n\t\t\treturn undefined\n\t\tconst currMap = game.maps.filter((map) => parseInt(map.$id) === parseInt(game.mapId))\n\t\treturn currMap.length > 0 ? currMap[0] : game.maps[0]\n\t}\n\tconst map = getMap()\n\n\tconst renderFogLayer = (ctx) => {\n\t\tif (!map) {\n\t\t\treturn\n\t\t}\n\t\tif (!ctx)\n\t\t\treturn\n\t\t\n\t\tctx.beginPath()\n\t\tctx.globalCompositeOperation = 'destination-over'\n\t\tctx.fillStyle = 'black'\n\t\tctx.fillRect(0, 0, width, height)\n\t\tfor(let pathId = 0; pathId < map.fogPaths.length; pathId++) {\n\t\t\tconst currPath = map.fogPaths[pathId]\n\t\t\tereaseFog(ctx, currPath)\n\t\t\tctx.stroke()\n\t\t}\n\t}\n\n\tconst ereaseFog = (ctx, currPath) => {\n\t\tctx.beginPath()\n\t\tctx.globalCompositeOperation = 'destination-out'\n\t\tlet gradient\n\t\tfor (let pointId = 0; pointId < currPath.length; pointId++) {\n\t\t\tgradient = ctx.createRadialGradient(currPath[pointId].x, currPath[pointId].y, currPath[pointId].r2 || 1, currPath[pointId].x, currPath[pointId].y, currPath[pointId].r*0.75)\n\t\t\tgradient.addColorStop(0, 'rgba(0,0,0,255)')\n\t\t\tgradient.addColorStop(1, 'rgba(0,0,0,0)')\n\t\t\tctx.fillStyle = gradient\n\t\t\tctx.fillRect(currPath[pointId].x-currPath[pointId].r, currPath[pointId].y-currPath[pointId].r, currPath[pointId].x+currPath[pointId].r, currPath[pointId].y+currPath[pointId].r)\n\t\t}\n\t}\n\n\treturn (\n\t\tgame.fogEnabled ?\n\t\t\t<Canvas \n\t\t\t\tid='fog' \n\t\t\t\tclassName='passthrough' \n\t\t\t\tstyle={{ opacity: fogOpacity }} \n\t\t\t\twidth={ width } \n\t\t\t\theight={ height } \n\t\t\t\tdraw={ renderFogLayer } />\n\t\t\t: null\n\t)\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tgame: state.game,\n\t\tsettings: state.settings,\n\t\tmetadata: state.metadata,\n\t}\n}\n\nexport default connect(mapStateToProps, undefined)(Fog)\n","import React from 'react';\nimport { connect } from 'react-redux'\n\nconst Overlay = ({ game, overlayRef }) => {\n\tconst maps = game.maps\n\tconst map = maps[game.mapId] || undefined\n\tconst width = map ? map.width : game.width\n\tconst height = map ? map.height : game.height\n\tconst canvasRef = overlayRef\n\n\treturn (\n\t\t<canvas \n\t\t\tid='overlay' \n\t\t\tref={ canvasRef } \n\t\t\twidth={ width } \n\t\t\theight={ height } />\n\t)\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tgame: state.game,\n\t}\n}\n\nexport default connect(mapStateToProps, undefined)(Overlay)\n","const TokenView = ({ divStyle, token, classes, imgStyle, onMouseUp, onMouseDown }) => {\n\treturn (\n\t\t<div style={ divStyle } title={ token.name } className={ classes.join(' ') } onMouseDown={ (e) => onMouseDown(e) }>\n\t\t\t<img src={ token.url } alt={ token.name ||'' } style={ imgStyle } />\n\t\t</div>\n\t)\n}\n\nexport default TokenView\n","import React from 'react'\nimport { connect } from 'react-redux'\nimport { setTokenOrigin, toggleTokenValue } from '../reducers/gameReducer'\nimport TokenView from '../views/TokenView.js'\n\nconst Token = ({ token, isHost, game, settings, toggleTokenValue, setTokenOrigin }) => {\n\tconst isMoveTool = () => {\n\t\treturn settings.tool === 'move'\n\t}\n\n\tconst onMouseDown = (e) => {\n\t\tif (!isMoveTool())\n\t\t\treturn\n\t\tif (!token.$selected)\n\t\t\ttoggleTokenValue(token.guid, '$selected')\n\t\tsetTokenOrigin(token.guid, token.x, token.y)\n\t}\n\n\tif (!token.url || !token.url.trim())\n\t\treturn null\n\t\n\tconst classes = [\n\t\t'token',\n\t\ttoken.ko && 'dead',\n\t\ttoken.pc ? 'pc' : 'npc',\n\t\ttoken.$selected && 'selected',\n\t\tisHost && !token.pc && 'grabbable',\n\t]\n\tconst divStyle = {\n\t\tleft: token.x || 0,\n\t\ttop: token.y || 0,\n\t}\n\tconst imgStyle = {\n\t\twidth: token.width || undefined,\n\t\theight: token.height || undefined,\n\t}\n\tconst showToken = ((token.mapId === undefined) || (game.mapId === token.mapId))\n\n\treturn (\n\t\tshowToken ?\n\t\t\t<TokenView \n\t\t\t\tdivStyle={ divStyle } \n\t\t\t\ttoken={ token } \n\t\t\t\tclasses={ classes } \n\t\t\t\timgStyle={ imgStyle } \n\t\t\t\tonMouseDown={ onMouseDown }\n\t\t\t/>\n\t\t: null\n\t)\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tgame: state.game,\n\t\tsettings: state.settings,\n\t}\n}\n\nconst mapDispatchToProps = {\n\ttoggleTokenValue,\n\tsetTokenOrigin,\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Token)\n","const Cursor = ({ cursor, size, name }) => {\n\tconst divStyle = {\n\t\ttop: cursor.y,\n\t\tleft: cursor.x,\n\t}\n\tconst imgStyle = {\n\t\tfontSize: size || undefined,\n\t}\n\n\treturn (\n\t\t<div style={ divStyle } className='cursor' >\n\t\t\t<span role='img' aria-label='pointer' style={ imgStyle }>&#x1f5e1;</span>\n\t\t\t{ cursor.u || name }\n\t\t</div>\n\t)\n}\n\nexport default Cursor\n","function Button({ title, value, onClick, isSelected, style, disabled }) {\n\treturn (\n\t\t<button title={ title } onClick={ onClick } className={ isSelected ? 'selected' : null } style={ style } disabled={ disabled }>\n\t\t\t<span role='img' aria-label={ title }>{ value }</span>\n\t\t</button>\n\t)\n}\n\nexport default Button\n","import Button from '../views/Button.js'\n\nfunction ToggleButton({ controlPanelState, setControlPanelState, title, value }) {\n\tconst toggleKey = `toggleOn${title}`\n\tconst onClick = () => {\n\t\tsetControlPanelState({\n\t\t\t...controlPanelState,\n\t\t\t[toggleKey]: !controlPanelState[toggleKey],\n\t\t})\n\t}\n\tconst isSelected = controlPanelState[toggleKey]\n\treturn (\n\t\t<Button title={ title } value={ value } onClick={ onClick } isSelected={ isSelected } />\n\t)\n}\n\nexport default ToggleButton\n","import Button from './Button.js'\n\nconst ToolControlsView = ({ tool, subtool, drawColor, setDrawColor, drawSize, setDrawSize, fogOpacity, setFogOpacity, fogRadius, setFogRadius, setSubtool, resetFog, resetDrawing }) => {\n\tswitch (tool) {\n\t\tcase 'draw':\n\t\t\treturn (\n\t\t\t\t<span>\n\t\t\t\t\t<Button title='eraser' value='&#x1f9fd;' onClick={ () => setSubtool('eraser') } isSelected={ subtool === 'eraser' } />\n\t\t\t\t\t<Button title='pencil' value='&#x1f58d;' onClick={ () => setSubtool('pencil') } isSelected={ subtool === 'pencil' } />\n\t\t\t\t\t<input size='3' title='draw size' value={ drawSize } onChange={ (e) => setDrawSize(e.target.value) } type='number' step='3' min='1' />\n\t\t\t\t\t<input size='3' title='draw color' value={ drawColor } onChange={ (e) => setDrawColor(e.target.value) } />\n\t\t\t\t\t<Button style={{ backgroundColor: drawColor }} value='&#x1f58c;' disabled />\n\t\t\t\t\t<Button title='reset drawing' onClick={ resetDrawing } value='&#x1f300;' />\n\t\t\t\t</span>\n\t\t\t)\n\t\tcase 'move':\n\t\t\treturn null\n\t\tcase 'fog':\n\t\t\treturn (\n\t\t\t\t<span>\n\t\t\t\t\t<Button title='reset fog' onClick={ resetFog } value='&#x1f300;' />\n\t\t\t\t\t<input size='3' title='fog radius' value={ fogRadius } onChange={ (e) => setFogRadius(e.target.value) } type='number' step='5' min='1' />\n\t\t\t\t\t<input size='3' title='fog opacity' step='0.05' min='0' max='1' value={ fogOpacity } onChange={ (e) => setFogOpacity(e.target.value) } type='number' />\n\t\t\t\t</span>\n\t\t\t)\n\t\tdefault:\n\t\t\treturn null\n\t}\n}\n\nexport default ToolControlsView\n","import { connect } from 'react-redux'\nimport { setToolSettings, setDrawToolSettings, setFogToolSettings } from '../reducers/settingsReducer.js'\nimport { resetFog, resetDraw } from '../reducers/gameReducer.js'\nimport ToolControlsView from \"../views/ToolControlsView.js\"\n\nconst ToolControls = ({ settings, setToolSettings, setDrawToolSettings, setFogToolSettings, resetFog, resetDraw }) => {\n\tconst setSubtool = (subtool) => {\n\t\tsetToolSettings(settings.tool, subtool)\n\t}\n\n\tconst setDrawColor = (value) => {\n\t\tsetDrawToolSettings(value, settings.drawSize)\n\t}\n\n\tconst setDrawSize = (value) => {\n\t\tconst newSize = value\n\t\tif (!isNaN(newSize))\n\t\t\tsetDrawToolSettings(settings.drawColor, newSize)\n\t}\n\n\tconst setFogOpacity = (value) => {\n\t\tconst newOpacity = value\n\t\tif (!isNaN(newOpacity))\n\t\t\tsetFogToolSettings(newOpacity, settings.fogRadius)\n\t}\n\n\tconst setFogRadius = (value) => {\n\t\tconst newRadius = value\n\t\tif (!isNaN(newRadius))\n\t\t\tsetFogToolSettings(settings.fogOpacity, newRadius)\n\t}\n\n\tconst resetFogOnCurrentMap = () => {\n\t\tresetFog()\n\t}\n\n\tconst resetDrawOnCurrentMap = () => {\n\t\tresetDraw()\n\t}\n\n\treturn (\n\t\t<span>\n\t\t\t<ToolControlsView \n\t\t\t\ttool={ settings.tool } \n\t\t\t\tsubtool={ settings.subtool } \n\t\t\t\tdrawColor={ settings.drawColor } \n\t\t\t\tsetDrawColor={ setDrawColor } \n\t\t\t\tdrawSize={ settings.drawSize } \n\t\t\t\tsetDrawSize={ setDrawSize } \n\t\t\t\tfogOpacity={ settings.fogOpacity } \n\t\t\t\tsetFogOpacity={ setFogOpacity } \n\t\t\t\tfogRadius={ settings.fogRadius } \n\t\t\t\tsetFogRadius={ setFogRadius } \n\t\t\t\tsetSubtool={ setSubtool } \n\t\t\t\tresetFog={ resetFogOnCurrentMap } \n\t\t\t\tresetDrawing={ resetDrawOnCurrentMap } />\n\t\t</span>\n\t)\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tsettings: state.settings,\n\t}\n}\n\nconst mapDispatchToProps = {\n\tsetToolSettings,\n\tsetDrawToolSettings,\n\tsetFogToolSettings,\n\tresetFog,\n\tresetDraw,\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ToolControls)\n","import Button from './Button.js'\n\nconst MapConfigView = ({ isSelected, mapConfigState, load, onTextChange, onIntegerChange, deleteMap }) => {\n\treturn (\n\t\t<div className={ isSelected ? 'selected' : null }>\n\t\t\t{ mapConfigState.name }\n\t\t\t<input value={ mapConfigState.imageUrl || '' } placeholder='Map url' size='8' onChange={ (e) => onTextChange('imageUrl', e) } />\n\t\t\tw:\n\t\t\t<input value={ mapConfigState.width || 0 } placeholder='width' className='text3' onChange={ (e) => onIntegerChange('width', e) } type='number' min='0' step='10' title='width' />\n\t\t\th:\n\t\t\t<input value={ mapConfigState.height || 0 } placeholder='height' className='text3' onChange={ (e) => onIntegerChange('height', e) } type='number' min='0' step='10' title='height' />\n\t\t\t<Button title='Save & load map' value='&#x1f4c0;' onClick={ load } />\n\t\t\t<Button title='Delete map' value='&#x1f5d1;' onClick={ deleteMap } />\n\t\t</div>\n\t)\n}\n\nexport default MapConfigView\n","import React, { useState } from 'react'\nimport { connect } from 'react-redux'\nimport { loadMap, updateMaps, deleteMap, setIsFogLoaded, setIsFirstLoadDone } from '../reducers/gameReducer.js'\nimport { pushMapState, useWebSocket } from '../hooks/useSocket.js'\nimport MapConfigView from '../views/MapConfigView.js'\n\nconst initialMapConfigState = (map, game) => {\n\tconst existingMap = game.maps.filter((mapElement) => mapElement.$id === map.$id)\n\tconst currentMap = existingMap.length > 0 ? existingMap[0] : { name: undefined, imageUrl: undefined, w: undefined, h: undefined, }\n\n\treturn {\n\t\t$id: parseInt(map.$id),\n\t\tname: currentMap.name ? currentMap.name : map.name,\n\t\timageUrl: currentMap.imageUrl ? currentMap.imageUrl : '',\n\t\twidth: currentMap.width ? currentMap.width : window.innerWidth,\n\t\theight: currentMap.height ? currentMap.height : window.innerHeight,\n\t\tx: 0,\n\t\ty: 0,\t\n\t}\n}\n\nconst MapConfig = ({ map, game, loadMap, updateMaps, deleteMap, setIsFogLoaded, setIsFirstLoadDone }) => {\n\tconst [mapConfigState, setMapConfigState] = useState(initialMapConfigState(map, game))\n\tconst [webSocket, wsSettings] = useWebSocket()\n\tconst isSelected = game.mapId === map.$id\n\n\tconst onTextChange = (key, evt) => {\n\t\tsetMapConfigState({\n\t\t\t...mapConfigState,\n\t\t\t[key]: evt.target.value,\n\t\t})\n\t}\n\n\tconst onIntegerChange = (key, evt) => {\n\t\tconst value = parseInt(evt.target.value) || undefined\n\t\tsetMapConfigState({\n\t\t\t...mapConfigState,\n\t\t\t[key]: value,\n\t\t})\n\t}\n\n\tconst load = () => {\n\t\tconst updatedMaps = game.maps.map((currMap) => {\n\t\t\treturn map.$id === currMap.$id ? { ...currMap, imageUrl: mapConfigState.imageUrl, width: mapConfigState.width, height: mapConfigState.height, } : currMap\n\t\t})\n\t\tupdateMaps(updatedMaps)\n\t\tloadMap(map.$id)\n\t\tsetIsFogLoaded(true)\n\t\tsetIsFirstLoadDone(true)\n\t\tpushMapState(webSocket, wsSettings, updatedMaps, map.$id)\n\t}\n\n\tconst deleteCurrentMap = () => {\n\t\tif (window.confirm('Delete map?')) {\n\t\t\tdeleteMap(map.$id)\n\t\t}\n\t}\n\n\treturn (\n\t\tmap ?\n\t\t\t<MapConfigView \n\t\t\t\tisSelected={ isSelected } \n\t\t\t\tmapConfigState={ mapConfigState }  \n\t\t\t\tload={ load } \n\t\t\t\tonTextChange={ onTextChange } \n\t\t\t\tonIntegerChange={ onIntegerChange } \n\t\t\t\tdeleteMap={ deleteCurrentMap }\n\t\t\t/>\n\t\t: null\n\t)\n}\n\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tgame: state.game,\n\t}\n}\n\nconst mapDispatchToProps = {\n\tloadMap,\n\tupdateMaps,\n\tdeleteMap,\n\tsetIsFogLoaded,\n\tsetIsFirstLoadDone,\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MapConfig)\n","import MapConfig from '../components/MapConfig.js'\nimport Button from './Button.js'\n\nconst MapToolView = ({ maps, newMapName, setNewMapName, createMap }) => {\n\treturn (\n\t\t<div>\n\t\t\t<hr />\n\t\t\t<div>\n\t\t\t<input placeholder='New map name' onChange={ (e) => setNewMapName(e.target.value) } value={ newMapName } />\n\t\t\t<Button title='Create new map' value='&#x2795;' onClick={ createMap } disabled={ newMapName === '' } />\n\t\t\t{ maps.map((map) => (\n\t\t\t\t<MapConfig key={ `map${map.$id}` } map={ map } />\n\t\t\t))}\n\t\t\t</div>\n\t\t</div>\n\t)\n}\n\nexport default MapToolView\n","import { useState } from 'react'\nimport { connect } from 'react-redux'\nimport { pushCreateMap, useWebSocket } from '../hooks/useSocket.js'\nimport { addMap } from '../reducers/gameReducer.js'\nimport MapToolView from '../views/MapToolView.js'\n\nconst MapTool = ({ toggleOnMaps, game, addMap }) => {\n    const [newMapName, setNewMapName] = useState('')\n\tconst [webSocket, wsSettings, _setWsSettings] = useWebSocket()\n\n\tconst maps = game.maps\n\n    const createMap = () => {\n\t\taddMap(newMapName, window.innerWidth, window.innerHeight)\n\t\tsetNewMapName('')\n\t\tpushCreateMap(webSocket, wsSettings, newMapName, window.innerWidth, window.innerHeight)\n\t}\n\n\treturn (\n        toggleOnMaps ?\n\t\t    <MapToolView maps={ maps } newMapName={ newMapName } setNewMapName={ setNewMapName } createMap={ createMap } />\n            : null\n\t)\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tgame: state.game,\n\t}\n}\n\nconst mapDispatchToProps = {\n\taddMap,\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MapTool)\n","import Button from './Button.js'\n\nconst HostTokenConfigView = ({ maps, token, copy, onToggle, selectToken, onTextChange, onIntegerChange, onMapSelect, deleteToken }) => {\n\treturn (\n\t\t<div className='tokenConfig'>\n\t\t\t<Button title='Duplicate token' value='&#x1f46f;' onClick={ copy } />\n\t\t\t<Button value={ token.pc ? '\\u{1f5a5}' : '\\u{1f464}' } onClick={ (e) => onToggle('pc', e) } title='pc/npc' />\n\t\t\t<Button value={ token.$selected ? '\\u{2705}' : '\\u{274C}' } onClick={ (e) => selectToken(token, e) } title='(un)select' />\n\t\t\t<Button value={ token.ko ? '\\u{1f940}' : '\\u{1f339}' } onClick={ (e) => onToggle('ko', e) } title='alive/dead' />\n\t\t\t<input value={ token.name || '' } placeholder='Name' size='8' onChange={ (e) => onTextChange('name', e) } />\n\t\t\t<input value={ token.url || '' } placeholder='Url' size='8' onChange={ (e) => onTextChange('url', e) } />\n\t\t\twh:\n\t\t\t<input value={ token.width || '' } placeholder='w' className='text2' onChange={ (e) => onIntegerChange('width', e) } type='number' step='5' min='0' title='width' />\n\t\t\t<input value={ token.height || '' } placeholder='h' className='text2' onChange={ (e) => onIntegerChange('height', e) } type='number' step='5' min='0' title='height' />\n\t\t\txy:\n\t\t\t<input value={ token.x || '' } placeholder='x' className='text3' onChange={ (e) => onIntegerChange('x', e) } type='number' step='5' title='x coord' />\n\t\t\t<input value={ token.y || '' } placeholder='y' className='text3' onChange={ (e) => onIntegerChange('y', e) } type='number' step='5' title='y coord' />\n\t\t\t<select defaultValue={ token.mapId } onChange={ (e) => onMapSelect(e) } title='which map'>\n\t\t\t\t<option key={ -1 } value={ -1 }>(all)</option>\n\t\t\t\t{ maps.map((map) => (\n\t\t\t\t\t<option key={ map.$id } value={ map.name }>{ maps.name }</option>\n\t\t\t\t))}\n\t\t\t</select>\n\t\t\t<Button title='Delete token' value='&#x1f5d1;' onClick={ deleteToken } />\n\t\t</div>\n\t)\n}\n\nexport default HostTokenConfigView\n","const GuestTokenConfigView = ({ token, onTextChange, onIntegerChange }) => {\n\treturn (\n\t\t<div className='tokenConfig'>\n\t\t\t<input value={ token.name || '' } placeholder='Name' size='8' onChange={ (e) => onTextChange('name', e) } />\n\t\t\t<input value={ token.url || '' } placeholder='Url' size='8' onChange={ (e) => onTextChange('url', e) } />\n\t\t\twh:\n\t\t\t<input value={ token.width || '' } placeholder='w' className='text2' onChange={ (e) => onIntegerChange('width', e) } type='number' step='5' min='0' title='width' />\n\t\t\t<input value={ token.height || '' } placeholder='h' className='text2' onChange={ (e) => onIntegerChange('height', e) } type='number' step='5' min='0' title='height' />\n\t\t\txy:\n\t\t\t<input value={ token.x || '' } placeholder='x' className='text3' onChange={ (e) => onIntegerChange('x', e) } type='number' step='5' title='x coord' />\n\t\t\t<input value={ token.y || '' } placeholder='y' className='text3' onChange={ (e) => onIntegerChange('y', e) } type='number' step='5' title='y coord' />\n\t\t</div>\n\t)\n}\n\nexport default GuestTokenConfigView\n","import React from 'react'\nimport { connect } from 'react-redux'\nimport { deleteToken, copyToken, updateTokenValue, toggleTokenValue, updateTokens } from '../reducers/gameReducer.js'\nimport HostTokenConfig from '../views/HostTokenConfigView.js'\nimport GuestTokenConfigView from '../views/GuestTokenConfigView.js'\n\nconst TokenConfig = ({ token, game, metadata, deleteToken, copyToken, updateTokenValue, toggleTokenValue }) => {\n\tconst selectToken = (token, tokenSelected) => {\n\t\tif (!token.pc && !metadata.isHost)\n\t\t\treturn\n\t\ttoggleTokenValue(token.guid, '$selected')\n\t}\n\n\tconst deleteCurrToken = () => {\n\t\tdeleteToken(token.guid)\n\t}\n\t\n\tconst copy = () => {\n\t\tcopyToken(token.guid)\n\t}\n\n\tconst onMapSelect = (e) => {\n\t\tlet value = parseInt(e.target.value)\n\t\tif (value < 0)\n\t\t\tvalue = undefined\n\t\tupdateTokenValue(token.guid, 'mapId', value)\n\t}\n\n\tconst onToggle = (key) => {\n\t\ttoggleTokenValue(token.guid, key)\n\t}\n\n\tconst onIntegerChange = (key, e) => {\n\t\tupdateTokenValue(token.guid, key, parseInt(e.target.value) || undefined)\n\t}\n\n\tconst onTextChange = (key, e) => {\n\t\tupdateTokenValue(token.guid, key, e.target.value)\n\t}\n\n\treturn (\n\t\t<div>\n\t\t\t{ token ?\n\t\t\t\tmetadata.isHost ?\n\t\t\t\t<HostTokenConfig \n\t\t\t\t\tmaps={ game.maps } \n\t\t\t\t\ttoken={ token } \n\t\t\t\t\tcopy={ copy } \n\t\t\t\t\tonToggle={ onToggle } \n\t\t\t\t\tselectToken={ selectToken } \n\t\t\t\t\tonTextChange={ onTextChange } \n\t\t\t\t\tonIntegerChange={ onIntegerChange } \n\t\t\t\t\tonMapSelect={ onMapSelect } \n\t\t\t\t\tdeleteToken={ deleteCurrToken }\n\t\t\t\t/>\n\t\t\t\t:\n\t\t\t\t<GuestTokenConfigView \n\t\t\t\t\ttoken={ token } \n\t\t\t\t\tonTextChange={ onTextChange } \n\t\t\t\t\tonIntegerChange={ onIntegerChange }\n\t\t\t\t/>\n\t\t\t: null\n\t\t\t}\n\t\t</div>\n\t)\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tgame: state.game,\n\t\tmetadata: state.metadata,\n\t}\n}\n\nconst mapDispatchToProps = {\n\tdeleteToken,\n\tcopyToken,\n\tupdateTokenValue,\n\ttoggleTokenValue,\n\tupdateTokens,\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(TokenConfig)\n","import TokenConfig from '../components/TokenConfig.js'\nimport Button from './Button.js'\n\nconst TokenToolView = ({ newTokenUrl, setNewTokenUrl, createToken, tokens }) => {\n\treturn (\n\t\t<div>\n\t\t\t<hr />\n\t\t\t<input placeholder='New token url' onChange={ (e) => setNewTokenUrl(e.target.value) } value={ newTokenUrl } />\n\t\t\t<Button title='Create new token' value='&#x2795;' onClick={ createToken } />\n\t\t\t{ tokens.map((token, $i) => (\n\t\t\t\t<TokenConfig key={ `token${$i}` } token={ token } />\n\t\t\t))}\n\t\t</div>\n\t)\n}\n\nexport default TokenToolView\n","import TokenConfig from '../components/TokenConfig.js'\n\nconst SelectedTokensControlsView = ({ tokens }) => {\n\tconst filteredTokens = tokens.filter(t => t.$selected)\n\treturn (\n\t\t<div>\n\t\t\t{ filteredTokens.map((token, $i) => (\n\t\t\t\t<TokenConfig key={ `token${$i}` } token={ token } />\n\t\t\t))}\n\t\t</div>\n\t)\n}\n\nexport default SelectedTokensControlsView\n","import { connect } from 'react-redux'\nimport SelectedTokensControlsView from '../views/SelectedTokensControlsView.js'\n\nconst SelectedTokensControls = ({ game }) => {\n\tconst filteredTokens = game.tokens.filter(t => t.$selected)\n\treturn (\n\t\t<SelectedTokensControlsView tokens={ filteredTokens } />\n\t)\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tgame: state.game,\n\t}\n}\n\nexport default connect(mapStateToProps, undefined)(SelectedTokensControls)\n","import { useState } from 'react'\nimport { connect } from 'react-redux'\nimport { addToken } from '../reducers/gameReducer.js'\nimport TokenToolView from '../views/TokenToolView.js'\nimport SelectedTokensControls from './SelectedTokensControls.js'\n\nconst TokenTool = ({ toggleOnTokens, game, addToken, metadata }) => {\n    const [newTokenUrl, setNewTokenUrl] = useState('')\n\n\tif (!metadata.isHost)\n\t\treturn null\n\n    const createToken = () => {\n        if (!newTokenUrl)\n            return\n        addToken(undefined, newTokenUrl, game.mapId)\n        setNewTokenUrl('')\n    }\n\n    return (\n        toggleOnTokens ?\n            <TokenToolView newTokenUrl={ newTokenUrl } setNewTokenUrl={ setNewTokenUrl } createToken={ createToken } tokens={ game.tokens } /> :\n            <SelectedTokensControls tokens={ game.tokens } />\n    )\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tgame: state.game,\n        metadata: state.metadata,\n\t}\n}\n\nconst mapDispatchToProps = {\n\taddToken,\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(TokenTool)\n","import Button from './Button.js'\n\nconst UserToolView = ({ initAsDev, toggleFog, copyJson, pasteJson, username, updateUsername, cursorSize, updateCursorSize }) => {\n\treturn (\n\t\t<div>\n\t\t\t<hr />\n\t\t\t<input title='User name' placeholder='User name' value={ username} onChange={ (e) => updateUsername(e.target.value) } />\n\t\t\t{ /* TODO: enable the mousesharing <ToggleButton title='Share mouse (cursor)' value='&#x1f401;' controlPanelState={ controlPanelState } setControlPanelState={ setControlPanelState } /> */ }\n\t\t\t<input title='Cursor size' value={ cursorSize } onChange={ (e) => updateCursorSize(e.target.value) } type='number' min='0' />\n\t\t\t<hr />\n\t\t\t<Button title='Redo as dev' value='&#x1f530;' onClick={ initAsDev } />\n\t\t\t<Button title='Toggle fog' value='&#127787;' onClick={ toggleFog } />\n\t\t\t<Button title='Copy JSON to clipboard' value='&#x1f46f;' onClick={ copyJson } />\n\t\t\t<Button title='Paste JSON from clipboard' value='&#x1f4cb;' onClick={ pasteJson } />\n\t\t</div>\n\t)\n}\n\nexport default UserToolView\n","import { connect } from 'react-redux'\nimport { loadDefaultBattleGame, setFogEnabled } from '../reducers/gameReducer.js'\nimport { setUsername, setCursorSize, setToolSettings } from '../reducers/settingsReducer.js'\nimport { pushFogEnabled, useWebSocket } from '../hooks/useSocket.js'\nimport UserToolView from '../views/UserToolView.js'\n\nconst UserTool = ({ toggleOnUser, game, settings, setFogEnabled, setUsername, setCursorSize, setToolSettings, loadDefaultBattleGame }) => {\n    const [webSocket, wsSettings, setWsSettings] = useWebSocket()\n\tif (!toggleOnUser)\n\t\treturn null\n\n    const updateUsername = (value) => {\n        setUsername(value)\n        setWsSettings({\n\t\t\t...wsSettings,\n\t\t\tusername: value,\n\t\t})\n    }\n\n    const updateCursorSize = (value) => {\n        const newSize = value\n\t\tif (!isNaN(newSize))\n\t\t\tsetCursorSize(newSize)\n    }\n\n    const initAsDev = () => {\n        loadDefaultBattleGame()\n    }\n\n    const toggleFog = () => {\n        setFogEnabled(!game.fogEnabled)\n        pushFogEnabled(webSocket, wsSettings, !game.fogEnabled)\n        if (settings.tool === 'fog')\n            setToolSettings('move','')\n    }\n\n    const copyJson = () => {\n\t\t//TODO: Implement CopyJson\n\t\t/*\n\t\tconst json = gameState.toJson()\n\t\twindow.navigator.clipboard.writeText(json).then(() => {\n\t\t\tnotify('copied to clipboard')\n\t\t}).catch(err => {\n\t\t\tconsole.error('failed to write to clipboard: ', err)\n\t\t\tnotify(`failed to write to clipboard: ${err}`, 2000)\n\t\t})\n\t\t*/\n\t}\n\n\tconst pasteJson = () => {\n\t\t//TODO: Implement PasteJson\n\t\t/*\n\t\tconst note1 = notify('reading clipboard...')\n\t\twindow.navigator.clipboard.readText().then(json => {\n\t\t\tif (window.confirm(`Do you really want to overwrite this game with what's in your clipboard? ${json.slice(0,99)}...`)) {\n\t\t\t\tfromJson(json)\n\t\t\t\tnotify('pasted from clipboard')\n\t\t\t}\n\t\t\tnote1 && note1.close()\n\t\t}).catch(err => {\n\t\t\tconsole.error('failed to read clipboard: ', err)\n\t\t\tnotify(`failed to read clipboard: ${err}`, 2000)\n\t\t})\n\t\t*/\n\t}\n\n\treturn (\n        toggleOnUser ?\n\t\t    <UserToolView\n                initAsDev={ initAsDev } \n                toggleFog={ toggleFog } \n                copyJson={ copyJson } \n                pasteJson={ pasteJson } \n                username={ settings.username } \n                updateUsername={ updateUsername } \n                cursorSize={ settings.cursorSize } \n                updateCursorSize={ updateCursorSize } />\n            : null\n\t)\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tgame: state.game,\n        settings: state.settings,\n\t}\n}\n\nconst mapDispatchToProps = {\n    setUsername,\n\tsetCursorSize,\n    setFogEnabled,\n    setToolSettings,\n    loadDefaultBattleGame,\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(UserTool)\n","import Button from '../views/Button.js'\nimport { connect } from 'react-redux'\nimport { setToolSettings } from '../reducers/settingsReducer.js'\n\nfunction ToolButton({ title, value, settings, setToolSettings }) {\n\tconst isSelected = title === settings.tool\n\tconst onClick = () => {\n\t\tsetToolSettings(title, undefined)\n\t}\n\treturn (\n\t\t<Button title={ title } value={ value.toString() } onClick={ onClick } isSelected={ isSelected } />\n\t)\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tsettings: state.settings,\n\t}\n}\n\nconst mapDispatchToProps = {\n\tsetToolSettings,\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ToolButton)\n","import ToolButton from '../components/ToolButton.js'\n\nconst ToolSelectView = ({ fogEnabled }) => {\n\treturn (\n\t\t<span id='tools'>\n\t\t\t<ToolButton title='move' value='&#x1f9f3;' />\n\t\t\t<ToolButton title='draw' value='&#x1f58d;' />\n\t\t\t{ fogEnabled ? <ToolButton title='fog'  value='&#x1f32c;' /> : null }\n\t\t</span>\n\t)\n}\n\nexport default ToolSelectView\n","import ToggleButton from '../components/ToggleButton.js'\nimport ToolControls from '../components/ToolControls.js'\nimport MapTool from '../components/MapTool.js'\nimport TokenTool from '../components/TokenTool.js'\nimport UserTool from '../components/UserTool.js'\nimport SelectedTokensControls from '../components/SelectedTokensControls.js'\nimport ToolSelectView from './ToolSelectView.js'\nimport Button from './Button.js'\n\nconst ControlPanelView = ({ controlPanelState, setControlPanelState, hidden, toggleHidden, fogEnabled, isHost, username, setUsername, cursorSize, setCursorSize, socketRequestRefresh, pushRefreshToPlayers }) => {\n\tif (hidden)\n\t\treturn (\n\t\t\t<div id='control-panel'>\n\t\t\t\t&nbsp;&nbsp;&nbsp;&nbsp;\n\t\t\t\t<Button value='&#x1f441;' onClick={ toggleHidden } title='show/hide control panel' />\n\t\t\t\t&nbsp;&nbsp;&nbsp;&nbsp;\n\t\t\t</div>\n\t\t)\n\t\n\tif (isHost)\n\t\treturn (\n\t\t\t<div id='control-panel'>\n\t\t\t\t&nbsp;&nbsp;&nbsp;&nbsp;\n\t\t\t\t<Button value='&#x1f441;' onClick={ toggleHidden } title='show/hide control panel' />\n\t\t\t\t&nbsp;&nbsp;&nbsp;&nbsp;\n\t\t\t\t<ToggleButton title='User' value='&#x1f9d9;&#x200d;&#x2642;&#xfe0f;' controlPanelState={ controlPanelState } setControlPanelState={ setControlPanelState } />\n\t\t\t\t<ToggleButton title='Maps' value='&#x1f5fa;' controlPanelState={ controlPanelState } setControlPanelState={ setControlPanelState } />\n\t\t\t\t<ToggleButton title='Tokens' value='&#x265f;' controlPanelState={ controlPanelState } setControlPanelState={ setControlPanelState } />\n\t\t\t\t<Button title='Push refresh to players' value='&#x1f4ab;' onClick={ pushRefreshToPlayers } />\n\t\t\t\t&nbsp;&nbsp;&nbsp;&nbsp;\n\t\t\t\t<ToolSelectView fogEnabled={ fogEnabled } />\n\t\t\t\t&nbsp;&nbsp;&nbsp;&nbsp;\n\t\t\t\t<ToolControls />\n\t\t\t\t<MapTool toggleOnMaps={ controlPanelState.toggleOnMaps } />\n\t\t\t\t<TokenTool toggleOnTokens={ controlPanelState.toggleOnTokens } />\n\t\t\t\t<UserTool toggleOnUser={ controlPanelState.toggleOnUser } />\n\t\t\t</div>\n\t\t)\n\telse\n\t\treturn (\n\t\t\t<div id='control-panel'>\n\t\t\t\t<Button value='&#x1f441;' onClick={ toggleHidden } title='show/hide control panel' />\n\t\t\t\t<input title='User name' placeholder='User name' value={ username } onChange={ (e) => setUsername(e.target.value) } />\n\t\t\t\t<ToggleButton title='Share mouse (cursor)' value='&#x1f401;' controlPanelState={ controlPanelState } setControlPanelState={ setControlPanelState } />\n\t\t\t\t<input title='Cursor size' value={ cursorSize } onChange={ (e) => setCursorSize(parseInt(e.target.value)) } type='number' min='0' />\n\t\t\t\t<Button title='Request gameboard refresh from host' onClick={ socketRequestRefresh } value='&#x1f4ab;' />\n\t\t\t\t<SelectedTokensControls />\n\t\t\t</div>\n\t\t)\n}\n\nexport default ControlPanelView\n","import React, { useState } from 'react'\nimport { connect } from 'react-redux'\nimport { setUsername, setCursorSize } from '../reducers/settingsReducer.js' \nimport { pushGameRefresh, requestRefresh, useWebSocket } from '../hooks/useSocket.js'\nimport ControlPanelView from '../views/ControlPanelView.js'\n\nconst initialControlPanelState = () => {\n\treturn {\n\t\thidden: false,\n\t\ttoggleOnMaps: false,\n\t\ttoggleOnUser: false,\n\t\ttoggleOnTokens: false,\n\t}\n}\n\nconst ControlPanel = ({ game, settings, metadata, setUsername, setCursorSize }) => {\n\tconst [controlPanelState, setControlPanelState] = useState(initialControlPanelState)\n\tconst [webSocket, wsSettings, setWsSettings] = useWebSocket()\n\n\tconst toggleHidden = () => {\n\t\tsetControlPanelState({\n\t\t\t...controlPanelState,\n\t\t\thidden: !controlPanelState.hidden,\n\t\t})\n\t}\n\n\tconst updateUsername = (value) => {\n\t\tsetUsername(value)\n\t\tsetWsSettings({\n\t\t\t...wsSettings,\n\t\t\tusername: value,\n\t\t})\n\t}\n\n\tconst updateCursorSize = (value) => {\n\t\tconst newSize = value\n\t\tif (!isNaN(newSize))\n\t\t\tsetCursorSize(newSize)\n\t}\n\n\tconst socketRequestRefresh = () => {\n\t\trequestRefresh(webSocket, wsSettings)\n\t}\n\n\tconst pushRefreshToPlayers = () => {\n\t\tpushGameRefresh(webSocket, wsSettings, game)\n\t}\n\n\treturn (\n\t\t<ControlPanelView \n\t\t\tcontrolPanelState={ controlPanelState } \n\t\t\tsetControlPanelState={ setControlPanelState } \n\t\t\thidden={ controlPanelState.hidden } \n\t\t\ttoggleHidden={ toggleHidden } \n\t\t\tfogEnabled={ game.fogEnabled }\n\t\t\tisHost={ metadata.isHost } \n\t\t\tusername={ settings.username } \n\t\t\tsetUsername={ updateUsername } \n\t\t\tcursorSize={ settings.cursorSize } \n\t\t\tsetCursorSize={ updateCursorSize } \n\t\t\tsocketRequestRefresh={ socketRequestRefresh } \n\t\t\tpushRefreshToPlayers={ pushRefreshToPlayers } />\n\t)\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tgame: state.game,\n\t\tsettings: state.settings,\n\t\tmetadata: state.metadata,\n\t}\n}\n\nconst mapDispatchToProps = {\n\tsetUsername,\n\tsetCursorSize,\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ControlPanel)\n","import Background from '../components/Background.js'\nimport Drawing from '../components/Drawing.js'\nimport Fog from '../components/Fog.js'\nimport Overlay from '../components/Overlay.js'\nimport Token from '../components/Token.js'\nimport Cursor from './Cursor.js'\nimport ControlPanel from '../components/ControlPanel.js'\n\nconst GameView = ({ isHost, overlayRef, isFogLoaded, cursors, cursorSize, tokens, onMouseMove, onMouseUp, onMouseDown }) => {\n\tconst goneClass = isFogLoaded ? null : 'gone'\n\n\treturn (\n\t\t<div id='game' onMouseMove={ (e) => onMouseMove(e) } onMouseDown={ (e) => onMouseDown(e) } onMouseUp={ (e) => onMouseUp(e) }>\n\t\t\t<div className={ goneClass }>\n\t\t\t\t<Background />\n\t\t\t\t<Drawing />\n\t\t\t\t{ tokens ? \n\t\t\t\t\t<div id='tokens'>\n\t\t\t\t\t\t{ tokens.map((token, $i) => (\n\t\t\t\t\t\t\t<Token key={ `Token${$i}` } token={ token } isHost={ isHost } />\n\t\t\t\t\t\t)) }\n\t\t\t\t\t</div>\n\t\t\t\t\t: null\n\t\t\t\t}\n\t\t\t\t<Fog />\n\t\t\t\t{ cursors ?\n\t\t\t\t\t<div id='cursors'>\n\t\t\t\t\t\t{ cursors.map((cursor) => (\n\t\t\t\t\t\t\t<Cursor key={ `cursor${cursor.$id}` } name={ cursor.username } cursor={ cursor } size={ cursorSize } />\n\t\t\t\t\t\t)) }\n\t\t\t\t\t</div>\n\t\t\t\t\t: null\n\t\t\t\t}\n\t\t\t\t{/* Overlay: Holds outline for fog & draw tools */ }\n\t\t\t\t<Overlay overlayRef={ overlayRef } /> \n\t\t\t</div>\n\t\t\t<ControlPanel />\n\t\t</div>\n\t)\n}\n\nexport default GameView\n","import React, { useState, useEffect, useCallback } from 'react'\nimport { connect } from 'react-redux'\nimport { setGameSettings } from '../reducers/metadataReducer.js'\nimport { overwriteGame, updateMaps, loadMap, addMap, incrementGen, setFogEnabled, updateTokens } from '../reducers/gameReducer.js'\nimport { pushDrawPath, pushFogPath, pushGameRefresh, pushTokens, useWebSocket } from '../hooks/useSocket.js'\nimport GameView from '../views/GameView.js'\n\nconst Game = ({ metadata, game, settings, setGameSettings, overwriteGame, loadMap, updateMaps, addMap, updateTokens, incrementGen, setFogEnabled }) => {\n\tconst overlayRef = React.useRef()\n\tconst [webSocket, wsSettings, setWsSettings] = useWebSocket()\n\tconst [mousePosition, setMousePosition] = useState({ downX: 0, downY: 0})\n\tlet currentPath = []\n\n\t/****************************************************\n\t * Map Functions                                    *\n\t ****************************************************/\n\tconst getMap = () => {\n\t\tif (game.maps.length === 0)\n\t\t\treturn undefined\n\t\tconst currMap = game.maps.filter((map) => map.$id === game.mapId)\n\t\treturn currMap.length > 0 ? currMap[0] : game.maps[0]\n\t}\n\n\t/****************************************************\n\t * Update Functions                                 *\n\t ****************************************************/\n\t/*\n\tconst updateCursors = (x, y, name, guid) => {\n\t\tconst cursors = Object.assign({}, gameState.metadata.cursors)\n\t\tcursors[guid] = { x: x, y: y, time: new Date(), u: name }\n\t\tsetGameState({\n\t\t\t...gameState,\n\t\t\tmetadata: {\n\t\t\t\t...gameState.metadata,\n\t\t\t\tcursors: cursors,\n\t\t\t},\n\t\t})\n\t}\n\t*/\n\n\t/****************************************************\n\t * Control Functions                                *\n\t ****************************************************/\n\tconst dragSelectedTokens = (e) => {\n\t\tif (settings.tool !== 'move')\n\t\t\treturn\n\n\t\tconst newTokens = game.tokens.map((token) => {\n\t\t\treturn !token.$selected ? token : {\n\t\t\t\t...token,\n\t\t\t\tx: token.$x0 + (e.pageX - mousePosition.downX),\n\t\t\t\ty: token.$y0 + (e.pageY - mousePosition.downY),\n\t\t\t}\n\t\t})\n\t\tupdateTokens(newTokens)\n\t}\n\n\t/****************************************************\n\t * Drawing Functions                                *\n\t ****************************************************/\n\tconst setPointerOutline = (x, y, color, radius) => {\n\t\tif (color == null)\n\t\t\treturn\n\t\tconst ctx = overlayRef.current.getContext('2d')\n\t\tctx.strokeStyle = color\n\t\tctx.lineWidth = '3'\n\t\tctx.beginPath()\n\t\tctx.arc(x, y, radius, 0, 2*Math.PI)\n\t\tctx.stroke()\n\t\tctx.closePath()\n\t}\n\n\tconst updateCurrentDrawPath = () => {\n\t\tconst ctx = overlayRef.current.getContext('2d')\n\t\tctx.beginPath()\n\t\tfor (let pointId = 0; pointId < currentPath.length; pointId++) {\n\t\t\tctx.lineCap = 'round'\n\t\t\tctx.fillStyle = currentPath[pointId].drawColor\n\t\t\tctx.lineWidth = currentPath[pointId].drawSize\n\t\t\tctx.strokeStyle = currentPath[pointId].drawColor\n\t\t\tif (pointId === 0) {\n\t\t\t\tctx.moveTo(currentPath[pointId].x, currentPath[pointId].y)\n\t\t\t} else {\n\t\t\t\tctx.lineTo(currentPath[pointId].x, currentPath[pointId].y)\n\t\t\t}\n\t\t}\n\t\tctx.stroke()\n\t}\n\n\tconst updateCurrentFogPath = () => {\n\t\tconst ctx = overlayRef.current.getContext('2d')\n\t\tctx.beginPath()\n\t\tlet gradient\n\t\tfor (let pointId = 0; pointId < currentPath.length; pointId++) {\n\t\t\tgradient = ctx.createRadialGradient(currentPath[pointId].x, currentPath[pointId].y, currentPath[pointId].r2 || 1, currentPath[pointId].x, currentPath[pointId].y, currentPath[pointId].r*0.75)\n\t\t\tctx.lineCap = 'round'\n\t\t\tgradient.addColorStop(0, 'rgba(255,255,255,255)')\n\t\t\tgradient.addColorStop(1, 'rgba(255,255,255,0)')\n\t\t\tctx.fillStyle = gradient\n\t\t\tctx.fillRect(currentPath[pointId].x-currentPath[pointId].r, currentPath[pointId].y-currentPath[pointId].r, currentPath[pointId].x+currentPath[pointId].r, currentPath[pointId].y+currentPath[pointId].r)\n\t\t}\n\t\tctx.stroke()\n\t}\n\n\tconst clearOverlay = () => {\n\t\tconst ctx = overlayRef.current.getContext('2d')\n\t\tif (!ctx)\n\t\t\treturn\n\t\tctx.clearRect(0, 0, game.width, game.height);\n\t}\n\n\t/****************************************************\n\t * Event Handlers                                   *\n\t ****************************************************/\n\t/* Callback when the window resizes */\n\tconst onResize = () => {\n\t\t//loadMap(null, true, true)\n\t}\n\n\tconst onKeyDown = (e) => {\n\t\t//TODO: Update onKeyDown function\n\t\t/*\n\t\tfor (let x of [document.activeElement, e.target])\n\t\t\t//TODO: Check if we can use triple equal\n\t\t\tif (x.tagName == 'INPUT' && (x.type === 'text' || x.type === 'number')) // eslint-disable-line eqeqeq\n\t\t\t\treturn e\n\t\t\n\t\tconst moveFactor = e.shiftKey ? 100 : 10\n\t\tconst moveSelectedTokens = () => {\n\t\t\tupdateTokens(token => {\n\t\t\t\tif (token.$selected) {\n\t\t\t\t\tswitch (e.keyCode) {\n\t\t\t\t\t\tcase 27: // escape\n\t\t\t\t\t\t\ttoken.$selected = false\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\tcase 37: // left\n\t\t\t\t\t\t\ttoken.x -= moveFactor\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\tcase 38: // up\n\t\t\t\t\t\t\ttoken.y -= moveFactor\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\tcase 39: // right\n\t\t\t\t\t\t\ttoken.x += moveFactor\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\tcase 40: // down\n\t\t\t\t\t\t\ttoken.y += moveFactor\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\tdefault: return\n\t\t\t\t\t}\n\t\t\t\t\te.preventDefault()\n\t\t\t\t}\n\t\t\t\treturn token\n\t\t\t})\n\t\t}\n\t\tswitch (e.keyCode) {\n\t\t\tcase 27:\n\t\t\tcase 37:\n\t\t\tcase 38:\n\t\t\tcase 39:\n\t\t\tcase 40:\n\t\t\t\tmoveSelectedTokens(e)\n\t\t\t\tbreak\n\t\t\tdefault: return\n\t\t}\n\t\t*/\n\t}\n\n\t/*\n\tconst onKeyPress = (e) => {\n\t\tif (!gameState.metadata.isHost)\n\t\t\treturn e\n\t\tfor (let x of [document.activeElement, e.target])\n\t\t\t//TODO: Check if we can use triple equal\n\t\t\tif ((x.tagName == 'INPUT' && (x.type === 'text' || x.type === 'number')) || (x.tagName == 'BUTTON'))\n\t\t\t\treturn e\n\n\t\tconst cp = gameState.cpRef.current\n\t\tswitch(e.code) {\n\t\t\tcase 'KeyC':\n\t\t\t\tif (e.shiftKey)\n\t\t\t\t\tcp.copyJson() // dump json to clipboard\n\t\t\t\tbreak\n\t\t\tcase 'KeyH':\n\t\t\t\ttoggleControlPanelVisibility('hidden')\n\t\t\t\tbreak\n\t\t\tcase 'KeyG':\n\t\t\t\tsetGameState({\n\t\t\t\t\t...gameState,\n\t\t\t\t\tsettings: {\n\t\t\t\t\t\t...gameState.settings,\n\t\t\t\t\t\ttool: 'fog',\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\tcase 'KeyL':\n\t\t\t\tif (e.shiftKey)\n\t\t\t\t\tloadFromLocalStorage()\n\t\t\t\telse\n\t\t\t\t\tsaveToLocalStorage()\n\t\t\t\tbreak\n\t\t\tcase 'KeyM':\n\t\t\t\ttoggleControlPanelVisibility('toggleOnMaps')\n\t\t\t\tbreak\n\t\t\tcase 'KeyP':\n\t\t\t\tsetGameState({\n\t\t\t\t\t...gameState,\n\t\t\t\t\tsettings: {\n\t\t\t\t\t\t...gameState.settings,\n\t\t\t\t\t\ttool: 'draw',\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\tcase 'KeyT':\n\t\t\t\ttoggleControlPanelVisibility('toggleOnTokens')\n\t\t\t\tbreak\n\t\t\tcase 'KeyV':\n\t\t\t\tif (e.shiftKey)\n\t\t\t\t\tcp.pasteJson() // load json from clipboard\n\t\t\t\telse\n\t\t\t\tsetGameState({\n\t\t\t\t\t...gameState,\n\t\t\t\t\tsettings: {\n\t\t\t\t\t\t...gameState.settings,\n\t\t\t\t\t\ttool: 'move',\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\tdefault: return\n\t\t}\n\t}\n\t*/\n\n\tconst onMouseUp = (e) => {\n\t\tconst currMap = getMap()\n\t\tif (currMap && metadata.isHost) {\n\t\t\tconst fogPaths = currMap.fogPaths\n\t\t\tconst drawPaths = currMap.drawPaths\n\t\t\tswitch (settings.tool) {\n\t\t\t\tcase 'fog':\n\t\t\t\t\tfogPaths.push(currentPath)\n\t\t\t\t\tpushFogPath(webSocket, wsSettings, currentPath)\n\t\t\t\t\tbreak\n\t\t\t\tcase 'draw':\n\t\t\t\t\tdrawPaths.push(currentPath)\n\t\t\t\t\tpushDrawPath(webSocket, wsSettings, currentPath)\n\t\t\t\t\tbreak\n\t\t\t\tdefault: break\n\t\t\t}\n\t\t\tcurrentPath = []\n\t\t\tconst updatedMaps = game.maps.map((map) => {\n\t\t\t\treturn map.$id === currMap.$id ? {...currMap, fogPaths: fogPaths, drawPaths: drawPaths, } : map\n\t\t\t})\n\t\t\t\n\t\t\tupdateMaps(updatedMaps)\n\t\t}\n\n\t\tconst selectedTokens = game.tokens.filter((token) => token.$selected)\n\t\tif (selectedTokens.length > 0)\n\t\t\tpushTokens(webSocket, wsSettings, game.tokens)\n\t}\n\n\tconst onMouseDown = (e) => {\n\t\tfor (let x of [document.activeElement, e.target])\n\t\t\tif ((x.tagName.toUpperCase() == 'INPUT' && (x.type.toUpperCase() === 'TEXT' || x.type.toUpperCase() === 'NUMBER')) || (x.tagName.toUpperCase() === 'BUTTON')) /* eslint-disable-line eqeqeq */\n\t\t\t\treturn e\n\n\t\tif (metadata.isHost) {\n\t\t\tif (e.buttons & 1) {\n\t\t\t\tcurrentPath = []\n\t\t\t\tcurrentPath.push({\n\t\t\t\t\tx: e.pageX,\n\t\t\t\t\ty: e.pageY,\n\t\t\t\t\tr: settings.fogRadius,\n\t\t\t\t\tr2: undefined,\n\t\t\t\t\ttool: currentTool(),\n\t\t\t\t\tdrawColor: settings.drawColor,\n\t\t\t\t\tdrawSize: settings.drawSize,\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\tsetMousePosition({ downX: parseInt(e.pageX), downY: parseInt(e.pageY) })\n\t}\n\n\tconst onMouseMove = (e) => {\n\t\tconst overlay = overlayRef\n\t\tif (!overlay)\n\t\t\treturn\n\n\t\tclearOverlay()\n\t\tlet x = e.pageX, y = e.pageY\n\t\tswitch (metadata.isHost ? settings.tool : 'move') {\n\t\t\tcase 'fog':\n\t\t\t\tupdateCurrentFogPath()\n\t\t\t\tsetPointerOutline(x, y, 'yellow', settings.fogRadius)\n\t\t\t\tbreak\n\t\t\tcase 'draw':\n\t\t\t\tupdateCurrentDrawPath()\n\t\t\t\tsetPointerOutline(x, y, settings.drawColor, settings.drawSize)\n\t\t\t\tbreak\n\t\t\tcase 'move':\n\t\t\t\tif (e.buttons & 1)\n\t\t\t\t\tdragSelectedTokens(e)\n\t\t\t\tbreak\n\t\t\tdefault: break\n\t\t}\n\t\tif ((settings.tool === 'fog' || settings.tool === 'draw') && (e.buttons & 1)) {\n\t\t\tcurrentPath.push({\n\t\t\t\tx: x,\n\t\t\t\ty: y,\n\t\t\t\tr: settings.fogRadius,\n\t\t\t\tr2: undefined,\n\t\t\t\ttool: currentTool(),\n\t\t\t\tdrawColor: settings.drawColor,\n\t\t\t\tdrawSize: settings.drawSize,\n\t\t\t})\n\t\t}\n\t}\n\n\tconst currentTool = () => {\n\t\tconst isEraser = settings.subtool === 'eraser'\n\t\tswitch (settings.tool) {\n\t\t\tcase 'draw':\n\t\t\t\tif (isEraser) {\n\t\t\t\t\treturn 'erease'\n\t\t\t\t} else {\n\t\t\t\t\treturn 'draw'\n\t\t\t\t}\n\t\t\tdefault:\n\t\t\t\treturn settings.tool\n\t\t}\n\t}\n\n\t/****************************************************\n\t * Helper Functions                                 *\n\t ****************************************************/\n\tconst notify = (msg, ttl, tag) => {\n\t\tconsole.log(msg)\n\t\tif (window.Notification) {\n\t\t\tif (window.Notification.permission !== 'granted')\n\t\t\t\twindow.Notification.requestPermission()\n\t\t\telse {\n\t\t\t\tconst note = new window.Notification(msg, {tag: tag})\n\t\t\t\tsetTimeout(() => note.close(), ttl || 1000)\n\t\t\t\treturn note\n\t\t\t}\n\t\t}\n\t}\n\n\tconst toJson = (additionalAttrs) => {\n\t\t//TODO: rewrite toJson\n\t\t/*\n\t\tconst map = getMap()\n\t\tincrementGen()\n\t\tconst tokens = game.tokens.map(token => ({...token}))\n\t\ttokens.forEach(token => websocket.scrubObject(token))\n\t\tconst maps = game.maps\n\t\tObject.values(maps).forEach(map => websocket.scrubObject(map))\n\t\tconst data = Object.assign({\n\t\t\tgen: game.gen,\n\t\t\tmaps: maps,\n\t\t\tmapId: map && map.$id,\n\t\t\ttokens: tokens,\n\t\t}, additionalAttrs)\n\t\treturn JSON.stringify(data)\n\t\t*/\n\t}\n\n\tconst fromJson = (json) => {\n\t\t//TODO: rewrite fromJson\n\t\t/*\n\t\tconst data = Object.assign(JSON.parse(json)||{})\n\t\tif (data.tokens) {\n\t\t\tdata.tokens.forEach(token => {\n\t\t\t\tif (!token.guid) token.guid = guid()\n\t\t\t})\n\t\t}\n\t\treturn new Promise(resolve => {\n\t\t\tsetGameState({\n\t\t\t\t...gameState,\n\t\t\t\tgame: {\n\t\t\t\t\t...gameState.game,\n\t\t\t\t\tdata,\n\t\t\t\t}\n\t\t\t})\n\t\t\tresolve()\n\t\t})\n\t\t*/\n\t}\n\n\tconst saveToLocalStorage = () => {\n\t\t//TODO: Reenable after we've fixed toJson\n\t\t/*\n\t\tif (game.isFirstLoadDone) {\n\t\t\tconsole.log('Saving game to local storage')\n\t\t\tlocalStorage.setItem(metadata.room, toJson())\n\t\t}\n\t\t*/\n\t}\n\n\tconst loadFromLocalStorage = () => {\n\t\t//TODO: reenable after we've fixed fromJson\n\t\t/*\n\t\t//TODO: Verify how come this does not work anymore\n\t\tconsole.log('Loading game from local storage')\n\t\treturn fromJson(localStorage.getItem(metadata.room))\n\t\t*/\n\t}\n\n\tfunction handleError (ex) {\n\t\tconsole.error(ex)\n\t\tconsole.error('Exception in `render`. Clearing localStorage...')\n\t\tlocalStorage.removeItem(metadata.room)\n\t\twindow.alert('Fatal error. Local storage cleared.')\n\t}\n\n\t/****************************************************\n\t * Receiving Data                                   *\n\t ****************************************************/\n\tconst receiveData = useCallback((evt) => {\n\t\tlet data = JSON.parse(evt.data)\n\t\tif (data.from === wsSettings.guid) {\n\t\t\treturn // ignore messages sent by self\n\t\t}\n\t\tif (data.to && data.to !== wsSettings.guid) {\n\t\t\treturn // ignore messages sent to different recipients\n\t\t}\n\n        const getMap = () => {\n            if (game.maps.length === 0)\n                return undefined\n            const currMap = game.maps.filter((map) => map.$id === game.mapId)\n            return currMap.length > 0 ? currMap[0] : game.maps[0]\n        }\n\n\t\tconst currMap = getMap()\n\t\tswitch (data.type) {\n\t\t\tcase 'pushCursor':\n\t\t\t\t/*\n\t\t\t\tif (data.u !== this.gameState.settings.username)\n\t\t\t\t\tthis.gameState.updateCursors(data.x, data.y, data.u, data.from)\n\t\t\t\t*/\n\t\t\t\tbreak\n\t\t\tcase 'pushDrawPath':\n\t\t\t\tconst newDrawPath = currMap.drawPaths ? currMap.drawPaths : []\n\t\t\t\tnewDrawPath.push(data.drawPath)\n\t\t\t\tconst updatedMapsWithDraw = game.maps.map((map) => {\n\t\t\t\t\treturn map.$id === currMap.$id ? { ...currMap, drawPaths: newDrawPath, } : map\n\t\t\t\t})\n\t\t\t\tupdateMaps(updatedMapsWithDraw)\n\t\t\t\tbreak\n\t\t\tcase 'pushDrawReset':\n\t\t\t\tconst updatedMapsWithDrawReset = game.maps.map((map) => {\n\t\t\t\t\treturn map.$id === currMap.$id ? {...currMap, drawPaths: [], } : map\n\t\t\t\t})\n\t\t\t\tupdateMaps(updatedMapsWithDrawReset)\n\t\t\t\tbreak\n\t\t\tcase 'pushFogPath':\n\t\t\t\tconst newFogPath = currMap.fogPaths ? currMap.fogPaths : []\n\t\t\t\tnewFogPath.push(data.fogPath)\n\t\t\t\tconst updatedMapsWithFog = game.maps.map((map) => {\n\t\t\t\t\treturn map.$id === currMap.$id ? { ...currMap, fogPaths: newFogPath, } : map\n\t\t\t\t})\n\t\t\t\tupdateMaps(updatedMapsWithFog)\n\t\t\t\tbreak\n\t\t\tcase 'pushFogReset':\n\t\t\t\tconst updatedMapsWithFogReset = game.maps.map((map) => {\n\t\t\t\t\treturn map.$id === currMap.$id ? {...currMap, fogPaths: [], } : map\n\t\t\t\t})\n\t\t\t\tupdateMaps(updatedMapsWithFogReset)\n\t\t\t\tbreak\n\t\t\tcase 'pushSingleToken':\n\t\t\t\tconst updatedTokens = game.tokens.map((token) => {\n\t\t\t\t\treturn token.guid !== data.token.guid ? token : {\n\t\t\t\t\t\t...data.token,\n\t\t\t\t\t\t$selected: token.$selected,\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tupdateTokens(updatedTokens)\n\t\t\t\tbreak\n\t\t\tcase 'pushTokens':\n\t\t\t\tconst selectionFixedTokens = data.tokens.map((token) => {\n\t\t\t\t\tlet tokenSelected = false\n\t\t\t\t\tconst currentToken = game.tokens.filter((token2) => token2.guid === token.guid)\n\t\t\t\t\tif (currentToken.length > 0)\n\t\t\t\t\t\ttokenSelected = currentToken.$selected\n\t\t\t\t\treturn { ...token, $selected: tokenSelected, }\n\t\t\t\t})\n\t\t\t\tupdateTokens(selectionFixedTokens)\n\t\t\t\tbreak\n\t\t\tcase 'pushMapId':\n\t\t\t\tloadMap(data.mapId)\n\t\t\t\tbreak\n\t\t\tcase 'pushMapState':\n\t\t\t\tupdateMaps(data.maps)\n\t\t\t\tloadMap(data.mapId)\n\t\t\t\tbreak\n\t\t\tcase 'pushCreateMap':\n\t\t\t\taddMap(data.mapName, data.width, data.height)\n\t\t\t\tbreak\n\t\t\tcase 'pushFogEnabled':\n\t\t\t\tconsole.log('receiving fog enabled',data)\n\t\t\t\tsetFogEnabled(data.fogEnabled)\n\t\t\t\tbreak\n\t\t\tcase 'pushGameRefresh': // refresh from host\n\t\t\t\toverwriteGame(data.game)\n\t\t\t\tbreak\n\t\t\tcase 'requestRefresh': // refresh request from player\n\t\t\t\tif (metadata.isHost) {\n\t\t\t\t\tpushGameRefresh(webSocket, wsSettings, game, { to: data.from, })\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\tdefault:\n\t\t\t\tconsole.error(`Unrecognized websocket message type: ${data.type}`)\n\t\t}\n\t},[ game, metadata.isHost, loadMap, overwriteGame, setFogEnabled, updateMaps, addMap, updateTokens, webSocket, wsSettings ])\n\n\t/****************************************************\n\t * React Hooks                                      *\n\t ****************************************************/\n\t// On Mount\n\tuseEffect(() => {\n\t\twindow.addEventListener('beforeunload', saveToLocalStorage)\n\t\twindow.addEventListener('resize', onResize)\n\t\t//TODO: reenable keypresses\n\t\t//window.addEventListener('keypress', onKeyPress)\n\t\twindow.addEventListener('keydown', onKeyDown)\n\t\tloadFromLocalStorage()\n\t\tconst params = new URLSearchParams(window.location.href.replace(/.*\\?/, ''))\n\t\tsetGameSettings(params.get('host'), params.get('room'))\n\n\t\t// On Unmount\n\t\treturn () => {\n\t\t\tsaveToLocalStorage()\n\t\t\twindow.removeEventListener('beforeunload', saveToLocalStorage)\n\t\t\twindow.removeEventListener('resize', onResize)\n\t\t\t//window.removeEventListener('keypress', onKeyPress)\n\t\t\twindow.removeEventListener('keydown', onKeyDown)\n\t\t}\n\t}, []) // eslint-disable-line react-hooks/exhaustive-deps\n\n\tuseEffect(() => {\n\t\tdocument.title = `Borealis D&D, Room: ${metadata.room}`\n\t}, [ metadata.room ])\n\n\tuseEffect(() => {\n\t\tif (webSocket) {\n\t\t\twebSocket.addEventListener('message', receiveData)\n\t\t\tif (wsSettings.username === '')\n\t\t\t\tsetWsSettings({ ...wsSettings, username: settings.username })\n\t\t}\n\n\t\treturn () => {\n\t\t\tif (webSocket)\n\t\t\t\twebSocket.removeEventListener('message', receiveData)\n\t\t}\n\t}, [webSocket, wsSettings, setWsSettings, receiveData, settings.username])\n\t\n\t/*\n\tuseEffect(() => {\n\t\tif (websocket && gameState.settings.shareMouse)\n\t\t\twebsocket.pushCursor(gameState.metadata.lastX, gameState.metadata.lastY)\n\t}, [gameState.metadata.lastX, gameState.metadata.lastY, gameState.settings.shareMouse])\n\t*/\n\n\t/****************************************************\n\t * Component Render                                 *\n\t ****************************************************/\n\tconst deadline = new Date() - 30000\n\tconst cursorsCopy = metadata.cursors\n\n\tfor (let name in cursorsCopy) {\n\t\tlet time = cursorsCopy[name].time\n\t\tif (!time || time < deadline)\n\t\t\tdelete cursorsCopy[name]\n\t}\n\n\ttry {\n\t\treturn (\n\t\t\t<GameView \n\t\t\t\tisHost={ metadata.isHost } \n\t\t\t\toverlayRef={ overlayRef } \n\t\t\t\tisFogLoaded={ game.isFogLoaded } \n\t\t\t\tcursors={ cursorsCopy } \n\t\t\t\tcursorSize={ settings.cursorSize } \n\t\t\t\ttokens={ game.tokens } \n\t\t\t\tonMouseMove={ onMouseMove } \n\t\t\t\tonMouseUp={ onMouseUp } \n\t\t\t\tonMouseDown={ onMouseDown } \n\t\t\t\t/* TODO: reenable notify={ notify } */\n\t\t\t/>\n\t\t)\n\t} catch (ex) {\n\t\thandleError(ex)\n\t}\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tmetadata: state.metadata,\n\t\tgame: state.game,\n\t\tsettings: state.settings,\n\t}\n}\n\nconst mapDispatchToProps = {\n\tsetGameSettings,\n\toverwriteGame,\n\tloadMap,\n\tupdateMaps,\n\taddMap,\n\tincrementGen,\n\tsetFogEnabled,\n\tupdateTokens,\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Game)\n","import React from 'react'\nimport { createStore, combineReducers } from 'redux'\nimport { Provider } from 'react-redux'\nimport settingsReducer from '../reducers/settingsReducer'\nimport metadataReducer from '../reducers/metadataReducer'\nimport gameReducer from '../reducers/gameReducer'\nimport WebSocketProvider from '../contexts/WebSocketProvider'\nimport Game from './Game'\n\nconst App = () => {\n    const combinedReducer = combineReducers({\n        settings: settingsReducer,\n        metadata: metadataReducer,\n        game: gameReducer,\n    })\n    const store = createStore(combinedReducer)\n\n    return(\n        <Provider store={ store } >\n            <WebSocketProvider>\n                <Game />\n            </WebSocketProvider>\n        </Provider>\n    )\n}\n\nexport default App\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n)\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href)\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config)\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          )\n        })\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config)\n      }\n    })\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing\n        if (installingWorker == null) {\n          return\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              )\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration)\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.')\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration)\n              }\n            }\n          }\n        }\n      }\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error)\n    })\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type')\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload()\n          })\n        })\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config)\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      )\n    })\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister()\n      })\n      .catch(error => {\n        console.error(error.message)\n      })\n  }\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './styles/index.css'\nimport './styles/Game.css'\nimport App from './components/App'\nimport * as serviceWorker from './serviceWorker.js'\n\nReactDOM.render(\n\t<React.StrictMode>\n\t\t<App />\n\t</React.StrictMode>,\n\tdocument.getElementById('root')\n)\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister()\n"],"sourceRoot":""}
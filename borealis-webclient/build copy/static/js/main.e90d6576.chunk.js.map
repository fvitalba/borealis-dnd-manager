{"version":3,"sources":["redux/constants.js","reducers/settingsReducer.js","reducers/metadataReducer.js","controllers/guid.js","reducers/gameReducer.js","hooks/useSocket.js","contexts/WebSocketProvider.js","controllers/drawImage.js","hooks/useCanvas.js","components/Canvas.js","components/Background.js","components/Drawing.js","components/Fog.js","components/Overlay.js","views/TokenView.js","components/Token.js","views/Cursor.js","views/Button.js","components/ToggleButton.js","views/ToolControlsView.js","components/ToolControls.js","views/MapConfigView.js","components/MapConfig.js","views/MapToolView.js","components/MapTool.js","views/HostTokenConfigView.js","views/GuestTokenConfigView.js","components/TokenConfig.js","views/TokenToolView.js","views/SelectedTokensControlsView.js","components/SelectedTokensControls.js","components/TokenTool.js","views/UserToolView.js","components/UserTool.js","components/ToolButton.js","views/ToolSelectView.js","views/ControlPanelView.js","components/ControlPanel.js","views/GameView.js","components/Game.js","components/App.js","serviceWorker.js","index.js"],"names":["CHANGE_CURSORSIZE","CHANGE_FOG_SETTINGS","CHANGE_DRAW_SETTINGS","CHANGE_TOOL","CHANGE_USERNAME","TOGGLE_MOUSESHARING","OVERWRITE_GAME","LOAD_MAP","INCREMENT_GEN","SET_ISFOGLOADED","SET_ISFIRSTLOADDONE","UPDATE_MAPS","ADD_MAP","DELETE_MAP","UPDATE_TOKENS","ADD_TOKEN","DELETE_TOKEN","COPY_TOKEN","UPDATE_TOKEN_VALUE","TOGGLE_TOKEN_VALUE","RESET_FOG","RESET_DRAW","SET_GAMESETTINGS","SET_CURSORS","SET_LAST_COORDINATES","SET_DOWN_COORDINATES","initialSettingsState","cursorSize","fogOpacity","fogRadius","drawColor","drawSize","tool","subtool","undefined","username","URLSearchParams","window","location","href","replace","get","shareMouse","setCursorSize","newCursorSize","type","parseInt","setToolSettings","newTool","newSubtool","setUsername","newUsername","settingsReducer","state","action","initialMetadataState","isHost","room","cursors","lastX","lastY","downX","downY","metadataReducer","guid","c","r","crypto","getRandomValues","Uint32Array","Math","pow","toString","initialGameState","mapId","gen","width","innerWidth","height","innerHeight","isFogLoaded","isFirstLoadDone","maps","tokens","loadMap","newMapId","updateMaps","newMaps","updateTokens","newTokens","gameReducer","JSON","parse","stringify","game","length","mapsWithNewMap","concat","map","$id","filter","token","tokenGuid","tokenCopy","tokensCopy","key","value","tokensCopy2","fogResetMaps","fogPaths","drawResetMaps","drawPaths","useWebSocket","useContext","WebSocketContext","sendData","webSocket","data","readyState","WebSocket","OPEN","send","console","error","pushGameRefresh","wsSettings","additionalAttributes","from","requestRefresh","require","config","SOCKET_SERVER_PORT","process","PORT","createWebSocket","log","webSocketUrl","host","protocol","test","generateWebSocketUrl","createContext","connect","metadata","children","useState","setWsSettings","ws","setWs","useEffect","onClose","setTimeout","onOpen","addEventListener","removeEventListener","Provider","drawImage","url","which","context","resizeCanvases","trim","Promise","resolve","reject","ctx","img","Image","onload","w","h","then","x","y","onerror","err","src","useCanvas","draw","gameState","options","canvasRef","useRef","current","getContext","Canvas","id","rest","ref","mapDispatchToProps","onClick","e","imageUrl","name","currMap","getMap","currPath","globalCompositeOperation","beginPath","pointId","lineCap","fillStyle","lineWidth","strokeStyle","moveTo","lineTo","erease","className","clearRect","pathId","stroke","settings","ereaseFog","gradient","createRadialGradient","r2","addColorStop","fillRect","style","opacity","overlayRef","TokenView","divStyle","classes","imgStyle","onMouseDown","onMouseUp","title","join","alt","ko","pc","$selected","left","top","Cursor","cursor","size","fontSize","role","u","Button","isSelected","disabled","ToggleButton","controlPanelState","setControlPanelState","toggleKey","ToolControlsView","setDrawColor","setDrawSize","setFogOpacity","setFogRadius","setSubtool","resetFog","resetDrawing","onChange","target","step","min","backgroundColor","max","setDrawToolSettings","newDrawColor","newDrawSize","setFogToolSettings","newFogOpacity","newFogRadius","resetDraw","newSize","isNaN","newOpacity","newRadius","MapConfigView","mapConfigState","load","onTextChange","onIntegerChange","deleteMap","placeholder","mapIdToDelete","setIsFogLoaded","newIsFogLoaded","setIsFirstLoadDone","newIsFirstLoadDone","currentMap","mapElement","initialMapConfigState","setMapConfigState","updatedMaps","pushMapId","evt","confirm","MapToolView","newMapName","setNewMapName","createMap","addMap","mapName","toggleOnMaps","HostTokenConfigView","copy","onToggle","selectToken","onMapSelect","deleteToken","defaultValue","GuestTokenConfigView","tokenGuidToDelete","copyToken","tokenGuidToCopy","updateTokenValue","tokenGuidToUpdate","toggleTokenValue","tokenSelected","updatedTokens","currToken","$x0","$y0","TokenToolView","newTokenUrl","setNewTokenUrl","createToken","$i","SelectedTokensControlsView","filteredTokens","t","addToken","tokenName","tokenUrl","newToken","toggleOnTokens","UserToolView","initAsDev","copyJson","pasteJson","updateUsername","updateCursorSize","toggleOnUser","ToolSelectView","ControlPanelView","hidden","toggleHidden","socketRequestRefresh","pushRefreshToPlayers","initialControlPanelState","GameView","onMouseMove","goneClass","setGameSettings","newIsHost","newRoom","overwriteGame","newGame","incrementGen","React","currentPath","setPointerOutline","color","radius","arc","PI","closePath","onResize","onKeyDown","currentTool","isEraser","receiveData","to","newDrawPath","push","drawPath","updatedMapsWithDraw","updatedMapsWithDrawReset","newFogPath","fogPath","updatedMapsWithFog","updatedMapsWithFogReset","saveToLocalStorage","params","document","deadline","Date","cursorsCopy","time","clearOverlay","pageX","pageY","updateCurrentFogPath","updateCurrentDrawPath","buttons","pushFogPath","pushDrawPath","activeElement","tagName","ex","localStorage","removeItem","alert","handleError","App","combinedReducer","combineReducers","store","createStore","Boolean","hostname","match","ReactDOM","render","StrictMode","getElementById","navigator","serviceWorker","ready","registration","unregister","catch","message"],"mappings":"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","file":"static/js/main.e90d6576.chunk.js","sourcesContent":["// settings\nexport const CHANGE_CURSORSIZE = 'SETTINGS/CHANGE_CURSORSIZE'\nexport const CHANGE_FOG_SETTINGS = 'SETTINGS/CHANGE_FOG_SETTINGS'\nexport const CHANGE_DRAW_SETTINGS = 'SETTINGS/CHANGE_DRAW_SETTINGS'\nexport const CHANGE_TOOL = 'SETTINGS/CHANGE_TOOL'\nexport const CHANGE_USERNAME = 'SETTINGS/CHANGE_USERNAME'\nexport const TOGGLE_MOUSESHARING = 'SETTINGS/TOGGLE_MOUSESHARING'\n\n// game\nexport const OVERWRITE_GAME = 'GAME/OVERWRITE_GAME'\nexport const LOAD_MAP = 'GAME/LOAD_MAP'\nexport const INCREMENT_GEN = 'GAME/INCREMENT_GEN'\nexport const SET_ISFOGLOADED = 'GAME/SET_ISFOGLOADED'\nexport const SET_ISFIRSTLOADDONE = 'GAME/SET_ISFIRSTLOADDONE'\nexport const UPDATE_MAPS = 'GAME/UPDATE_MAPS'\nexport const ADD_MAP = 'GAME/ADD_MAP'\nexport const DELETE_MAP = 'GAME/DELETE_APP'\nexport const UPDATE_TOKENS = 'GAME/UPDATE_TOKENS'\nexport const ADD_TOKEN = 'GAME/ADD_TOKEN'\nexport const DELETE_TOKEN = 'GAME/DELETE_TOKEN'\nexport const COPY_TOKEN = 'GAME/COPY_TOKEN'\nexport const UPDATE_TOKEN_VALUE = 'GAME/UPDATE_TOKEN_VALUE'\nexport const TOGGLE_TOKEN_VALUE = 'GAME/TOGGLE_TOKEN_VALUE'\nexport const RESET_FOG = 'GAME/RESET_FOG'\nexport const RESET_DRAW = 'GAME/RESET_DRAW'\n\n// metadata\nexport const SET_GAMESETTINGS = 'METADATA/SET_GAMESETTINGS'\nexport const SET_ISHOST = 'METADATA/SET_ISHOST'\nexport const SET_ROOM = 'METADATA/ROOM'\nexport const SET_CURSORS = 'METADATA/SET_CURSORS'\nexport const SET_LAST_COORDINATES = 'METADATA/SET_LAST_COORDINATES'\nexport const SET_DOWN_COORDINATES = 'METADATA/SET_DOWN_COORDINATES'\n\n// controlpanel\n//TODO: Add control panel actions\n","import { \n    CHANGE_CURSORSIZE,\n    CHANGE_FOG_SETTINGS,\n    CHANGE_DRAW_SETTINGS, \n    CHANGE_TOOL,\n    CHANGE_USERNAME,\n    TOGGLE_MOUSESHARING \n} from '../redux/constants'\n\nconst initialSettingsState = () => {\n    const params = new URLSearchParams(window.location.href.replace(/.*\\?/, ''))\n    return {\n        cursorSize: 50,\n        fogOpacity: 0.5,\n        fogRadius: 75,\n        drawColor: 'white',\n        drawSize: 8,\n        tool: 'move',\n        subtool: undefined,\n        username: params.get('host') ? 'DM' : 'PC',\n        shareMouse: true,\n    }\n}\n\nconst settingsReducer = (state = initialSettingsState(), action) => {\n    switch (action.type) {\n        case CHANGE_CURSORSIZE:\n            return {\n                ...state,\n                cursorSize: action.cursorSize,\n            }\n        case CHANGE_FOG_SETTINGS:\n            return {\n                ...state,\n                fogOpacity: action.fogOpacity,\n                fogRadius: action.fogRadius,\n            }\n        case CHANGE_DRAW_SETTINGS:\n            return {\n                ...state,\n                drawColor: action.drawColor,\n                drawSize: action.drawSize,\n            }\n        case CHANGE_TOOL:\n            return {\n                ...state,\n                tool: action.tool,\n                subtool: action.subtool,\n            }\n        case CHANGE_USERNAME:\n            return {\n                ...state,\n                username: action.username,\n            }\n        case TOGGLE_MOUSESHARING:\n            return {\n                ...state,\n                shareMouse: !state.shareMouse,\n            }\n        default:\n            return state\n    }\n}\n\n//#region Action Creators\nexport const setCursorSize = (newCursorSize) => {\n    return {\n        type: CHANGE_CURSORSIZE,\n        cursorSize: parseInt(newCursorSize),\n    }\n}\n\nexport const setFogToolSettings = (newFogOpacity, newFogRadius) => {\n    return {\n        type: CHANGE_FOG_SETTINGS,\n        fogOpacity: newFogOpacity,\n        fogRadius: parseInt(newFogRadius),\n    }\n}\n\nexport const setDrawToolSettings = (newDrawColor, newDrawSize) => {\n    return {\n        type: CHANGE_DRAW_SETTINGS,\n        drawColor: newDrawColor,\n        drawSize: parseInt(newDrawSize),\n    }\n}\n\nexport const setToolSettings = (newTool, newSubtool) => {\n    return {\n        type: CHANGE_TOOL,\n        tool: newTool,\n        subtool: newSubtool,\n    }\n}\n\nexport const setUsername = (newUsername) => {\n    return {\n        type: CHANGE_USERNAME,\n        username: newUsername,\n    }\n}\n\nexport const toggleMousesharing = () => {\n    return {\n        type: TOGGLE_MOUSESHARING,\n    }\n}\n//#endregion Action Creators\n\nexport default settingsReducer\n","import { \n    SET_GAMESETTINGS,\n    /* SET_ISHOST,\n    SET_ROOM,*/\n    SET_CURSORS,\n    SET_LAST_COORDINATES,\n    SET_DOWN_COORDINATES \n} from '../redux/constants'\n\nconst initialMetadataState = {\n    isHost: undefined,\n    room: undefined,\n    cursors: [],\n    lastX: undefined,\n    lastY: undefined,\n    downX: undefined,\n    downY: undefined,\n}\n\nconst metadataReducer = (state = initialMetadataState, action) => {\n    switch (action.type) {\n        case SET_GAMESETTINGS:\n            return {\n                ...state,\n                isHost: action.isHost,\n                room: action.room,\n            }\n        //TODO: Delete if unused\n        /*\n        case SET_ISHOST:\n            return {\n                ...state,\n                isHost: action.isHost,\n            }\n        case SET_ROOM:\n            return {\n                ...state,\n                room: action.room,\n            }\n        */\n       case SET_CURSORS:\n           return {\n               ...state,\n               cursors: action.cursors,\n           }\n        case SET_LAST_COORDINATES:\n            return {\n                ...state,\n                lastX: action.lastX,\n                lastY: action.lastY,\n            }\n        case SET_DOWN_COORDINATES:\n            return {\n                ...state,\n                downX: action.downX,\n                downY: action.downY,\n            }\n        default:\n            return state\n    }\n}\n\n//#region Action Creators\nexport const setGameSettings = (newIsHost, newRoom) => {\n    return {\n        type: SET_GAMESETTINGS,\n        isHost: newIsHost,\n        room: newRoom,\n    }\n}\n\n//TODO: Delete if unused\n/*\nexport const setIsHost = (newIsHost) => {\n    return {\n        type: SET_ISHOST,\n        isHost: newIsHost,\n    }\n}\n\nexport const setRoom = (newRoom) => {\n    return {\n        type: SET_ROOM,\n        room: newRoom,\n    }\n}\n*/\n\nexport const setCursors = (newCursors) => {\n    return {\n        type: SET_CURSORS,\n        cursors: newCursors,\n    }\n}\n\nexport const setLastCoordinates = (newLastX, newLastY) => {\n    return {\n        type: SET_LAST_COORDINATES,\n        lastX: newLastX,\n        lastY: newLastY,\n    }\n}\n\nexport const setDownCoordinates = (newDownX, newDownY) => {\n    return {\n        type: SET_DOWN_COORDINATES,\n        downX: newDownX,\n        downY: newDownY,\n    }\n}\n//#endregion Action Creators\n\nexport default metadataReducer\n","const guid = () => {\n\treturn 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n\t\tconst r = (window.crypto.getRandomValues(new Uint32Array(1))[0] * Math.pow(2,-32) * 16) | 0\n\t\tconst v = c === 'x' ? r : (r & 0x3 | 0x8) /* eslint-disable-line no-mixed-operators */\n\t\treturn v.toString(16)\n\t})\n}\nexport default guid\n","import {\n    OVERWRITE_GAME,\n    LOAD_MAP, \n    INCREMENT_GEN, \n    SET_ISFIRSTLOADDONE, \n    SET_ISFOGLOADED, \n    UPDATE_MAPS, \n    ADD_MAP,\n    DELETE_MAP,\n    UPDATE_TOKENS,\n    ADD_TOKEN,\n    DELETE_TOKEN,\n    COPY_TOKEN,\n    UPDATE_TOKEN_VALUE,\n    TOGGLE_TOKEN_VALUE,\n    RESET_FOG,\n    RESET_DRAW\n} from '../redux/constants'\nimport guid from '../controllers/guid.js'\n\nconst initialGameState = {\n    mapId: undefined,\n    gen: 0,\n    width: window.innerWidth,\n    height: window.innerHeight,\n    isFogLoaded: false,\n    isFirstLoadDone: false, /* Ensure we don't overwrite localStorage before load is done */\n    maps: [],\n    tokens: [],\n}\n\nconst gameReducer = (state = initialGameState, action) => {\n    const maps = JSON.parse(JSON.stringify(state.maps))\n    const tokens = JSON.parse(JSON.stringify(state.tokens))\n    switch (action.type) {\n        case OVERWRITE_GAME:\n            return {\n                ...state,\n                ...action.game,\n            }\n        case LOAD_MAP:\n            return {\n                ...state,\n                mapId: parseInt(action.mapId),\n            }\n        case INCREMENT_GEN:\n            return {\n                ...state,\n                gen: state.gen + 1,\n            }\n        case SET_ISFOGLOADED:\n            return {\n                ...state,\n                isFogLoaded: action.isFogLoaded,\n            }\n        case SET_ISFIRSTLOADDONE:\n            return {\n                ...state,\n                isFirstLoadDone: action.isFirstLoadDone,\n            }\n        case UPDATE_MAPS:\n            return {\n                ...state,\n                maps: action.maps,\n                mapId: state.mapId ? state.mapId : undefined,\n            }\n        case ADD_MAP:\n            const newMapId = state.maps.length\n            const mapsWithNewMap = maps.concat({\n                ...action.map,\n                $id: newMapId,\n            })\n            return {\n                ...state,\n                maps: mapsWithNewMap,\n                mapId: state.mapId ? state.mapId : newMapId,\n                isFirstLoadDone: true,\n                isFogLoaded: true,\n            }\n        case DELETE_MAP:\n\t\t\tconst newMaps = maps.filter((map) => map.$id !== parseInt(action.mapId))\n            return {\n                ...state,\n                maps: newMaps,\n                mapId: parseInt(action.mapId) === state.mapId ? undefined : state.mapId,\n            }\n        case UPDATE_TOKENS:\n            return {\n                ...state,\n                tokens: action.tokens,\n            }\n        case ADD_TOKEN:\n            return {\n                ...state,\n                tokens: state.tokens.concat(action.token)\n            }\n        case DELETE_TOKEN:\n            const newTokens = tokens.filter((token) => token.guid !== action.tokenGuid)\n            return {\n                ...state,\n                tokens: newTokens,\n            }\n        case COPY_TOKEN:\n            const tokenCopy = state.tokens.filter((token) => token.guid === action.tokenGuid)\n            tokenCopy.guid = guid()\n            return {\n                ...state,\n                tokens: state.tokens.concat(tokenCopy)\n            }\n        case UPDATE_TOKEN_VALUE:\n            const tokensCopy = state.tokens.map((token) => {\n                return token.guid !== action.tokenGuid ? token : {\n                    ...token,\n                    [action.key]: action.value\n                }\n            })\n            return {\n                ...state,\n                tokens: tokensCopy,\n            }\n        case TOGGLE_TOKEN_VALUE:\n            const tokensCopy2 = state.tokens.map((token) => {\n                return token.guid !== action.tokenGuid ? token : {\n                    ...token,\n                    [action.key]: !token[action.key]\n                }\n            })\n            return {\n                ...state,\n                tokens: tokensCopy2,\n            }\n        case RESET_FOG:\n\t\t\tconst fogResetMaps = state.maps.map((map) => {\n                return map.$id === state.mapId ? {\n                        ...map,\n                        fogPaths: [],\n                    } \n                    : map\n                })\n            return {\n                ...state,\n                maps: fogResetMaps,\n            }\n        case RESET_DRAW:\n            const drawResetMaps = state.maps.map((map) => {\n                return map.$id === state.mapId ? {\n                        ...map,\n                        drawPaths: [],\n                    } \n                    : map\n                })\n            return {\n                ...state,\n                maps: drawResetMaps,\n            }\n        default:\n            return state\n    }\n}\n\n//#region Action Creators\nexport const overwriteGame = (newGame) => {\n    return {\n        type: OVERWRITE_GAME,\n        game: newGame,\n    }\n}\n\nexport const loadMap = (newMapId) => {\n    return {\n        type: LOAD_MAP,\n        mapId: parseInt(newMapId),\n    }\n}\n\nexport const incrementGen = () => {\n    return {\n        type: INCREMENT_GEN,\n    }\n}\n\nexport const setIsFogLoaded = (newIsFogLoaded) => {\n    return {\n        type: SET_ISFOGLOADED,\n        isFogLoaded: newIsFogLoaded,\n    }\n}\n\nexport const setIsFirstLoadDone = (newIsFirstLoadDone) => {\n    return {\n        type: SET_ISFIRSTLOADDONE,\n        isFirstLoadDone: newIsFirstLoadDone,\n    }\n}\n\nexport const updateMaps = (newMaps) => {\n    return {\n        type: UPDATE_MAPS,\n        maps: newMaps,\n    }\n}\n\nexport const addMap = (mapName, width, height) => {\n    const newMap = {\n        name: mapName,\n        $id: 0,\n        imageUrl: '',\n        x: 0,\n        y: 0,\n        width: width,\n        height: height,\n        drawPaths: [],\n        fogPaths: [],\n    }\n\n    return {\n        type: ADD_MAP,\n        map: newMap,\n    }\n}\n\nexport const deleteMap = (mapIdToDelete) => {\n    return {\n        type: DELETE_MAP,\n        mapId: mapIdToDelete,\n    }\n}\n\nexport const updateTokens = (newTokens) => {\n    return {\n        type: UPDATE_TOKENS,\n        tokens: newTokens,\n    }\n}\n\nexport const addToken = (tokenName, tokenUrl, mapId) => {\n    const newToken = {\n        guid: guid(),\n        name: tokenName,\n        url: tokenUrl,\n        mapId: mapId,\n        $selected: undefined,\n        $x0: 0,\n        $y0: 0,\n        x: 0,\n        y: 0,\n        ko: undefined,\n        pc: undefined,\n        w: 0,\n        h: 0,\n    }\n\n    return {\n        type: ADD_TOKEN,\n        token: newToken,\n    }\n}\n\nexport const deleteToken = (tokenGuidToDelete) => {\n    return {\n        type: DELETE_TOKEN,\n        tokenGuid: tokenGuidToDelete,\n    }\n}\n\nexport const copyToken = (tokenGuidToCopy) => {\n    return {\n        type: COPY_TOKEN,\n        tokenGuid: tokenGuidToCopy,\n    }\n}\n\nexport const updateTokenValue = (tokenGuidToUpdate, key, value) => {\n    return {\n        type: UPDATE_TOKEN_VALUE,\n        tokenGuid: tokenGuidToUpdate,\n        key: key,\n        value: value,\n    }\n}\n\nexport const toggleTokenValue = (tokenGuidToUpdate, key) => {\n    return {\n        type: TOGGLE_TOKEN_VALUE,\n        tokenGuid: tokenGuidToUpdate,\n        key: key,\n    }\n}\n\nexport const resetFog = () => {\n    return {\n        type: RESET_FOG,\n    }\n}\n\nexport const resetDraw = () => {\n    return {\n        type: RESET_DRAW,\n    }\n}\n//#endregion Action Creators\n\nexport default gameReducer\n","import { useContext } from \"react\";\nimport { WebSocketContext } from \"../contexts/WebSocketProvider\";\n\nexport const useWebSocket = () => {\n    const webSocket = useContext(WebSocketContext)\n    return webSocket\n}\n\nconst sendData = (webSocket, data) => {\n    if (webSocket && webSocket.readyState === WebSocket.OPEN)\n        webSocket.send(JSON.stringify(data))\n    else\n        console.error('no websocket')\n}\n\nexport const pushCursor = (webSocket, wsSettings, x, y, username) => {\n    sendData(webSocket, {\n        type: 'pushCursor',\n        from: wsSettings.guid,\n        username: wsSettings.username,\n        x: x,\n        y: y,\n    })\n}\n\nexport const pushDrawPath = (webSocket, wsSettings, newDrawPath) => {\n    sendData(webSocket, {\n        type: 'pushDrawPath',\n        from: wsSettings.guid,\n        username: wsSettings.username,\n        drawPath: newDrawPath,\n    })\n}\n\nexport const pushDrawReset = (webSocket, wsSettings) => {\n    sendData(webSocket, {\n        type: 'pushDrawReset',\n        from: wsSettings.guid,\n        username: wsSettings.username,\n    })\n}\n\nexport const pushFogPath = (webSocket, wsSettings, newFogPath) => {\n    sendData(webSocket, {\n        type: 'pushFogPath',\n        from: wsSettings.guid,\n        username: wsSettings.username,\n        fogPath: newFogPath,\n    })\n}\n\nexport const pushFogReset = (webSocket, wsSettings) => {\n    sendData(webSocket, {\n        type: 'pushFogReset',\n        from: wsSettings.guid,\n        username: wsSettings.username,\n    })\n}\n\nexport const pushMapState = (webSocket, wsSettings, maps, mapId) => {\n    sendData(webSocket, {\n        type: 'pushMapState',\n        from: wsSettings.guid,\n        username: wsSettings.username,\n        maps: maps,\n        mapId: mapId,\n    })\n}\n\nexport const pushMapId = (webSocket, wsSettings, mapId) => {\n    sendData(webSocket, {\n        type: 'pushMapId',\n        from: wsSettings.guid,\n        username: wsSettings.username,\n        mapId: mapId,\n    })\n}\n\nexport const pushGameRefresh = (webSocket, wsSettings, game, additionalAttributes) => {\n    sendData(webSocket, {\n        type: 'pushGameRefresh',\n        from: wsSettings.guid,\n        username: wsSettings.username,\n        game: game,\n        ...additionalAttributes,\n    })\n}\n\nexport const pushSingleToken = (webSocket, wsSettings, token) => {\n    //TODO: pushSingleToken\n    /*\n    const tokenCopy = Object.assign({}, token)\n    this.scrubObject(tokenCopy)\n    const data = {type: 'pushSingleToken', i: index, a: tokenCopy}\n    this.send(data)\n    */\n}\n\nexport const pushTokens = (webSocket, wsSettings, tokens) => {\n    //TODO: pushTokens\n    /*\n    if (!tokens)\n        return\n    const tokensCopy = JSON.parse(JSON.stringify(tokens))\n    const data = { type: 'pushTokens', tokens: tokensCopy }\n    data.tokens.forEach(token => this.scrubObject(token))\n    this.send(data)\n    */\n}\n\nexport const requestRefresh = (webSocket, wsSettings) => {\n    sendData(webSocket, {\n        type: 'requestRefresh',\n        from: wsSettings.guid,\n        username: wsSettings.username,\n    })\n}\n","import React, { useEffect, useState, createContext } from 'react'\nimport { connect } from 'react-redux'\nimport guid from '../controllers/guid.js'\nimport { requestRefresh } from '../hooks/useSocket.js'\nrequire('dotenv').config()\n\nconst DEBUG_MODE = process.env.REACT_APP_DEBUG ? process.env.REACT_APP_DEBUG : false\nconst SOCKET_RECONNECTION_TIMEOUT = 2500\nconst SOCKET_SERVER_PORT = process.env.PORT || process.env.REACT_APP_PORT || 8000\n\nconst generateWebSocketUrl = (room, guid) => {\n    let host = window.location.host.replace(/:\\d+$/, '')\n\tconst protocol = /https/.test(window.location.protocol) ? 'wss' : 'ws'\n\n    return DEBUG_MODE\n        ? `${protocol}://${host}:${SOCKET_SERVER_PORT}/${room}?guid=${guid}`\n        : `${protocol}://${host}/${room}?guid=${guid}`\n}\n\nconst createWebSocket = (room, guid) => {\n    console.log('creating websocket, room:',room,'guid:',guid)\n    const webSocketUrl = generateWebSocketUrl(room, guid)\n    console.log('connecting to: ',webSocketUrl)\n    return new WebSocket(webSocketUrl)\n}\n\nexport const WebSocketContext = createContext(createWebSocket('',''))\n\nconst WebSocketProvider = ({ children, metadata }) => {\n    const [wsSettings, setWsSettings] = useState({\n        room: metadata.room, \n        isHost: metadata.isHost,\n        guid: guid(),\n        username: '',\n    })\n    const [ws, setWs] = useState(createWebSocket(wsSettings.room, wsSettings.guid))\n\n    useEffect(() => {\n        const onClose = () => {\n            setTimeout(() => {\n                setWs(createWebSocket(wsSettings.room, wsSettings.guid))\n            }, SOCKET_RECONNECTION_TIMEOUT)\n        }\n\n        const onOpen = () => {\n            if (!wsSettings.isHost) {\n                requestRefresh(ws, wsSettings)\n            }\n        }\n\n        ws.addEventListener('close', onClose)\n        ws.addEventListener('open', onOpen)\n\n        return () => {\n            ws.removeEventListener('close', onClose)\n            ws.removeEventListener('open', onOpen)\n        }\n    }, [ws, setWs, wsSettings])\n\n    return (\n        <WebSocketContext.Provider value={ [ws, wsSettings, setWsSettings] }>{ children }</WebSocketContext.Provider>\n    )\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tmetadata: state.metadata,\n\t}\n}\n\nexport default connect(mapStateToProps, undefined)(WebSocketProvider)\n","const drawImage = (url, which, map, context, resizeCanvases) => {\n\t// Handle 'whiteboard' (no bg img)\n\tif (!url || url.trim().length === 0) {\n\t\tif (resizeCanvases) {\n\t\t\tresizeCanvases()\n\t\t} // Clear canvas\n\t\treturn Promise.resolve(map.width, map.height)\n\t}\n\n\t//Handle ordinary image\n\treturn new Promise((resolve, reject) => {\n\t\tconst ctx = context\n\t\tconst img = new Image()\n\t\timg.onload = () => {\n\t\t\tlet w = map.width\n\t\t\tlet h = map.height\n\t\t\tif (!w && !h) {\n\t\t\t\tw = img.width\n\t\t\t\th = img.height\n\t\t\t} else if (!w)\n\t\t\t\tw = h * img.width / img.height\n\t\t\telse if (!h)\n\t\t\t\th = w * img.height / img.width\n\t\t\tconst promise = resizeCanvases ? resizeCanvases(w, h) : Promise.resolve()\n\t\t\tpromise.then(() => {\n\t\t\t\tctx.drawImage(img, map.x || 0, map.y || 0, w, h)\n\t\t\t\tresolve(w, h)\n\t\t\t})\n\t\t}\n\t\timg.onerror = (err) => {\n\t\t\tconsole.error(`Unable to draw image.`, img.src)\n\t\t\treject(`Unable to draw ${which}Url`)\n\t\t}\n\t\timg.src = url\n\t})\n}\n\nexport default drawImage\n","import { useRef, useEffect } from 'react'\n\nconst useCanvas = (draw, gameState, options={}) => {\n\tconst canvasRef = useRef(null)\n\n\tuseEffect(() => {\n\t\tconst canvas = canvasRef.current\n\t\tconst context = canvas.getContext(options.context || '2d')\n\t\t\n\t\tdraw(context)\n\t}, [draw]) // eslint-disable-line react-hooks/exhaustive-deps\n\n\treturn canvasRef\n}\nexport default useCanvas\n","import React from 'react'\nimport useCanvas from '../hooks/useCanvas.js'\n\nconst Canvas = ({ id, draw, options, ...rest }) => {\n\tconst canvasRef = useCanvas(draw)\n\t\n\treturn (\n\t\t<canvas id={ id } ref={ canvasRef } { ...rest } />\n\t)\n}\n\nexport default Canvas\n","import React from 'react'\nimport { connect } from 'react-redux'\nimport { updateTokens } from '../reducers/gameReducer'\nimport drawImage from '../controllers/drawImage.js'\nimport Canvas from './Canvas.js'\n\n\nconst Background = ({ game, updateTokens }) => {\n\tconst map = game.maps ? game.maps[game.mapId] : undefined\n\n\tconst draw = (ctx) => {\n\t\tif (!map) {\n\t\t\treturn\n\t\t}\n\t\tdrawImage(map.imageUrl, map.name, map, ctx, null)\n\t}\n\n\tconst handleOnClick = (e) => {\n\t\t//TODO: Handle onClick of Maps\n\t\t/*\n\t\tsetControlPanelState({\n\t\t\t...controlPanelState,\n\t\t\ttoggleOnMaps: false,\n\t\t\ttoggleOnTokens: false,\n\t\t}, () => updateTokens(token => token.$selected = false))\n\t\t*/\n\t}\n\n\treturn (\n\t\t<Canvas \n\t\t\tid='background' \n\t\t\tonClick={ handleOnClick } \n\t\t\twidth={ map ? map.width : 0 } \n\t\t\theight={ map ? map.height : 0 } \n\t\t\tdraw={ draw } />\n\t)\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tgame: state.game,\n\t}\n}\n\nconst mapDispatchToProps = {\n\tupdateTokens,\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Background)\n","import React from 'react'\nimport { connect } from 'react-redux'\nimport Canvas from './Canvas.js'\n\nconst Drawing = ({ game }) => {\n\tconst width = game.width\n\tconst height = game.height\n\n\tconst getMap = () => {\n\t\tif (game.maps.length === 0)\n\t\t\treturn undefined\n\t\tconst currMap = game.maps.filter((map) => parseInt(map.$id) === parseInt(game.mapId))\n\t\treturn currMap.length > 0 ? currMap[0] : game.maps[0]\n\t}\n\tconst map = getMap()\n\n\tconst renderDrawingLayer = (ctx) => {\n\t\tif (!map) {\n\t\t\treturn\n\t\t}\n\t\tif (!ctx)\n\t\t\treturn\n\t\t\n\t\tctx.beginPath()\n\t\tctx.clearRect(0, 0, width, height)\n\t\tfor(let pathId = 0; pathId < map.drawPaths.length; pathId++) {\n\t\t\tconst currPath = map.drawPaths[pathId]\n\t\t\tconst tool = currPath.length > 0 ? currPath[0].tool : ''\n\t\t\tswitch (tool) {\n\t\t\t\tcase 'draw': \n\t\t\t\t\tdraw(ctx, currPath)\n\t\t\t\t\tbreak\n\t\t\t\tcase 'erease':\n\t\t\t\t\terease(ctx, currPath)\n\t\t\t\t\tbreak\n\t\t\t\tdefault:\n\t\t\t\t\tbreak\n\t\t\t}\n\t\t\tctx.stroke()\n\t\t}\n\t}\n\n\tconst draw = (ctx, currPath) => {\n\t\tctx.globalCompositeOperation = 'source-over'\n\t\tctx.beginPath()\n\t\tfor (let pointId = 0; pointId < currPath.length; pointId++) {\n\t\t\tctx.lineCap = 'round'\n\t\t\tctx.fillStyle = currPath[pointId].drawColor\n\t\t\tctx.lineWidth = currPath[pointId].drawSize\n\t\t\tctx.strokeStyle = currPath[pointId].drawColor\n\t\t\tif (pointId === 0) {\n\t\t\t\tctx.moveTo(currPath[pointId].x, currPath[pointId].y)\n\t\t\t} else {\n\t\t\t\tctx.lineTo(currPath[pointId].x, currPath[pointId].y)\n\t\t\t}\n\t\t}\n\t}\n\n\tconst erease = (ctx, currPath) => {\n\t\tctx.globalCompositeOperation = 'destination-out'\n\t\tctx.beginPath()\n\t\tfor (let pointId = 0; pointId < currPath.length; pointId++) {\n\t\t\tctx.lineCap = 'round'\n\t\t\tctx.lineWidth = currPath[pointId].drawSize\n\t\t\tif (pointId === 0) {\n\t\t\t\tctx.moveTo(currPath[pointId].x, currPath[pointId].y)\n\t\t\t} else {\n\t\t\t\tctx.lineTo(currPath[pointId].x, currPath[pointId].y)\n\t\t\t}\n\t\t}\n\t}\n\t\n\treturn (\n\t\t<Canvas \n\t\t\tid='drawing' \n\t\t\tclassName='passthrough' \n\t\t\twidth={ width } \n\t\t\theight={ height } \n\t\t\tdraw={ renderDrawingLayer } />\n\t)\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tgame: state.game,\n\t}\n}\n\nexport default connect(mapStateToProps, undefined)(Drawing)\n","import React from 'react'\nimport { connect } from 'react-redux'\nimport Canvas from './Canvas.js'\n\nconst Fog = ({ game, metadata, settings }) => {\n\tconst fogOpacity = metadata.isHost ? settings.fogOpacity : 1\n\tconst width = game.width\n\tconst height = game.height\n\n\tconst getMap = () => {\n\t\tif (game.maps.length === 0)\n\t\t\treturn undefined\n\t\tconst currMap = game.maps.filter((map) => parseInt(map.$id) === parseInt(game.mapId))\n\t\treturn currMap.length > 0 ? currMap[0] : game.maps[0]\n\t}\n\tconst map = getMap()\n\n\tconst renderFogLayer = (ctx) => {\n\t\tif (!map) {\n\t\t\treturn\n\t\t}\n\t\tif (!ctx)\n\t\t\treturn\n\t\t\n\t\tctx.beginPath()\n\t\tctx.globalCompositeOperation = 'destination-over'\n\t\tctx.fillStyle = 'black'\n\t\tctx.fillRect(0, 0, width, height)\n\t\tfor(let pathId = 0; pathId < map.fogPaths.length; pathId++) {\n\t\t\tconst currPath = map.fogPaths[pathId]\n\t\t\tereaseFog(ctx, currPath)\n\t\t\tctx.stroke()\n\t\t}\n\t}\n\n\tconst ereaseFog = (ctx, currPath) => {\n\t\tctx.beginPath()\n\t\tctx.globalCompositeOperation = 'destination-out'\n\t\tlet gradient\n\t\tfor (let pointId = 0; pointId < currPath.length; pointId++) {\n\t\t\tgradient = ctx.createRadialGradient(currPath[pointId].x, currPath[pointId].y, currPath[pointId].r2 || 1, currPath[pointId].x, currPath[pointId].y, currPath[pointId].r*0.75)\n\t\t\tgradient.addColorStop(0, 'rgba(0,0,0,255)')\n\t\t\tgradient.addColorStop(1, 'rgba(0,0,0,0)')\n\t\t\tctx.fillStyle = gradient\n\t\t\tctx.fillRect(currPath[pointId].x-currPath[pointId].r, currPath[pointId].y-currPath[pointId].r, currPath[pointId].x+currPath[pointId].r, currPath[pointId].y+currPath[pointId].r)\n\t\t}\n\t}\n\n\treturn (\n\t\t<Canvas \n\t\t\tid='fog' \n\t\t\tclassName='passthrough' \n\t\t\tstyle={{ opacity: fogOpacity }} \n\t\t\twidth={ width } \n\t\t\theight={ height } \n\t\t\tdraw={ renderFogLayer } />\n\t)\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tgame: state.game,\n\t\tsettings: state.settings,\n\t\tmetadata: state.metadata,\n\t}\n}\n\nexport default connect(mapStateToProps, undefined)(Fog)\n","import React from 'react';\nimport { connect } from 'react-redux'\n\nconst Overlay = ({ game, overlayRef }) => {\n\tconst maps = game.maps\n\tconst map = maps[game.mapId] || undefined\n\tconst width = map ? map.width : game.width\n\tconst height = map ? map.height : game.height\n\tconst canvasRef = overlayRef\n\n\treturn (\n\t\t<canvas \n\t\t\tid='overlay' \n\t\t\tref={ canvasRef } \n\t\t\twidth={ width } \n\t\t\theight={ height } />\n\t)\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tgame: state.game,\n\t}\n}\n\nexport default connect(mapStateToProps, undefined)(Overlay)\n","const TokenView = ({ divStyle, token, classes, imgStyle, onMouseUp, onMouseDown }) => {\n\treturn (\n\t\t<div style={ divStyle } title={ token.name } className={ classes.join(' ') } onMouseDown={ (e) => onMouseDown(e) }>\n\t\t\t<img src={ token.url } alt={ token.name ||'' } style={ imgStyle } />\n\t\t</div>\n\t)\n}\n\nexport default TokenView\n","import React from 'react'\nimport { connect } from 'react-redux'\nimport TokenView from '../views/TokenView.js'\n\nconst Token = ({ token, isHost, game, settings }) => {\n\tconst isMoveTool = () => {\n\t\treturn settings.tool === 'move'\n\t}\n\n\tconst onMouseDown = (e) => {\n\t\tif (!isMoveTool())\n\t\t\treturn\n\t\t//TODO: Fix multi token selection\n\t\t/*\n\t\tif (!token.$selected)\n\t\t\tselectGameToken(token, true, e.metaKey)\n\t\t*/\n\t}\n\n\tif (!token.url || !token.url.trim())\n\t\treturn null\n\t\n\tconst classes = [\n\t\t'token',\n\t\ttoken.ko && 'dead',\n\t\ttoken.pc ? 'pc' : 'npc',\n\t\ttoken.$selected && 'selected',\n\t\tisHost && !token.pc && 'grabbable',\n\t]\n\tconst divStyle = {\n\t\tleft: token.x || 0,\n\t\ttop: token.y || 0,\n\t}\n\tconst imgStyle = {\n\t\twidth: token.width || undefined,\n\t\theight: token.height || undefined,\n\t}\n\tconst showToken = ((token.mapId === undefined) || (game.mapId === token.mapId))\n\n\treturn (\n\t\tshowToken ?\n\t\t\t<TokenView \n\t\t\t\tdivStyle={ divStyle } \n\t\t\t\ttoken={ token } \n\t\t\t\tclasses={ classes } \n\t\t\t\timgStyle={ imgStyle } \n\t\t\t\tonMouseDown={ onMouseDown }\n\t\t\t/>\n\t\t: null\n\t)\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tgame: state.game,\n\t\tsettings: state.settings,\n\t}\n}\n\nconst mapDispatchToProps = {\n\t\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Token)\n","const Cursor = ({ cursor, size, name }) => {\n\tconst divStyle = {\n\t\ttop: cursor.y,\n\t\tleft: cursor.x,\n\t}\n\tconst imgStyle = {\n\t\tfontSize: size || undefined,\n\t}\n\n\treturn (\n\t\t<div style={ divStyle } className='cursor' >\n\t\t\t<span role='img' aria-label='pointer' style={ imgStyle }>&#x1f5e1;</span>\n\t\t\t{ cursor.u || name }\n\t\t</div>\n\t)\n}\n\nexport default Cursor\n","function Button({ title, value, onClick, isSelected, style, disabled }) {\n\treturn (\n\t\t<button title={ title } onClick={ onClick } className={ isSelected ? 'selected' : null } style={ style } disabled={ disabled }>\n\t\t\t<span role='img' aria-label={ title }>{ value }</span>\n\t\t</button>\n\t)\n}\n\nexport default Button\n","import Button from '../views/Button.js'\n\nfunction ToggleButton({ controlPanelState, setControlPanelState, title, value }) {\n\tconst toggleKey = `toggleOn${title}`\n\tconst onClick = () => {\n\t\tsetControlPanelState({\n\t\t\t...controlPanelState,\n\t\t\t[toggleKey]: !controlPanelState[toggleKey],\n\t\t})\n\t}\n\tconst isSelected = controlPanelState[toggleKey]\n\treturn (\n\t\t<Button title={ title } value={ value } onClick={ onClick } isSelected={ isSelected } />\n\t)\n}\n\nexport default ToggleButton\n","import Button from './Button.js'\n\nconst ToolControlsView = ({ tool, subtool, drawColor, setDrawColor, drawSize, setDrawSize, fogOpacity, setFogOpacity, fogRadius, setFogRadius, setSubtool, resetFog, resetDrawing }) => {\n\tswitch (tool) {\n\t\tcase 'draw':\n\t\t\treturn (\n\t\t\t\t<span>\n\t\t\t\t\t<Button title='eraser' value='&#x1f9fd;' onClick={ () => setSubtool('eraser') } isSelected={ subtool === 'eraser' } />\n\t\t\t\t\t<Button title='pencil' value='&#x1f58d;' onClick={ () => setSubtool('pencil') } isSelected={ subtool === 'pencil' } />\n\t\t\t\t\t<input size='3' title='draw size' value={ drawSize } onChange={ (e) => setDrawSize(e.target.value) } type='number' step='3' min='1' />\n\t\t\t\t\t<input size='3' title='draw color' value={ drawColor } onChange={ (e) => setDrawColor(e.target.value) } />\n\t\t\t\t\t<Button style={{ backgroundColor: drawColor }} value='&#x1f58c;' disabled />\n\t\t\t\t\t<Button title='reset drawing' onClick={ resetDrawing } value='&#x1f300;' />\n\t\t\t\t</span>\n\t\t\t)\n\t\tcase 'move':\n\t\t\treturn null\n\t\tcase 'fog':\n\t\t\treturn (\n\t\t\t\t<span>\n\t\t\t\t\t<Button title='reset fog' onClick={ resetFog } value='&#x1f300;' />\n\t\t\t\t\t<input size='3' title='fog radius' value={ fogRadius } onChange={ (e) => setFogRadius(e.target.value) } type='number' step='5' min='1' />\n\t\t\t\t\t<input size='3' title='fog opacity' step='0.05' min='0' max='1' value={ fogOpacity } onChange={ (e) => setFogOpacity(e.target.value) } type='number' />\n\t\t\t\t</span>\n\t\t\t)\n\t\tdefault:\n\t\t\treturn null\n\t}\n}\n\nexport default ToolControlsView\n","import { connect } from 'react-redux'\nimport { setToolSettings, setDrawToolSettings, setFogToolSettings } from '../reducers/settingsReducer.js'\nimport { resetFog, resetDraw } from '../reducers/gameReducer.js'\nimport ToolControlsView from \"../views/ToolControlsView.js\"\n\nconst ToolControls = ({ settings, setToolSettings, setDrawToolSettings, setFogToolSettings, resetFog, resetDraw }) => {\n\tconst setSubtool = (subtool) => {\n\t\tsetToolSettings(settings.tool, subtool)\n\t}\n\n\tconst setDrawColor = (value) => {\n\t\tsetDrawToolSettings(value, settings.drawSize)\n\t}\n\n\tconst setDrawSize = (value) => {\n\t\tconst newSize = value\n\t\tif (!isNaN(newSize))\n\t\t\tsetDrawToolSettings(settings.drawColor, newSize)\n\t}\n\n\tconst setFogOpacity = (value) => {\n\t\tconst newOpacity = value\n\t\tif (!isNaN(newOpacity))\n\t\t\tsetFogToolSettings(newOpacity, settings.fogRadius)\n\t}\n\n\tconst setFogRadius = (value) => {\n\t\tconst newRadius = value\n\t\tif (!isNaN(newRadius))\n\t\t\tsetFogToolSettings(settings.fogOpacity, newRadius)\n\t}\n\n\tconst resetFogOnCurrentMap = () => {\n\t\tresetFog()\n\t}\n\n\tconst resetDrawOnCurrentMap = () => {\n\t\tresetDraw()\n\t}\n\n\treturn (\n\t\t<span>\n\t\t\t<ToolControlsView \n\t\t\t\ttool={ settings.tool } \n\t\t\t\tsubtool={ settings.subtool } \n\t\t\t\tdrawColor={ settings.drawColor } \n\t\t\t\tsetDrawColor={ setDrawColor } \n\t\t\t\tdrawSize={ settings.drawSize } \n\t\t\t\tsetDrawSize={ setDrawSize } \n\t\t\t\tfogOpacity={ settings.fogOpacity } \n\t\t\t\tsetFogOpacity={ setFogOpacity } \n\t\t\t\tfogRadius={ settings.fogRadius } \n\t\t\t\tsetFogRadius={ setFogRadius } \n\t\t\t\tsetSubtool={ setSubtool } \n\t\t\t\tresetFog={ resetFogOnCurrentMap } \n\t\t\t\tresetDrawing={ resetDrawOnCurrentMap } />\n\t\t</span>\n\t)\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tsettings: state.settings,\n\t}\n}\n\nconst mapDispatchToProps = {\n\tsetToolSettings,\n\tsetDrawToolSettings,\n\tsetFogToolSettings,\n\tresetFog,\n\tresetDraw,\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ToolControls)\n","import Button from './Button.js'\n\nconst MapConfigView = ({ isSelected, mapConfigState, load, onTextChange, onIntegerChange, deleteMap }) => {\n\treturn (\n\t\t<div className={ isSelected ? 'selected' : null }>\n\t\t\t{ mapConfigState.name }\n\t\t\t<input value={ mapConfigState.imageUrl || '' } placeholder='Map url' size='8' onChange={ (e) => onTextChange('imageUrl', e) } />\n\t\t\tw:\n\t\t\t<input value={ mapConfigState.width || 0 } placeholder='width' className='text3' onChange={ (e) => onIntegerChange('width', e) } type='number' min='0' step='10' title='width' />\n\t\t\th:\n\t\t\t<input value={ mapConfigState.height || 0 } placeholder='height' className='text3' onChange={ (e) => onIntegerChange('height', e) } type='number' min='0' step='10' title='height' />\n\t\t\t<Button title='Save & load map' value='&#x1f4c0;' onClick={ load } />\n\t\t\t<Button title='Delete map' value='&#x1f5d1;' onClick={ deleteMap } />\n\t\t</div>\n\t)\n}\n\nexport default MapConfigView\n","import React, { useState } from 'react'\nimport { connect } from 'react-redux'\nimport { loadMap, updateMaps, deleteMap, setIsFogLoaded, setIsFirstLoadDone } from '../reducers/gameReducer.js'\nimport { pushMapId, useWebSocket } from '../hooks/useSocket.js'\nimport MapConfigView from '../views/MapConfigView.js'\n\nconst initialMapConfigState = (map, game) => {\n\tconst maps = game.maps\n\tconst existingMap = maps.filter((mapElement) => mapElement.$id === map.$id)\n\tconst currentMap = existingMap ? existingMap : { name: undefined, url: undefined, w: undefined, h: undefined, }\n\n\treturn {\n\t\t$id: parseInt(map.$id),\n\t\tname: currentMap.name ? currentMap.name : map.name,\n\t\timageUrl: currentMap.imageUrl ? currentMap.imageUrl : '',\n\t\twidth: currentMap.width ? currentMap.width : window.innerWidth,\n\t\theight: currentMap.height ? currentMap.height : window.innerHeight,\n\t\tx: 0,\n\t\ty: 0,\t\n\t}\n}\n\nconst MapConfig = ({ map, game, loadMap, updateMaps, deleteMap, setIsFogLoaded, setIsFirstLoadDone }) => {\n\tconst [mapConfigState, setMapConfigState] = useState(initialMapConfigState(map, game))\n\tconst [webSocket, wsSettings] = useWebSocket()\n\tconst isSelected = game.mapId === map.$id\n\n\tconst onTextChange = (key, evt) => {\n\t\tsetMapConfigState({\n\t\t\t...mapConfigState,\n\t\t\t[key]: evt.target.value,\n\t\t})\n\t}\n\n\tconst onIntegerChange = (key, evt) => {\n\t\tconst value = parseInt(evt.target.value) || undefined\n\t\tsetMapConfigState({\n\t\t\t...mapConfigState,\n\t\t\t[key]: value,\n\t\t})\n\t}\n\n\tconst load = () => {\n\t\tconst updatedMaps = game.maps.map((currMap) => {\n\t\t\treturn map.$id === currMap.$id ? { ...currMap, imageUrl: mapConfigState.imageUrl, width: mapConfigState.width, height: mapConfigState.height, } : currMap\n\t\t})\n\t\tupdateMaps(updatedMaps)\n\t\tloadMap(map.$id)\n\t\tsetIsFogLoaded(true)\n\t\tsetIsFirstLoadDone(true)\n\t\tpushMapId(webSocket, wsSettings, map.$id)\n\t}\n\n\tconst deleteCurrentMap = () => {\n\t\tif (window.confirm('Delete map?')) {\n\t\t\tdeleteMap(map.$id)\n\t\t}\n\t}\n\n\treturn (\n\t\tmap ?\n\t\t\t<MapConfigView \n\t\t\t\tisSelected={ isSelected } \n\t\t\t\tmapConfigState={ mapConfigState }  \n\t\t\t\tload={ load } \n\t\t\t\tonTextChange={ onTextChange } \n\t\t\t\tonIntegerChange={ onIntegerChange } \n\t\t\t\tdeleteMap={ deleteCurrentMap }\n\t\t\t/>\n\t\t: null\n\t)\n}\n\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tgame: state.game,\n\t}\n}\n\nconst mapDispatchToProps = {\n\tloadMap,\n\tupdateMaps,\n\tdeleteMap,\n\tsetIsFogLoaded,\n\tsetIsFirstLoadDone,\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MapConfig)\n","import MapConfig from '../components/MapConfig.js'\nimport Button from './Button.js'\n\nconst MapToolView = ({ maps, newMapName, setNewMapName, createMap }) => {\n\treturn (\n\t\t<div>\n\t\t\t<hr />\n\t\t\t<div>\n\t\t\t<input placeholder='New map name' onChange={ (e) => setNewMapName(e.target.value) } value={ newMapName } />\n\t\t\t<Button title='Create new map' value='&#x2795;' onClick={ createMap } disabled={ newMapName === '' } />\n\t\t\t{ maps.map((map) => (\n\t\t\t\t<MapConfig key={ `map${map.$id}` } map={ map } />\n\t\t\t))}\n\t\t\t</div>\n\t\t</div>\n\t)\n}\n\nexport default MapToolView\n","import { useState } from 'react'\nimport { connect } from 'react-redux'\nimport { addMap } from '../reducers/gameReducer.js'\nimport MapToolView from '../views/MapToolView.js'\n\nconst MapTool = ({ toggleOnMaps, game, addMap }) => {\n    const [newMapName, setNewMapName] = useState('')\n\n\tconst maps = game.maps\n\n    const createMap = () => {\n\t\taddMap(newMapName, window.innerWidth, window.innerHeight)\n\t\tsetNewMapName('')\n\t}\n\n\treturn (\n        toggleOnMaps ?\n\t\t    <MapToolView maps={ maps } newMapName={ newMapName } setNewMapName={ setNewMapName } createMap={ createMap } />\n            : null\n\t)\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tgame: state.game,\n\t}\n}\n\nconst mapDispatchToProps = {\n\taddMap,\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(MapTool)\n","import Button from './Button.js'\n\nconst HostTokenConfigView = ({ maps, token, copy, onToggle, selectToken, onTextChange, onIntegerChange, onMapSelect, deleteToken }) => {\n\treturn (\n\t\t<div className='tokenConfig'>\n\t\t\t<Button title='Duplicate token' value='&#x1f46f;' onClick={ copy } />\n\t\t\t<Button value={ token.pc ? '\\u{1f5a5}' : '\\u{1f464}' } onClick={ (e) => onToggle('pc', e) } title='pc/npc' />\n\t\t\t<Button value={ token.$selected ? '\\u{2705}' : '\\u{274C}' } onClick={ (e) => selectToken(token, e) } title='(un)select' />\n\t\t\t<Button value={ token.ko ? '\\u{1f940}' : '\\u{1f339}' } onClick={ (e) => onToggle('ko', e) } title='alive/dead' />\n\t\t\t<input value={ token.name || '' } placeholder='Name' size='8' onChange={ (e) => onTextChange('name', e) } />\n\t\t\t<input value={ token.url || '' } placeholder='Url' size='8' onChange={ (e) => onTextChange('url', e) } />\n\t\t\twh:\n\t\t\t<input value={ token.width || '' } placeholder='w' className='text2' onChange={ (e) => onIntegerChange('width', e) } type='number' step='5' min='0' title='width' />\n\t\t\t<input value={ token.height || '' } placeholder='h' className='text2' onChange={ (e) => onIntegerChange('height', e) } type='number' step='5' min='0' title='height' />\n\t\t\txy:\n\t\t\t<input value={ token.x || '' } placeholder='x' className='text3' onChange={ (e) => onIntegerChange('x', e) } type='number' step='5' title='x coord' />\n\t\t\t<input value={ token.y || '' } placeholder='y' className='text3' onChange={ (e) => onIntegerChange('y', e) } type='number' step='5' title='y coord' />\n\t\t\t<select defaultValue={ token.mapId } onChange={ (e) => onMapSelect(e) } title='which map'>\n\t\t\t\t<option key={ -1 } value={ -1 }>(all)</option>\n\t\t\t\t{ maps.map((map) => (\n\t\t\t\t\t<option key={ map.$id } value={ map.name }>{ maps.name }</option>\n\t\t\t\t))}\n\t\t\t</select>\n\t\t\t<Button title='Delete token' value='&#x1f5d1;' onClick={ deleteToken } />\n\t\t</div>\n\t)\n}\n\nexport default HostTokenConfigView\n","const GuestTokenConfigView = ({ token, onTextChange, onIntegerChange }) => {\n\treturn (\n\t\t<div className='tokenConfig'>\n\t\t\t<input value={ token.name || '' } placeholder='Name' size='8' onChange={ (e) => onTextChange('name', e) } />\n\t\t\t<input value={ token.url || '' } placeholder='Url' size='8' onChange={ (e) => onTextChange('url', e) } />\n\t\t\twh:\n\t\t\t<input value={ token.width || '' } placeholder='w' className='text2' onChange={ (e) => onIntegerChange('width', e) } type='number' step='5' min='0' title='width' />\n\t\t\t<input value={ token.height || '' } placeholder='h' className='text2' onChange={ (e) => onIntegerChange('height', e) } type='number' step='5' min='0' title='height' />\n\t\t\txy:\n\t\t\t<input value={ token.x || '' } placeholder='x' className='text3' onChange={ (e) => onIntegerChange('x', e) } type='number' step='5' title='x coord' />\n\t\t\t<input value={ token.y || '' } placeholder='y' className='text3' onChange={ (e) => onIntegerChange('y', e) } type='number' step='5' title='y coord' />\n\t\t</div>\n\t)\n}\n\nexport default GuestTokenConfigView\n","import React from 'react'\nimport { connect } from 'react-redux'\nimport { deleteToken, copyToken, updateTokenValue, toggleTokenValue, updateTokens } from '../reducers/gameReducer.js'\nimport HostTokenConfig from '../views/HostTokenConfigView.js'\nimport GuestTokenConfigView from '../views/GuestTokenConfigView.js'\n\nconst TokenConfig = ({ token, game, metadata, deleteToken, copyToken, updateTokenValue, toggleTokenValue }) => {\n\tconst selectToken = (token, tokenSelected) => {\n\t\tif (!token.pc && !metadata.isHost)\n\t\t\treturn\n\t\tconst updatedTokens = game.tokens.map((currToken) => {\n\t\t\t//TODO: Handle Multiselection / singleselection\n\t\t\treturn (currToken.guid === token.guid) ?\n\t\t\t\t{\n\t\t\t\t\t...currToken,\n\t\t\t\t\t$selected: tokenSelected ? tokenSelected : !currToken.$selected,\n\t\t\t\t\t$x0: currToken.x,\t//TODO: these coordinates should only be set, if selected = true\n\t\t\t\t\t$y0: currToken.y,\t//TODO: these coordinates should only be set, if selected = true\n\t\t\t\t}\n\t\t\t\t: currToken\n\t\t})\n\t\tupdateTokens(updatedTokens)\n\t}\n\n\tconst deleteCurrToken = () => {\n\t\tdeleteToken(token.guid)\n\t}\n\t\n\tconst copy = () => {\n\t\tcopyToken(token.guid)\n\t}\n\n\tconst onMapSelect = (e) => {\n\t\tlet value = parseInt(e.target.value)\n\t\tif (value < 0)\n\t\t\tvalue = undefined\n\t\tupdateTokenValue(token.guid, 'mapId', value)\n\t}\n\n\tconst onToggle = (key) => {\n\t\ttoggleTokenValue(token.guid, key)\n\t}\n\n\tconst onIntegerChange = (key, e) => {\n\t\tupdateTokenValue(token.guid, key, parseInt(e.target.value) || undefined)\n\t}\n\n\tconst onTextChange = (key, e) => {\n\t\tupdateTokenValue(token.guid, key, e.target.value)\n\t}\n\n\treturn (\n\t\t<div>\n\t\t\t{ token ?\n\t\t\t\tmetadata.isHost ?\n\t\t\t\t<HostTokenConfig \n\t\t\t\t\tmaps={ game.maps } \n\t\t\t\t\ttoken={ token } \n\t\t\t\t\tcopy={ copy } \n\t\t\t\t\tonToggle={ onToggle } \n\t\t\t\t\tselectToken={ selectToken } \n\t\t\t\t\tonTextChange={ onTextChange } \n\t\t\t\t\tonIntegerChange={ onIntegerChange } \n\t\t\t\t\tonMapSelect={ onMapSelect } \n\t\t\t\t\tdeleteToken={ deleteCurrToken }\n\t\t\t\t/>\n\t\t\t\t:\n\t\t\t\t<GuestTokenConfigView \n\t\t\t\t\ttoken={ token } \n\t\t\t\t\tonTextChange={ onTextChange } \n\t\t\t\t\tonIntegerChange={ onIntegerChange }\n\t\t\t\t/>\n\t\t\t: null\n\t\t\t}\n\t\t</div>\n\t)\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tgame: state.game,\n\t\tmetadata: state.metadata,\n\t}\n}\n\nconst mapDispatchToProps = {\n\tdeleteToken,\n\tcopyToken,\n\tupdateTokenValue,\n\ttoggleTokenValue,\n\tupdateTokens,\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(TokenConfig)\n","import TokenConfig from '../components/TokenConfig.js'\nimport Button from './Button.js'\n\nconst TokenToolView = ({ newTokenUrl, setNewTokenUrl, createToken, tokens }) => {\n\treturn (\n\t\t<div>\n\t\t\t<hr />\n\t\t\t<input placeholder='New token url' onChange={ (e) => setNewTokenUrl(e.target.value) } value={ newTokenUrl } />\n\t\t\t<Button title='Create new token' value='&#x2795;' onClick={ createToken } />\n\t\t\t{ tokens.map((token, $i) => (\n\t\t\t\t<TokenConfig key={ `token${$i}` } token={ token } />\n\t\t\t))}\n\t\t</div>\n\t)\n}\n\nexport default TokenToolView\n","import TokenConfig from '../components/TokenConfig.js'\n\nconst SelectedTokensControlsView = ({ tokens }) => {\n\tconst filteredTokens = tokens.filter(t => t.$selected)\n\treturn (\n\t\t<div>\n\t\t\t{ filteredTokens.map((token, $i) => (\n\t\t\t\t<TokenConfig key={ `token${$i}` } token={ token } />\n\t\t\t))}\n\t\t</div>\n\t)\n}\n\nexport default SelectedTokensControlsView\n","import { connect } from 'react-redux'\nimport SelectedTokensControlsView from '../views/SelectedTokensControlsView.js'\n\nconst SelectedTokensControls = ({ game }) => {\n\tconst filteredTokens = game.tokens.filter(t => t.$selected)\n\treturn (\n\t\t<SelectedTokensControlsView tokens={ filteredTokens } />\n\t)\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tgame: state.game,\n\t}\n}\n\nexport default connect(mapStateToProps, undefined)(SelectedTokensControls)\n","import { useState } from 'react'\nimport { connect } from 'react-redux'\nimport { addToken } from '../reducers/gameReducer.js'\nimport TokenToolView from '../views/TokenToolView.js'\nimport SelectedTokensControls from './SelectedTokensControls.js'\n\nconst TokenTool = ({ toggleOnTokens, game, addToken, metadata }) => {\n    const [newTokenUrl, setNewTokenUrl] = useState('')\n\n\tif (!metadata.isHost)\n\t\treturn null\n\n    const createToken = () => {\n        if (!newTokenUrl)\n            return\n        addToken(undefined, newTokenUrl, game.mapId)\n        setNewTokenUrl('')\n    }\n\n    return (\n        toggleOnTokens ?\n            <TokenToolView newTokenUrl={ newTokenUrl } setNewTokenUrl={ setNewTokenUrl } createToken={ createToken } tokens={ game.tokens } /> :\n            <SelectedTokensControls tokens={ game.tokens } />\n    )\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tgame: state.game,\n        metadata: state.metadata,\n\t}\n}\n\nconst mapDispatchToProps = {\n\taddToken,\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(TokenTool)\n","import Button from './Button.js'\n\nconst UserToolView = ({ initAsDev, copyJson, pasteJson, username, updateUsername, cursorSize, updateCursorSize }) => {\n\treturn (\n\t\t<div>\n\t\t\t<hr />\n\t\t\t<input title='User name' placeholder='User name' value={ username} onChange={ (e) => updateUsername(e.target.value) } />\n\t\t\t{ /* TODO: enable the mousesharing <ToggleButton title='Share mouse (cursor)' value='&#x1f401;' controlPanelState={ controlPanelState } setControlPanelState={ setControlPanelState } /> */ }\n\t\t\t<input title='Cursor size' value={ cursorSize } onChange={ (e) => updateCursorSize(e.target.value) } type='number' min='0' />\n\t\t\t<hr />\n\t\t\t<Button title='Redo as dev' value='&#x1f530;' onClick={ initAsDev } />\n\t\t\t<Button title='Copy JSON to clipboard' value='&#x1f46f;' onClick={ copyJson } />\n\t\t\t<Button title='Paste JSON from clipboard' value='&#x1f4cb;' onClick={ pasteJson } />\n\t\t</div>\n\t)\n}\n\nexport default UserToolView\n","import { connect } from 'react-redux'\nimport { setUsername, setCursorSize } from '../reducers/settingsReducer.js'\nimport { useWebSocket } from '../hooks/useSocket.js'\nimport UserToolView from '../views/UserToolView.js'\n\nconst UserTool = ({ toggleOnUser, settings, setUsername, setCursorSize }) => {\n    const [_webSocket, wsSettings, setWsSettings] = useWebSocket()\n\tif (!toggleOnUser)\n\t\treturn null\n\n    const updateUsername = (value) => {\n        setUsername(value)\n        setWsSettings({\n\t\t\t...wsSettings,\n\t\t\tusername: value,\n\t\t})\n    }\n\n    const updateCursorSize = (value) => {\n        const newSize = value\n\t\tif (!isNaN(newSize))\n\t\t\tsetCursorSize(newSize)\n    }\n\n    const initAsDev = () => {\n        //TODO: implement new init as dev\n        /*\n        const initAsDev = () => {\n            if (!window.confirm('Reset?'))\n                return null\n            let tokens = [\n                { name: 'bar', pc: 0 },\n                { name: 'foo', url: '/dev/belmont.jpg' },\n                { name: 'arr', pc: 1 },\n                { name: 'win', pc: 1, url: '/dev/redhead.jpg', y: 50, x: 90, w: 64, h:64 },\n            ]\n            let maps = [\n                {\n                    name: 'kiwi',\n                    imageUrl: '/dev/kiwi.jpeg',\n                    $id: 0,\n                    width: 500,\n                    height: 500,\n                    x: 0,\n                    y: 0,\n                    drawPaths: [],\n                    fogPaths: [],\n                },\n                {\n                    name: 'default',\n                    imageUrl: '/dev/FFtri9T.png',\n                    spawnX: 40,\n                    spawnY: 80,\n                    $id: 1,\n                    x: 0,\n                    y: 0,\n                    drawPaths: [],\n                    fogPaths: [],\n                }\n            ]\n            return new Promise(resolve => {\n                setGameState({\n                    ...gameState,\n                    game: {\n                        ...gameState.game,\n                        maps: maps,\n                        tokens: tokens,\n                        mapId: 0,\n                    },\n                })\n                resolve()\n            })\n        }\n        */\n    }\n\n    const copyJson = () => {\n\t\t//TODO: Implement CopyJson\n\t\t/*\n\t\tconst json = gameState.toJson()\n\t\twindow.navigator.clipboard.writeText(json).then(() => {\n\t\t\tnotify('copied to clipboard')\n\t\t}).catch(err => {\n\t\t\tconsole.error('failed to write to clipboard: ', err)\n\t\t\tnotify(`failed to write to clipboard: ${err}`, 2000)\n\t\t})\n\t\t*/\n\t}\n\n\tconst pasteJson = () => {\n\t\t//TODO: Implement PasteJson\n\t\t/*\n\t\tconst note1 = notify('reading clipboard...')\n\t\twindow.navigator.clipboard.readText().then(json => {\n\t\t\tif (window.confirm(`Do you really want to overwrite this game with what's in your clipboard? ${json.slice(0,99)}...`)) {\n\t\t\t\tfromJson(json)\n\t\t\t\tnotify('pasted from clipboard')\n\t\t\t}\n\t\t\tnote1 && note1.close()\n\t\t}).catch(err => {\n\t\t\tconsole.error('failed to read clipboard: ', err)\n\t\t\tnotify(`failed to read clipboard: ${err}`, 2000)\n\t\t})\n\t\t*/\n\t}\n\n\treturn (\n        toggleOnUser ?\n\t\t    <UserToolView\n                initAsDev={ initAsDev } \n                copyJson={ copyJson } \n                pasteJson={ pasteJson } \n                username={ settings.username } \n                updateUsername={ updateUsername } \n                cursorSize={ settings.cursorSize } \n                updateCursorSize={ updateCursorSize } />\n            : null\n\t)\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tgame: state.game,\n        settings: state.settings,\n\t}\n}\n\nconst mapDispatchToProps = {\n    setUsername,\n\tsetCursorSize,\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(UserTool)\n","import Button from '../views/Button.js'\nimport { connect } from 'react-redux'\nimport { setToolSettings } from '../reducers/settingsReducer.js'\n\nfunction ToolButton({ title, value, settings, setToolSettings }) {\n\tconst isSelected = title === settings.tool\n\tconst onClick = () => {\n\t\tsetToolSettings(title, undefined)\n\t}\n\treturn (\n\t\t<Button title={ title } value={ value.toString() } onClick={ onClick } isSelected={ isSelected } />\n\t)\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tsettings: state.settings,\n\t}\n}\n\nconst mapDispatchToProps = {\n\tsetToolSettings,\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ToolButton)\n","import ToolButton from '../components/ToolButton.js'\n\nconst ToolSelectView = () => {\n\treturn (\n\t\t<span id='tools'>\n\t\t\t<ToolButton title='move' value='&#x1f9f3;' />\n\t\t\t<ToolButton title='draw' value='&#x1f58d;' />\n\t\t\t<ToolButton title='fog'  value='&#x1f32c;' />\n\t\t</span>\n\t)\n}\n\nexport default ToolSelectView\n","import ToggleButton from '../components/ToggleButton.js'\nimport ToolControls from '../components/ToolControls.js'\nimport MapTool from '../components/MapTool.js'\nimport TokenTool from '../components/TokenTool.js'\nimport UserTool from '../components/UserTool.js'\nimport SelectedTokensControls from '../components/SelectedTokensControls.js'\nimport ToolSelectView from './ToolSelectView.js'\nimport Button from './Button.js'\n\nconst ControlPanelView = ({ controlPanelState, setControlPanelState, hidden, toggleHidden, isHost, username, setUsername, cursorSize, setCursorSize, socketRequestRefresh, pushRefreshToPlayers }) => {\n\tif (hidden)\n\t\treturn (\n\t\t\t<div id='control-panel'>\n\t\t\t\t&nbsp;&nbsp;&nbsp;&nbsp;\n\t\t\t\t<Button value='&#x1f441;' onClick={ toggleHidden } title='show/hide control panel' />\n\t\t\t\t&nbsp;&nbsp;&nbsp;&nbsp;\n\t\t\t</div>\n\t\t)\n\t\n\tif (isHost)\n\t\treturn (\n\t\t\t<div id='control-panel'>\n\t\t\t\t&nbsp;&nbsp;&nbsp;&nbsp;\n\t\t\t\t<Button value='&#x1f441;' onClick={ toggleHidden } title='show/hide control panel' />\n\t\t\t\t&nbsp;&nbsp;&nbsp;&nbsp;\n\t\t\t\t<ToggleButton title='User' value='&#x1f9d9;&#x200d;&#x2642;&#xfe0f;' controlPanelState={ controlPanelState } setControlPanelState={ setControlPanelState } />\n\t\t\t\t<ToggleButton title='Maps' value='&#x1f5fa;' controlPanelState={ controlPanelState } setControlPanelState={ setControlPanelState } />\n\t\t\t\t<ToggleButton title='Tokens' value='&#x265f;' controlPanelState={ controlPanelState } setControlPanelState={ setControlPanelState } />\n\t\t\t\t<Button title='Push refresh to players' value='&#x1f4ab;' onClick={ pushRefreshToPlayers } />\n\t\t\t\t&nbsp;&nbsp;&nbsp;&nbsp;\n\t\t\t\t<ToolSelectView />\n\t\t\t\t&nbsp;&nbsp;&nbsp;&nbsp;\n\t\t\t\t<ToolControls />\n\t\t\t\t<MapTool toggleOnMaps={ controlPanelState.toggleOnMaps } />\n\t\t\t\t<TokenTool toggleOnTokens={ controlPanelState.toggleOnTokens } />\n\t\t\t\t<UserTool toggleOnUser={ controlPanelState.toggleOnUser } />\n\t\t\t</div>\n\t\t)\n\telse\n\t\treturn (\n\t\t\t<div id='control-panel'>\n\t\t\t\t<Button value='&#x1f441;' onClick={ toggleHidden } title='show/hide control panel' />\n\t\t\t\t<input title='User name' placeholder='User name' value={ username } onChange={ (e) => setUsername(e.target.value) } />\n\t\t\t\t<ToggleButton title='Share mouse (cursor)' value='&#x1f401;' controlPanelState={ controlPanelState } setControlPanelState={ setControlPanelState } />\n\t\t\t\t<input title='Cursor size' value={ cursorSize } onChange={ (e) => setCursorSize(parseInt(e.target.value)) } type='number' min='0' />\n\t\t\t\t<Button title='Request gameboard refresh from host' onClick={ socketRequestRefresh } value='&#x1f4ab;' />\n\t\t\t\t<SelectedTokensControls />\n\t\t\t</div>\n\t\t)\n}\n\nexport default ControlPanelView\n","import React, { useState } from 'react'\nimport { connect } from 'react-redux'\nimport { setUsername, setCursorSize } from '../reducers/settingsReducer.js' \nimport { pushGameRefresh, requestRefresh, useWebSocket } from '../hooks/useSocket.js'\nimport ControlPanelView from '../views/ControlPanelView.js'\n\nconst initialControlPanelState = () => {\n\treturn {\n\t\thidden: false,\n\t\ttoggleOnMaps: false,\n\t\ttoggleOnUser: false,\n\t\ttoggleOnTokens: false,\n\t}\n}\n\nconst ControlPanel = ({ game, settings, metadata, setUsername, setCursorSize }) => {\n\tconst [controlPanelState, setControlPanelState] = useState(initialControlPanelState)\n\tconst [webSocket, wsSettings, setWsSettings] = useWebSocket()\n\n\tconst toggleHidden = () => {\n\t\tsetControlPanelState({\n\t\t\t...controlPanelState,\n\t\t\thidden: !controlPanelState.hidden,\n\t\t})\n\t}\n\n\tconst updateUsername = (value) => {\n\t\tsetUsername(value)\n\t\tsetWsSettings({\n\t\t\t...wsSettings,\n\t\t\tusername: value,\n\t\t})\n\t}\n\n\tconst updateCursorSize = (value) => {\n\t\tconst newSize = value\n\t\tif (!isNaN(newSize))\n\t\t\tsetCursorSize(newSize)\n\t}\n\n\tconst socketRequestRefresh = () => {\n\t\trequestRefresh(webSocket, wsSettings)\n\t}\n\n\tconst pushRefreshToPlayers = () => {\n\t\tconsole.log('pushing game', game)\n\t\tpushGameRefresh(webSocket, wsSettings, game)\n\t}\n\n\treturn (\n\t\t<ControlPanelView \n\t\t\tcontrolPanelState={ controlPanelState } \n\t\t\tsetControlPanelState={ setControlPanelState } \n\t\t\thidden={ controlPanelState.hidden } \n\t\t\ttoggleHidden={ toggleHidden } \n\t\t\tisHost={ metadata.isHost } \n\t\t\tusername={ settings.username } \n\t\t\tsetUsername={ updateUsername } \n\t\t\tcursorSize={ settings.cursorSize } \n\t\t\tsetCursorSize={ updateCursorSize } \n\t\t\tsocketRequestRefresh={ socketRequestRefresh } \n\t\t\tpushRefreshToPlayers={ pushRefreshToPlayers } />\n\t)\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tgame: state.game,\n\t\tsettings: state.settings,\n\t\tmetadata: state.metadata,\n\t}\n}\n\nconst mapDispatchToProps = {\n\tsetUsername,\n\tsetCursorSize,\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(ControlPanel)\n","import Background from '../components/Background.js'\nimport Drawing from '../components/Drawing.js'\nimport Fog from '../components/Fog.js'\nimport Overlay from '../components/Overlay.js'\nimport Token from '../components/Token.js'\nimport Cursor from './Cursor.js'\nimport ControlPanel from '../components/ControlPanel.js'\n\nconst GameView = ({ isHost, overlayRef, isFogLoaded, cursors, cursorSize, tokens, onMouseMove, onMouseUp, onMouseDown }) => {\n\tconst goneClass = isFogLoaded ? null : 'gone'\n\n\treturn (\n\t\t<div id='game' onMouseMove={ (e) => onMouseMove(e) } onMouseDown={ (e) => onMouseDown(e) } onMouseUp={ (e) => onMouseUp(e) }>\n\t\t\t<div className={ goneClass }>\n\t\t\t\t<Background />\n\t\t\t\t<Drawing />\n\t\t\t\t{ tokens ? \n\t\t\t\t\t<div id='tokens'>\n\t\t\t\t\t\t{ tokens.map((token, $i) => (\n\t\t\t\t\t\t\t<Token key={ `Token${$i}` } token={ token } isHost={ isHost } />\n\t\t\t\t\t\t)) }\n\t\t\t\t\t</div>\n\t\t\t\t\t: null\n\t\t\t\t}\n\t\t\t\t<Fog />\n\t\t\t\t{ cursors ?\n\t\t\t\t\t<div id='cursors'>\n\t\t\t\t\t\t{ cursors.map((cursor) => (\n\t\t\t\t\t\t\t<Cursor key={ `cursor${cursor.$id}` } name={ cursor.username } cursor={ cursor } size={ cursorSize } />\n\t\t\t\t\t\t)) }\n\t\t\t\t\t</div>\n\t\t\t\t\t: null\n\t\t\t\t}\n\t\t\t\t{/* Overlay: Holds outline for fog & draw tools */ }\n\t\t\t\t<Overlay overlayRef={ overlayRef } /> \n\t\t\t</div>\n\t\t\t<ControlPanel />\n\t\t</div>\n\t)\n}\n\nexport default GameView\n","import React, { useEffect } from 'react'\nimport { connect } from 'react-redux'\nimport { setGameSettings } from '../reducers/metadataReducer.js'\nimport { overwriteGame, updateMaps, loadMap, incrementGen } from '../reducers/gameReducer.js'\nimport { pushDrawPath, pushFogPath, pushGameRefresh, useWebSocket } from '../hooks/useSocket.js'\nimport GameView from '../views/GameView.js'\n\nconst Game = ({ metadata, game, settings, setGameSettings, overwriteGame, loadMap, updateMaps, incrementGen }) => {\n\tconst overlayRef = React.useRef()\n\tconst [webSocket, wsSettings] = useWebSocket()\n\tlet currentPath = []\n\n\t/****************************************************\n\t * Map Functions                                    *\n\t ****************************************************/\n\tconst getMap = () => {\n\t\tif (game.maps.length === 0)\n\t\t\treturn undefined\n\t\tconst currMap = game.maps.filter((map) => map.$id === game.mapId)\n\t\treturn currMap.length > 0 ? currMap[0] : game.maps[0]\n\t}\n\n\t/****************************************************\n\t * Update Functions                                 *\n\t ****************************************************/\n\n\t/*\n\tconst updateCursors = (x, y, name, guid) => {\n\t\tconst cursors = Object.assign({}, gameState.metadata.cursors)\n\t\tcursors[guid] = { x: x, y: y, time: new Date(), u: name }\n\t\tsetGameState({\n\t\t\t...gameState,\n\t\t\tmetadata: {\n\t\t\t\t...gameState.metadata,\n\t\t\t\tcursors: cursors,\n\t\t\t},\n\t\t})\n\t}\n\t*/\n\n\t/****************************************************\n\t * Control Functions                                *\n\t ****************************************************/\n\tconst dragSelectedTokens = (e) => {\n\t\t//TODO: Update dragSelectedTokens\n\t\t/*\n\t\tif (gameState.settings.tool !== 'move')\n\t\t\treturn\n\t\tconst downX = gameState.metadata.downX, downY = gameState.metadata.downY\n\t\tupdateTokens((token) => {\n\t\t\tif (token.$selected) {\n\t\t\t\ttoken.x = token.$x0 + e.pageX - downX\n\t\t\t\ttoken.y = token.$y0 + e.pageY - downY\n\t\t\t}\n\t\t\treturn token\n\t\t}, false, undefined)\n\t\t*/\n\t}\n\n\t/****************************************************\n\t * Drawing Functions                                *\n\t ****************************************************/\n\tconst setPointerOutline = (x, y, color, radius) => {\n\t\tif (color == null)\n\t\t\treturn\n\t\tconst ctx = overlayRef.current.getContext('2d')\n\t\tctx.strokeStyle = color\n\t\tctx.lineWidth = '3'\n\t\tctx.beginPath()\n\t\tctx.arc(x, y, radius, 0, 2*Math.PI)\n\t\tctx.stroke()\n\t\tctx.closePath()\n\t}\n\n\tconst updateCurrentDrawPath = () => {\n\t\tconst ctx = overlayRef.current.getContext('2d')\n\t\tctx.beginPath()\n\t\tfor (let pointId = 0; pointId < currentPath.length; pointId++) {\n\t\t\tctx.lineCap = 'round'\n\t\t\tctx.fillStyle = currentPath[pointId].drawColor\n\t\t\tctx.lineWidth = currentPath[pointId].drawSize\n\t\t\tctx.strokeStyle = currentPath[pointId].drawColor\n\t\t\tif (pointId === 0) {\n\t\t\t\tctx.moveTo(currentPath[pointId].x, currentPath[pointId].y)\n\t\t\t} else {\n\t\t\t\tctx.lineTo(currentPath[pointId].x, currentPath[pointId].y)\n\t\t\t}\n\t\t}\n\t\tctx.stroke()\n\t}\n\n\tconst updateCurrentFogPath = () => {\n\t\tconst ctx = overlayRef.current.getContext('2d')\n\t\tctx.beginPath()\n\t\tlet gradient\n\t\tfor (let pointId = 0; pointId < currentPath.length; pointId++) {\n\t\t\tgradient = ctx.createRadialGradient(currentPath[pointId].x, currentPath[pointId].y, currentPath[pointId].r2 || 1, currentPath[pointId].x, currentPath[pointId].y, currentPath[pointId].r*0.75)\n\t\t\tctx.lineCap = 'round'\n\t\t\tgradient.addColorStop(0, 'rgba(255,255,255,255)')\n\t\t\tgradient.addColorStop(1, 'rgba(255,255,255,0)')\n\t\t\tctx.fillStyle = gradient\n\t\t\tctx.fillRect(currentPath[pointId].x-currentPath[pointId].r, currentPath[pointId].y-currentPath[pointId].r, currentPath[pointId].x+currentPath[pointId].r, currentPath[pointId].y+currentPath[pointId].r)\n\t\t}\n\t\tctx.stroke()\n\t}\n\n\tconst clearOverlay = () => {\n\t\tconst ctx = overlayRef.current.getContext('2d')\n\t\tif (!ctx)\n\t\t\treturn\n\t\tctx.clearRect(0, 0, game.width, game.height);\n\t}\n\n\t/****************************************************\n\t * Event Handlers                                   *\n\t ****************************************************/\n\t/* Callback when the window resizes */\n\tconst onResize = () => {\n\t\t//loadMap(null, true, true)\n\t}\n\n\tconst onKeyDown = (e) => {\n\t\t//TODO: Update onKeyDown function\n\t\t/*\n\t\tfor (let x of [document.activeElement, e.target])\n\t\t\t//TODO: Check if we can use triple equal\n\t\t\tif (x.tagName == 'INPUT' && (x.type === 'text' || x.type === 'number')) // eslint-disable-line eqeqeq\n\t\t\t\treturn e\n\t\t\n\t\tconst moveFactor = e.shiftKey ? 100 : 10\n\t\tconst moveSelectedTokens = () => {\n\t\t\tupdateTokens(token => {\n\t\t\t\tif (token.$selected) {\n\t\t\t\t\tswitch (e.keyCode) {\n\t\t\t\t\t\tcase 27: // escape\n\t\t\t\t\t\t\ttoken.$selected = false\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\tcase 37: // left\n\t\t\t\t\t\t\ttoken.x -= moveFactor\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\tcase 38: // up\n\t\t\t\t\t\t\ttoken.y -= moveFactor\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\tcase 39: // right\n\t\t\t\t\t\t\ttoken.x += moveFactor\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\tcase 40: // down\n\t\t\t\t\t\t\ttoken.y += moveFactor\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\tdefault: return\n\t\t\t\t\t}\n\t\t\t\t\te.preventDefault()\n\t\t\t\t}\n\t\t\t\treturn token\n\t\t\t})\n\t\t}\n\t\tswitch (e.keyCode) {\n\t\t\tcase 27:\n\t\t\tcase 37:\n\t\t\tcase 38:\n\t\t\tcase 39:\n\t\t\tcase 40:\n\t\t\t\tmoveSelectedTokens(e)\n\t\t\t\tbreak\n\t\t\tdefault: return\n\t\t}\n\t\t*/\n\t}\n\n\t/*\n\tconst onKeyPress = (e) => {\n\t\tif (!gameState.metadata.isHost)\n\t\t\treturn e\n\t\tfor (let x of [document.activeElement, e.target])\n\t\t\t//TODO: Check if we can use triple equal\n\t\t\tif ((x.tagName == 'INPUT' && (x.type === 'text' || x.type === 'number')) || (x.tagName == 'BUTTON'))\n\t\t\t\treturn e\n\n\t\tconst cp = gameState.cpRef.current\n\t\tswitch(e.code) {\n\t\t\tcase 'KeyC':\n\t\t\t\tif (e.shiftKey)\n\t\t\t\t\tcp.copyJson() // dump json to clipboard\n\t\t\t\tbreak\n\t\t\tcase 'KeyH':\n\t\t\t\ttoggleControlPanelVisibility('hidden')\n\t\t\t\tbreak\n\t\t\tcase 'KeyG':\n\t\t\t\tsetGameState({\n\t\t\t\t\t...gameState,\n\t\t\t\t\tsettings: {\n\t\t\t\t\t\t...gameState.settings,\n\t\t\t\t\t\ttool: 'fog',\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\tcase 'KeyL':\n\t\t\t\tif (e.shiftKey)\n\t\t\t\t\tloadFromLocalStorage()\n\t\t\t\telse\n\t\t\t\t\tsaveToLocalStorage()\n\t\t\t\tbreak\n\t\t\tcase 'KeyM':\n\t\t\t\ttoggleControlPanelVisibility('toggleOnMaps')\n\t\t\t\tbreak\n\t\t\tcase 'KeyP':\n\t\t\t\tsetGameState({\n\t\t\t\t\t...gameState,\n\t\t\t\t\tsettings: {\n\t\t\t\t\t\t...gameState.settings,\n\t\t\t\t\t\ttool: 'draw',\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\tcase 'KeyT':\n\t\t\t\ttoggleControlPanelVisibility('toggleOnTokens')\n\t\t\t\tbreak\n\t\t\tcase 'KeyV':\n\t\t\t\tif (e.shiftKey)\n\t\t\t\t\tcp.pasteJson() // load json from clipboard\n\t\t\t\telse\n\t\t\t\tsetGameState({\n\t\t\t\t\t...gameState,\n\t\t\t\t\tsettings: {\n\t\t\t\t\t\t...gameState.settings,\n\t\t\t\t\t\ttool: 'move',\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\tbreak\n\t\t\tdefault: return\n\t\t}\n\t}\n\t*/\n\n\tconst onMouseUp = (e) => {\n\t\tconst currMap = getMap()\n\t\tif (currMap && metadata.isHost) {\n\t\t\tconst fogPaths = currMap.fogPaths\n\t\t\tconst drawPaths = currMap.drawPaths\n\t\t\tswitch (settings.tool) {\n\t\t\t\tcase 'fog':\n\t\t\t\t\tfogPaths.push(currentPath)\n\t\t\t\t\tpushFogPath(webSocket, wsSettings, currentPath)\n\t\t\t\t\tbreak\n\t\t\t\tcase 'draw':\n\t\t\t\t\tdrawPaths.push(currentPath)\n\t\t\t\t\tpushDrawPath(webSocket, wsSettings, currentPath)\n\t\t\t\t\tbreak\n\t\t\t\tdefault: break\n\t\t\t}\n\t\t\tcurrentPath = []\n\t\t\tconst updatedMaps = game.maps.map((map) => {\n\t\t\t\treturn map.$id === currMap.$id ? {...currMap, fogPaths: fogPaths, drawPaths: drawPaths, } : map\n\t\t\t})\n\t\t\t\n\t\t\tupdateMaps(updatedMaps)\n\t\t}\n\t}\n\n\tconst onMouseDown = (e) => {\n\t\tfor (let x of [document.activeElement, e.target])\n\t\t\t//TODO: Check if we can use triple equal\n\t\t\tif ((x.tagName == 'INPUT' && (x.type === 'text' || x.type === 'number')) || (x.tagName == 'BUTTON')) /* eslint-disable-line eqeqeq */\n\t\t\t\treturn e\n\n\t\tif (metadata.isHost) {\n\t\t\tif (e.buttons & 1) {\n\t\t\t\t/*\n\t\t\t\tif (!/(\\s|^)token(\\s|$)/.test(e.target.getAttribute('class')))\n\t\t\t\t\t//TODO: Update to map function\n\t\t\t\t\tupdateTokens(tok => { delete tok.$selected })\n\t\t\t\t*/\n\t\t\t\tcurrentPath = []\n\t\t\t\tcurrentPath.push({\n\t\t\t\t\tx: e.pageX,\n\t\t\t\t\ty: e.pageY,\n\t\t\t\t\tr: settings.fogRadius,\n\t\t\t\t\tr2: undefined,\n\t\t\t\t\ttool: currentTool(),\n\t\t\t\t\tdrawColor: settings.drawColor,\n\t\t\t\t\tdrawSize: settings.drawSize,\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n\n\tconst onMouseMove = (e) => {\n\t\tconst overlay = overlayRef\n\t\tif (!overlay)\n\t\t\treturn\n\n\t\tclearOverlay()\n\t\tlet x = e.pageX, y = e.pageY\n\t\tswitch (metadata.isHost ? settings.tool : 'move') {\n\t\t\tcase 'fog':\n\t\t\t\tupdateCurrentFogPath()\n\t\t\t\tsetPointerOutline(x, y, 'yellow', settings.fogRadius)\n\t\t\t\tbreak\n\t\t\tcase 'draw':\n\t\t\t\tupdateCurrentDrawPath()\n\t\t\t\tsetPointerOutline(x, y, settings.drawColor, settings.drawSize)\n\t\t\t\tbreak\n\t\t\tcase 'move':\n\t\t\t\tif (e.buttons & 1)\n\t\t\t\t\tdragSelectedTokens(e)\n\t\t\t\tbreak\n\t\t\tdefault: break\n\t\t}\n\t\tif ((settings.tool === 'fog' || settings.tool === 'draw') && (e.buttons & 1)) {\n\t\t\tcurrentPath.push({\n\t\t\t\tx: x,\n\t\t\t\ty: y,\n\t\t\t\tr: settings.fogRadius,\n\t\t\t\tr2: undefined,\n\t\t\t\ttool: currentTool(),\n\t\t\t\tdrawColor: settings.drawColor,\n\t\t\t\tdrawSize: settings.drawSize,\n\t\t\t})\n\t\t}\n\t}\n\n\tconst currentTool = () => {\n\t\tconst isEraser = settings.subtool === 'eraser'\n\t\tswitch (settings.tool) {\n\t\t\tcase 'draw':\n\t\t\t\tif (isEraser) {\n\t\t\t\t\treturn 'erease'\n\t\t\t\t} else {\n\t\t\t\t\treturn 'draw'\n\t\t\t\t}\n\t\t\tdefault:\n\t\t\t\treturn settings.tool\n\t\t}\n\t}\n\n\t/****************************************************\n\t * Receiving Data                                   *\n\t ****************************************************/\n\tconst receiveData = (evt) => {\n\t\tlet data = JSON.parse(evt.data)\n\t\tconsole.log('receiving the following data', data)\n\t\tif (data.from === wsSettings.guid) {\n\t\t\treturn // ignore messages sent by self\n\t\t}\n\t\tif (data.to && data.to !== wsSettings.guid) {\n\t\t\treturn // ignore messages sent to different recipients\n\t\t}\n\n\t\tconst currMap = getMap()\n\t\tconsole.log('current map',currMap)\n\t\tswitch (data.type) {\n\t\t\tcase 'pushCursor':\n\t\t\t\t/*\n\t\t\t\tif (data.u !== this.gameState.settings.username)\n\t\t\t\t\tthis.gameState.updateCursors(data.x, data.y, data.u, data.from)\n\t\t\t\t*/\n\t\t\t\tbreak\n\t\t\tcase 'pushDrawPath':\n\t\t\t\tconst newDrawPath = currMap.drawPaths ? currMap.drawPaths : []\n\t\t\t\tnewDrawPath.push(data.drawPath)\n\t\t\t\tconst updatedMapsWithDraw = game.maps.map((map) => {\n\t\t\t\t\treturn map.$id === currMap.$id ? { ...currMap, drawPaths: newDrawPath, } : map\n\t\t\t\t})\n\t\t\t\tupdateMaps(updatedMapsWithDraw)\n\t\t\t\tbreak\n\t\t\tcase 'pushDrawReset':\n\t\t\t\tconst updatedMapsWithDrawReset = game.maps.map((map) => {\n\t\t\t\t\treturn map.$id === currMap.$id ? {...currMap, drawPaths: [], } : map\n\t\t\t\t})\n\t\t\t\tupdateMaps(updatedMapsWithDrawReset)\n\t\t\t\tbreak\n\t\t\tcase 'pushFogPath':\n\t\t\t\tconst newFogPath = currMap.fogPaths ? currMap.fogPaths : []\n\t\t\t\tnewFogPath.push(data.fogPath)\n\t\t\t\tconst updatedMapsWithFog = game.maps.map((map) => {\n\t\t\t\t\treturn map.$id === currMap.$id ? { ...currMap, fogPaths: newFogPath, } : map\n\t\t\t\t})\n\t\t\t\tupdateMaps(updatedMapsWithFog)\n\t\t\t\tbreak\n\t\t\tcase 'pushFogReset':\n\t\t\t\tconst updatedMapsWithFogReset = game.maps.map((map) => {\n\t\t\t\t\treturn map.$id === currMap.$id ? {...currMap, fogPaths: [], } : map\n\t\t\t\t})\n\t\t\t\tupdateMaps(updatedMapsWithFogReset)\n\t\t\t\tbreak\n\t\t\tcase 'pushSingleToken':\n\t\t\t\t/*\n\t\t\t\tconst local = this.gameState.game.tokens[data.i]\n\t\t\t\tconst token = Object.assign(local, data.a) // Keep and `$` attrs like `$selected`\n\t\t\t\tthis.gameState.updateTokenByIndex(data.i, token, true)\n\t\t\t\t*/\n\t\t\t\tbreak\n\t\t\tcase 'pushTokens':\n\t\t\t\t/*\n\t\t\t\tconst localTokensMap = this.gameState.game.tokens.reduce((out, tok) => {\n\t\t\t\t\tout[tok.guid] = tok\n\t\t\t\t\treturn out\n\t\t\t\t}, {})\n\t\t\t\tconst tokens = data.tokens.map(tok => Object.assign({}, localTokensMap[tok.guid], tok))\n\t\t\t\tthis.gameState.setState({tokens: tokens})\n\t\t\t\t*/\n\t\t\t\tbreak\n\t\t\tcase 'pushMapId':\n\t\t\t\tloadMap(data.mapId)\n\t\t\t\tbreak\n\t\t\tcase 'pushMapState':\n\t\t\t\tupdateMaps(data.maps)\n\t\t\t\tloadMap(data.mapId)\n\t\t\t\tbreak\n\t\t\tcase 'pushGameRefresh': // refresh from host\n\t\t\t\tconsole.log('receiving gamedata', data.game)\n\t\t\t\toverwriteGame(data.game)\n\t\t\t\tbreak\n\t\t\tcase 'requestRefresh': // refresh request from player\n\t\t\t\tif (metadata.isHost) {\n\t\t\t\t\tpushGameRefresh(webSocket, wsSettings, game, { to: data.from, })\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\tdefault:\n\t\t\t\tconsole.error(`Unrecognized websocket message type: ${data.type}`)\n\t\t}\n\t}\n\n\t/****************************************************\n\t * Helper Functions                                 *\n\t ****************************************************/\n\tconst notify = (msg, ttl, tag) => {\n\t\tconsole.log(msg)\n\t\tif (window.Notification) {\n\t\t\tif (window.Notification.permission !== 'granted')\n\t\t\t\twindow.Notification.requestPermission()\n\t\t\telse {\n\t\t\t\tconst note = new window.Notification(msg, {tag: tag})\n\t\t\t\tsetTimeout(() => note.close(), ttl || 1000)\n\t\t\t\treturn note\n\t\t\t}\n\t\t}\n\t}\n\n\tconst toJson = (additionalAttrs) => {\n\t\t//TODO: rewrite toJson\n\t\t/*\n\t\tconst map = getMap()\n\t\tincrementGen()\n\t\tconst tokens = game.tokens.map(token => ({...token}))\n\t\ttokens.forEach(token => websocket.scrubObject(token))\n\t\tconst maps = game.maps\n\t\tObject.values(maps).forEach(map => websocket.scrubObject(map))\n\t\tconst data = Object.assign({\n\t\t\tgen: game.gen,\n\t\t\tmaps: maps,\n\t\t\tmapId: map && map.$id,\n\t\t\ttokens: tokens,\n\t\t}, additionalAttrs)\n\t\treturn JSON.stringify(data)\n\t\t*/\n\t}\n\n\tconst fromJson = (json) => {\n\t\t//TODO: rewrite fromJson\n\t\t/*\n\t\tconst data = Object.assign(JSON.parse(json)||{})\n\t\tif (data.tokens) {\n\t\t\tdata.tokens.forEach(token => {\n\t\t\t\tif (!token.guid) token.guid = guid()\n\t\t\t})\n\t\t}\n\t\treturn new Promise(resolve => {\n\t\t\tsetGameState({\n\t\t\t\t...gameState,\n\t\t\t\tgame: {\n\t\t\t\t\t...gameState.game,\n\t\t\t\t\tdata,\n\t\t\t\t}\n\t\t\t})\n\t\t\tresolve()\n\t\t})\n\t\t*/\n\t}\n\n\tconst saveToLocalStorage = () => {\n\t\t//TODO: Reenable after we've fixed toJson\n\t\t/*\n\t\tif (game.isFirstLoadDone) {\n\t\t\tconsole.log('Saving game to local storage')\n\t\t\tlocalStorage.setItem(metadata.room, toJson())\n\t\t}\n\t\t*/\n\t}\n\n\tconst loadFromLocalStorage = () => {\n\t\t//TODO: reenable after we've fixed fromJson\n\t\t/*\n\t\t//TODO: Verify how come this does not work anymore\n\t\tconsole.log('Loading game from local storage')\n\t\treturn fromJson(localStorage.getItem(metadata.room))\n\t\t*/\n\t}\n\n\tfunction handleError (ex) {\n\t\tconsole.error(ex)\n\t\tconsole.error('Exception in `render`. Clearing localStorage...')\n\t\tlocalStorage.removeItem(metadata.room)\n\t\twindow.alert('Fatal error. Local storage cleared.')\n\t}\n\n\t/****************************************************\n\t * React Hooks                                      *\n\t ****************************************************/\n\t// On Mount\n\tuseEffect(() => {\n\t\twindow.addEventListener('beforeunload', saveToLocalStorage)\n\t\twindow.addEventListener('resize', onResize)\n\t\t//TODO: reenable keypresses\n\t\t//window.addEventListener('keypress', onKeyPress)\n\t\twindow.addEventListener('keydown', onKeyDown)\n\t\tloadFromLocalStorage()\n\t\tconst params = new URLSearchParams(window.location.href.replace(/.*\\?/, ''))\n\t\tsetGameSettings(params.get('host'), params.get('room'))\n\n\t\t// On Unmount\n\t\treturn () => {\n\t\t\tsaveToLocalStorage()\n\t\t\twindow.removeEventListener('beforeunload', saveToLocalStorage)\n\t\t\twindow.removeEventListener('resize', onResize)\n\t\t\t//window.removeEventListener('keypress', onKeyPress)\n\t\t\twindow.removeEventListener('keydown', onKeyDown)\n\t\t}\n\t}, []) // eslint-disable-line react-hooks/exhaustive-deps\n\n\t// attach all the event listeners for receiving of data\n\tuseEffect(() => {\n\t\tif (webSocket)\n\t\t\twebSocket.addEventListener('message', receiveData)\n\t\tdocument.title = `Borealis D&D, Room: ${metadata.room}`\n\t\treturn () => {\n\t\t\twebSocket.removeEventListener('message', receiveData)\n\t\t}\n\t}, [ metadata.room, webSocket, receiveData])\n\t\n\t/*\n\tuseEffect(() => {\n\t\tif (websocket && gameState.settings.shareMouse)\n\t\t\twebsocket.pushCursor(gameState.metadata.lastX, gameState.metadata.lastY)\n\t}, [gameState.metadata.lastX, gameState.metadata.lastY, gameState.settings.shareMouse])\n\t*/\n\n\t/*\n\tuseEffect(() => {\n\t\t//TODO: reenable websocket push\n\t\t//if (websocket)\n\t\t//\twebsocket.pushTokens(gameState.game.tokens)\n\t}, [gameState.game.tokens])\n\t*/\n\n\t/****************************************************\n\t * Component Render                                 *\n\t ****************************************************/\n\tconst deadline = new Date() - 30000\n\tconst cursorsCopy = metadata.cursors\n\n\tfor (let name in cursorsCopy) {\n\t\tlet time = cursorsCopy[name].time\n\t\tif (!time || time < deadline)\n\t\t\tdelete cursorsCopy[name]\n\t}\n\n\ttry {\n\t\treturn (\n\t\t\t<GameView \n\t\t\t\tisHost={ metadata.isHost } \n\t\t\t\toverlayRef={ overlayRef } \n\t\t\t\tisFogLoaded={ game.isFogLoaded } \n\t\t\t\tcursors={ cursorsCopy } \n\t\t\t\tcursorSize={ settings.cursorSize } \n\t\t\t\ttokens={ game.tokens } \n\t\t\t\tonMouseMove={ onMouseMove } \n\t\t\t\tonMouseUp={ onMouseUp } \n\t\t\t\tonMouseDown={ onMouseDown } \n\t\t\t\t/* TODO: reenable notify={ notify } */\n\t\t\t/>\n\t\t)\n\t} catch (ex) {\n\t\thandleError(ex)\n\t}\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tmetadata: state.metadata,\n\t\tgame: state.game,\n\t\tsettings: state.settings,\n\t}\n}\n\nconst mapDispatchToProps = {\n\tsetGameSettings,\n\toverwriteGame,\n\tloadMap,\n\tupdateMaps,\n\tincrementGen,\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Game)\n","import React from 'react'\nimport { createStore, combineReducers } from 'redux'\nimport { Provider } from 'react-redux'\nimport settingsReducer from '../reducers/settingsReducer'\nimport metadataReducer from '../reducers/metadataReducer'\nimport gameReducer from '../reducers/gameReducer'\nimport WebSocketProvider from '../contexts/WebSocketProvider'\nimport Game from './Game'\n\nconst App = () => {\n    const combinedReducer = combineReducers({\n        settings: settingsReducer,\n        metadata: metadataReducer,\n        game: gameReducer,\n    })\n    const store = createStore(combinedReducer)\n\n    return(\n        <Provider store={ store } >\n            <WebSocketProvider>\n                <Game />\n            </WebSocketProvider>\n        </Provider>\n    )\n}\n\nexport default App\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n)\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href)\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config)\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          )\n        })\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config)\n      }\n    })\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing\n        if (installingWorker == null) {\n          return\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              )\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration)\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.')\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration)\n              }\n            }\n          }\n        }\n      }\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error)\n    })\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type')\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload()\n          })\n        })\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config)\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      )\n    })\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister()\n      })\n      .catch(error => {\n        console.error(error.message)\n      })\n  }\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './styles/index.css'\nimport './styles/Game.css'\nimport App from './components/App'\nimport * as serviceWorker from './serviceWorker.js'\n\nReactDOM.render(\n\t<React.StrictMode>\n\t\t<App />\n\t</React.StrictMode>,\n\tdocument.getElementById('root')\n)\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister()\n"],"sourceRoot":""}